---
title: 2024/09/09〜2024/09/15の最新情報
tags:
  - Deno
  - deno_std
categories:
  - news
date: 2024-09-15
description: Deno v2.0.0-rc.2 (直近の変更内容について)
---

## Deno v2.0.0-rc.2

[Deno v2.0.0-rc.2](https://github.com/denoland/deno/commit/57556ade8c128aeea7340d463b35c86afe1fb4f7)がリリースされています。

どの変更内容がv2.0.0-rc.2に入っているかは不明なため、[Deno v2.0.0-rc.1]({{< ref "articles/2024/09/08.md" >}})からの差分を参考に直近の変更内容についてまとめます ([差分](https://github.com/denoland/deno/compare/6919f33216bb1db2b3596ca6f2f9c2c54f322720...57556ade8c128aeea7340d463b35c86afe1fb4f7))

### 破壊的変更

#### `Deno.errors.NotCapable`の導入

`Deno.errors.NotCapable`という新しいエラーが追加されています。

今までは、OSによる権限エラーとDenoによる権限エラー(`--allow-*`の指定漏れ)の両方のが`Deno.errors.PermissionDenied`によって表現されていました。

これからはOSによる権限エラーは`Deno.errors.PermissionDenied`、Denoによる権限エラーは`Deno.errors.NotCapable`によって表現されます。

---

- [feat(cli): use NotCapable error for permission errors #25431](https://github.com/denoland/deno/pull/25431)

#### `deno.json`

`deno.json`から下記フィールドが削除されています:

- `lint.files`
- `fmt.files`
- `test.files`
- `bench.files`

今後は`lint.exclude`や`fmt.include`などへの移行が推奨されます。

#### `--unstable`の削除

すべてのunstable APIを有効化する`--unstable`オプションが削除されています。

今後は[`--unstable-*`や`deno.json`の`unstable`フィールド]({{< ref "articles/deno/v1.38.md" >}})への移行が推奨されます。

#### 非推奨化されていたDeno APIの削除

非推奨化されていた以下のAPIが削除されています (移行先については[Deno 1.x to 2.x Migration Guide](https://github.com/denoland/docs/blob/3326756fcb2c39dd55fae81f52ae3247d9158774/runtime/reference/migrate_deprecations.md)で解説されています):

- `Deno.serveHttp`関連の型定義
- `Deno.Buffer`
- `Deno.FsFile.prototype.constructor` (`Deno.FsFile`の直接のインスタンス生成が禁止されます)
- 下記の`rid`プロパティに関する型定義
  - `Deno.stdin`
  - `Deno.stdout`
  - `Deno.stderr`
- 下記オブジェクトの`rid`プロパティ
  - `Deno.TlsConn`
  - `Deno.Conn`
  - `Deno.TcpConn`
  - `Deno.UnixConn`
  - `Deno.Listener`
  - `Deno.FsFile`
- `Deno.fdatasync(Sync)`
- `Deno.Reader(Sync)`
- `Deno.Writer(Sync)`
- `Deno.Closer`
- `Deno.fsync(Sync)`
- `Deno.connectTls`の下記オプション
  - `certChain`
  - `certFile`
  - `privateKey`
- `Deno.listenTls`の下記オプション
  - `certChain`
  - `certFile`
  - `keyFile`

#### 廃止されたTemporal APIの削除

[Deno v1.46]({{< ref "articles/deno/v1.46.md" >}})に続いて、廃止されたTemporal APIの削除が行われています ([#25505](https://github.com/denoland/deno/pull/25505))

以下のAPIが削除されているようです:

- `Temporal.Instant#toZonedDateTime`
- `Temporal.PlainDate#getISOFields`
- `Temporal.PlainDateTime#getISOFields`
- `Temporal.PlainTime#getISOFields`
- `Temporal.PlainYearMonth#getISOFields`
- `Temporal.ZonedDateTime.epochSeconds`
- `Temporal.ZonedDateTime.epochMicroseconds`
- `Temporal.ZonedDateTime.#getISOFields`
- `Temporal.Calendar`
- `Temporal.TimeZone`

また、`Temporal.Calendar`と`Temporal.TimeZone`の削除に併せて、いくつかのAPIの型定義なども調整されています。

### `Deno.createHttpClient`の安定化

`Deno.createHttpClient`が安定化されました。fetch APIの振る舞いをカスタマイズするために利用できます。

### `deno lsp`

#### `useUnknownInCatchVariables`の有効化

[Deno本体での`useUnknownInCatchVariables`の有効化]({{< ref "articles/2024/09/08.md" >}})に併せて、`deno lsp`でも`useUnknownInCatchVariables`が有効化されました。

---

- [feat(lsp): turn on useUnknownInCatchVariables #25474](https://github.com/denoland/deno/pull/25474)

### `deno jupyter`

#### `--unstable-*`のサポート

`deno jupyter`コマンドに`--unstable-*`関連の引数が指定できない問題が解消されています。

---

- [fix(jupyter): allow unstable flags #25483](https://github.com/denoland/deno/pull/25483)

### Node.js互換性の改善

#### `deno add`

##### `--dev`オプションのサポート

`deno add`コマンドに`--dev`オプションが追加されています。このオプションが指定された場合、もし`package.json`があれば`devDependencies`に依存を追加してくれます。

---

- [feat(add/install): Flag to add dev dependency to package.json #25495](https://github.com/denoland/deno/pull/25495)

##### `package.json`が存在する場合の振る舞いの変更

`deno add`でnpmパッケージを追加する際に、もし`package.json`があれば、`deno.json`ではなく`package.json`へ依存が書き込まれるように振る舞いが変更されています。

---

- [feat(add): Add npm packages to package.json if present #25477](https://github.com/denoland/deno/pull/25477)

#### ESM形式のモジュールの`require()`

ESM形式のモジュールの`require`による読み込みがサポートされています。

該当のモジュールでTop-level awaitが使われていると、エラーが発生します。

また、`.mts`形式のモジュールの`require`についてはまだサポートが入っていないようです。

---

- [feat: require(esm) #25501](https://github.com/denoland/deno/pull/25501)

#### BYONM

[BYONM]({{< ref "articles/deno/v1.38.md" >}})が有効化されていると、[`--unstable-bare-node-builtins`]({{< ref "articles/deno/v1.38.md" >}})を指定していなくてもNode.jsの組み込みパッケージが`node:`なしでも読み込めてしまう問題が修正されています。

---

- [fix(node/byonm): do not accidentally resolve bare node built-ins #25543](https://github.com/denoland/deno/pull/25543)

#### `node:os`

Linuxで`freemem()`がバイト単位で値を返すように修正されています (元々はKB単位で値が返却されていたようです)

---

- [fix(ext/node): report freemem() on Linux in bytes #25511](https://github.com/denoland/deno/pull/25511)

#### `node:stream`

`Stream`が`EventEmitter`のインスタンスとなるよう修正されています。

---

- [fix(ext/node): Stream should be instance of EventEmitter #25527](https://github.com/denoland/deno/pull/25527)

#### `node:v8`

`serialize`と`deserialize`が再実装されています。

これに伴い、[Support Parcel #20613](https://github.com/denoland/deno/issues/20613)がクローズされており、Parcelが動かせるようになる可能性がありそうです。

---

- [fix(ext/node): Rewrite `node:v8` serialize/deserialize #25439](https://github.com/denoland/deno/pull/25439)

#### `node:fs`

`FileHandle#writeFile`が実装されました。

---

- [fix(ext/node): add `FileHandle#writeFile` #25555](https://github.com/denoland/deno/pull/25555)

### `Float16Array`に関する型定義の修正

`Float16Array`に関する型の名前が誤って`Float16`と定義されていた問題が修正されています。

---

- [fix: Float16Array type #25506](https://github.com/denoland/deno/pull/25506)
