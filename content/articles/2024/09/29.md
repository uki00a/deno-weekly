---
title: 2024/09/23〜2024/09/29の最新情報
tags:
  - Deno
categories:
  - news
date: 2024-09-29
description: Deno v2.0.0-rc.5とv2.0.0-rc.6がリリース
---

## Deno v2.0.0-rc.5 

- [`v2.0.0-rc.4`から`v2.0.0-rc.5`までの差分](https://github.com/denoland/deno/compare/dad5678baa0c96a40810f9af820145041fb8f98e...ba5b8d0213cde2585236098b00beb8a512889626)

### 破壊的変更

#### `deno.json`

`deno.json`の`importMap`オプションでのリモートのImport mapsを指定が廃止されました。(もし需要があれば、今後、よりセキュアな方法によって再度サポートを導入することも考慮されているようです)

`--import-map`などでは引き続きリモートのImport mapsが指定できるので、そちらへの移行が推奨されます。

---

- [BREAKING: remove support for remote import maps in deno.json #25836](https://github.com/denoland/deno/pull/25836)

#### `Deno.UnsafeWindowSurface`

`Deno.UnsafeWindowSurface`の`constructor`のシグネチャーが変更されています。引数として単一の`options`引数を受け取るように変更されており、必須のオプションとして`width`と`height`が追加されています。

この変更に合わせて、[`GPUCanvasConfiguration`](https://github.com/denoland/deno/blob/v1.46.3/cli/tsc/dts/lib.deno_webgpu.d.ts#L1785)から`width`と`height`プロパティーが削除されています。

---

- [BREAKING(webgpu/unstable): move `width` and `height` options to `UnsafeWindowSurface` constructor #24200](https://github.com/denoland/deno/pull/24200)

### `deno fmt`

#### HTML/CSS/YAMLサポートの安定化

[Deno v1.46]({{< ref "articles/deno/v1.46.md" >}})で導入された`deno fmt`のCSS/HTML/YAMLサポートが安定化されました。`--unstable-css`などのオプションや`deno.json`での`"unstable": ["fmt-html"]`の指定などをせずとも、これらの形式のファイルがフォーマットされます。

---

- [feat(fmt): stabilize CSS, HTML and YAML formatters #25753](https://github.com/denoland/deno/pull/25753)

#### `deno fmt --check`

CSS/HTML/YAML形式のファイルに対して`deno fmt --check`を実行すると、常にエラーとして扱われてしまう問題も修正されています。

---

- [fix(fmt): --check was broken for CSS, YAML and HTML #25848](https://github.com/denoland/deno/pull/25848)

#### NunjucksとVentoのサポート

`deno fmt`で[`.njk`](https://github.com/mozilla/nunjucks)と[`.vto`](https://github.com/ventojs/vento)形式がサポートされています。これらの形式のファイルをフォーマットするには`--unstable-component`の指定が必要です。

---

- [feat(fmt): support vto and njk extensions #25831](https://github.com/denoland/deno/pull/25831)

### Node.js互換性の改善

#### `--node-modules-dir`

`--node-modules-dir`オプションに値が指定されなかった場合、`--node-modules-dir`が無視されてしまっていた問題が修正されています。`auto`がデフォルト値として使われます。

---

- [fix(cli): Default to auto with --node-modules-dir flag #25772](https://github.com/denoland/deno/pull/25772)

#### 静的解析が困難なCJSモジュールの取り扱いが改善

静的な解析が困難なCJSファイルの`import`時にエラーが発生する問題が改善されています。

主に[Rsbuild](https://github.com/web-infra-dev/rsbuild)の動作に向けた対応のようです。

---

- [fix(node): Don't error out if we fail to statically analyze CJS re-export #25748](https://github.com/denoland/deno/pull/25748)

#### Conditional exportsサポートの改善

[Conditional exports](https://github.com/nodejs/node/blob/v22.9.0/doc/api/packages.md#conditional-exports)で`"node"`に指定されたパスが解釈されるよう振る舞いが改善されています。

これがサポートされていなかったことで、`nuxt build`によって生成されたサーバーをDenoで動かせない問題があったようです。

---

- [fix(node): Include "node" condition during CJS re-export analysis #25785](https://github.com/denoland/deno/pull/25785)

#### `require(esm)`

[ESM形式のモジュールを`require`]({{< ref "articles/2024/09/15.md" >}})しようとするとパニックすることがある問題が改善されています。

---

- [fix: panic when require(esm) #25769](https://github.com/denoland/deno/pull/25769)

### CLI

サブコマンドよりも前の位置にDenoのCLI引数(`--allow-net`など)が指定された際に、エラーが発生するように振る舞いが改善されています (今までは単純に無視されていたようです)

```shell
$ deno --allow-read run main.js
error: unexpected argument '--allow-read' found

  tip: 'run --allow-read' exists

Usage: deno run [OPTIONS] [SCRIPT_ARG]...
```

---

- [fix: error out if a valid flag is passed before a subcommand #25830](https://github.com/denoland/deno/pull/25830)

### Web API

#### `globalThis.location`

`globalThis.location`が`configurable: true`に変更されています。主にVitest 2の動作に向けた対応のようです。

---

- [feat: make 'globalThis.location' a configurable property #25812](https://github.com/denoland/deno/pull/25812)

#### Web Crypto API

`SubtleCrypto`の`importKey`と`exportKey`でP521 EC鍵がサポートされています。

---

- [feat(ext/crypto): import and export p521 keys #25789](https://github.com/denoland/deno/pull/25789)
