---
title: 2024/04/22〜2024/04/28の最新情報
tags:
  - Deno
  - deno_std
categories:
  - news
date: 2024-04-28
description: Deno v1.43.0について (deno serve, V8コードキャッシュなど)
---

## Deno v1.43.0について

Deno v1.43.0は先週にリリース予定だったものの、[延期されることになりました。](https://github.com/denoland/deno/issues/23557)

ただし、直近でv1.43.0向けと思われる機能がいくつか入っていたので紹介します。以下のバージョンの時点での動作を想定していますが、正式にリリースされる際に仕様などが変わる可能性があります。

```shell
$ deno --version
deno 1.43.0+e3d79c1 (canary, x86_64-unknown-linux-gnu)
v8 12.4.254.12
typescript 5.4.3
```

### `deno serve`コマンド

[`deno serve`](https://github.com/denoland/deno-docs/commit/4be6406069a98d92fbc7ad9f5c12f9173e672738)コマンドが追加されています。

以下のように`fetch`関数を実装したオブジェクトを`default export`したファイルを用意します。
        
```typescript
// main.ts
export default {
  fetch(req) {
    return new Response("OK");
  },
};
```

このファイルを指定して`deno serve`コマンドを実行すると、HTTPサーバーが起動されます。
        
```shell
$ deno serve main.ts
deno serve: Listening on http://localhost:8000/

$ curl http://localhost:8000
OK
```

ポートはデフォルトで`8000`が使用されますが、--port`オプションで変更が可能です。

### `Deno.serve`で`Request.signal`がサポート

`Deno.serve`のハンドラーに渡されれる`Request`オブジェクトで[`signal`](https://developer.mozilla.org/en-US/docs/Web/API/Request/signal)プロパティがサポートされています。先程の`deno serve`コマンドでも利用可能です。

```typescript
export default {
  fetch(req: Request) {
    // レスポンスがクライアントへ送信されると`abort`が発火します
    req.signal.addEventListener("abort", () => console.info("aborted"));
    return new Promise<void>((resolve) => {
      setTimeout(() => {
        resolve(new Response("OK"));
      }, 5000);
    });
  },
};
```
        
### V8コードキャッシュ

[V8によって生成されたコードキャッシュを永続化する仕組み](https://github.com/denoland/deno/pull/23081)が導入されています。

この仕組みはデフォルトで有効化されており、任意で`--no-code-cache`を指定することで無効化できるようです。
V8が生成したコードキャッシュは、`DENO_DIR`配下に`v8_code_cache_v1`というSQLiteデータベースファイルが作られ、そこで管理されるようです。

---

- https://github.com/thlorenz/v8-perf/blob/eab80c8ba242b7b25a0e2a5a4845f79d181d3d4a/snapshots%2Bcode-caching.md#code-caching

### その他

[`UnsafeWindowSurface`でのWaylandのサポート](https://github.com/denoland/deno/pull/23423)や[`Float16Array`の実験的なサポート](https://github.com/denoland/deno/pull/23490)などが追加されています。

---

- https://github.com/denoland/deno/compare/0a7f46b8c29d67b579e4ffd4681aa5d0b7e30c6b...8321106b78abf63233fc78f55b47dc5ebc4997e9
- https://github.com/denoland/deno/blob/8321106b78abf63233fc78f55b47dc5ebc4997e9/Releases.md
