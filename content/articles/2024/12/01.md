---
title: 2024/11/25〜2024/12/01の最新情報
tags:
  - Deno
  - deno_std
  - Bun
categories:
  - news
date: 2024-12-01
description: >
  Deno v2.1.2
---

## Deno v2.1.2

### WASMモジュール

`.wasm`モジュール内の関数以外の要素がサポートされています。

---

- [fix: support non-function exports in Wasm modules #26992](https://github.com/denoland/deno/pull/26992)

### `deno check` - JSDocの`@import`タグのサポート

`.js`ファイルにおける`@import`タグによる型チェックがサポートされています。

---

- [fix(check): support jsdoc `@import` tag #26991](https://github.com/denoland/deno/pull/26991)

### `deno fmt --check` - `.sql`に対してエラーが発生する問題の修正

[`.sql`ファイル]({{< ref "articles/deno/v2.1.md" >}})に対して`deno fmt --check`を実行すると、常にエラーが発生する問題が修正されています。

---

- [fix(fmt): Return None if sql fmt result is the same #27014](https://github.com/denoland/deno/pull/27014)

### `deno init --npm`

#### scopedパッケージのサポート

[`deno init --npm`]({{< ref "articles/deno/v2.1.md" >}})でscopeパッケージがサポートされています (例: `deno init --npm @foo/bar`を実行すると、`@foo/create-bar`パッケージが実行されます)

---

- [fix(init): support scoped npm packages #27128](https://github.com/denoland/deno/pull/27128)

#### `node_modules`のセットアップ

[`deno init --npm`]({{< ref "articles/deno/v2.1.md" >}})の実行時に`node_modules`が作成されるよう挙動が改善されています。

---

- [fix(init): always force managed node modules #27047](https://github.com/denoland/deno/pull/27047)

### `deno lsp`

#### `.wasm`モジュールサポートの改善

`import`宣言の補完時に`.wasm`モジュールが候補として含まれるよう改善されています。

---

- [fix(lsp): wasm file import completions #27018](https://github.com/denoland/deno/pull/27018)

#### `deno task`のオブジェクト形式のタスクがサポート

`deno lsp`が`deno task`の[オブジェクト形式のタスクの定義]({{< ref "articles/deno/v2.1.md" >}})を認識できるよう改善されています。

---

- [fix(lsp): support task object notation for tasks request #27076](https://github.com/denoland/deno/pull/27076)

### `deno compile --include`に関するバグ修正

#### `Deno.FsFile#read`などのサポート

埋め込まれたファイルの`Deno.FsFile#read`などでの読み込みが行えない問題が修正されています。

---

- [fix(compile): correct buffered reading of assets and files #27008](https://github.com/denoland/deno/pull/27008)

#### TypeScriptファイルを埋め込むとエラーが発生する問題が修正

TypeScriptファイルが埋め込まれた場合、実行可能ファイルの実行時にエラーが起きる問題も修正されています。

---

- [fix(compile): handle TypeScript file included as asset #27032](https://github.com/denoland/deno/pull/27032)

### `deno task` - `description`フィールドの取り扱いの改善

引数なしで`deno task`を実行した際に、[`description`]({{< ref "articles/deno/v2.1.md" >}})に改行やANSIエスケープコードなどが含まれる説明が適切に表示されるよう改善されています。

---

- [fix(task): handle multiline descriptions properly #27069](https://github.com/denoland/deno/pull/27069)
- [fix(task): handle carriage return in task description #27099](https://github.com/denoland/deno/pull/27099)
- [fix(task): strip ansi codes and control chars when printing tasks #27100](https://github.com/denoland/deno/pull/27100)

### `deno publish` - `bun:`のサポート

`bun:sqlite`などのBunの組み込みパッケージに依存したモジュールを`deno publish`で公開できるよう改善されています。

---

- [fix: support bun specifiers in JSR publish #24588](https://github.com/denoland/deno/pull/24588)

### `deno info` - ワークスペースサポートの改善

`deno info`コマンドでワークスペースのメンバーを参照するbare specifierが適切に解決されるよう改善されています。

---

- [fix(info): resolve bare specifier pointing to workspace member #27020](https://github.com/denoland/deno/pull/27020)

### Deno APIに関するバグ修正

#### `Deno.upgradeWebSocket`

`Deno.upgradeWebSocket`を呼んだ後に`Request.bodyUsed`を参照するとエラーが発生する問題が修正されています。

---

- [fix(ext/fetch): don't throw when `bodyUsed` inspect after upgrade #27088](https://github.com/denoland/deno/pull/27088)

#### `Deno.watchFs`

対象ファイルが削除された際に、適切に`remove`イベントが発火されなくなっていた問題が修正されています。

---

- [fix(runtime/ops): Fix watchfs remove event #27041](https://github.com/denoland/deno/pull/27041)

### Web API

#### `WebSocket#send`の挙動の変更

すでに切断されている状態で`WebSocket#send`が呼ばれた際に、例外が発生しないよう挙動が修正されています。

---

- [fix(ext/websocket): don't throw exception when sending to closed socket #26932](https://github.com/denoland/deno/pull/26932)

#### `ReadableStream.from`の型定義の改善

`ReadableStream.from`の引数として文字列を渡せないよう型定義が改善されています。

---

- [fix(streams): reject `string` in `ReadableStream.from` type #25116](https://github.com/denoland/deno/pull/25116)

### Node.js互換性の改善

#### `--unstable-detect-cjs`の再導入

[Deno v2.1.0]({{< ref "articles/deno/v2.1.md" >}})で安定化された`--unstable-detect-cjs`が再導入されています。

このオプションを指定すると、`package.json`が存在しない場合 または `package.json`で`type`が定義されていない場合でも、`.js`や`.ts`などのモジュールをCommonJS形式として読み込めます。

---

- [feat(unstable): repurpose `--unstable-detect-cjs` to attempt loading more modules as cjs #27094](https://github.com/denoland/deno/pull/27094)

#### CommonJSサポートの改善

CommonJS形式モジュールからdynamic importが使われている場合、`package.json`の`exports.require`が常に読み込まれる問題が修正されています。

---

- [fix(node): correct resolution of dynamic import of esm from cjs #27071](https://github.com/denoland/deno/pull/27071)

#### `node:tls`

`connect()`に`socket`オプションを渡すとエラーが発生する問題が修正されています。

---

- [fix(ext/node): `tls.connect` socket upgrades #27125](https://github.com/denoland/deno/pull/27125)

#### `node:fs/promises`

`stat()`と`FileHandle#stat`が実装されています。

---

- [fix(ext/node): add `fs.promises.fstat` and `FileHandle#stat` #26719](https://github.com/denoland/deno/pull/26719)

#### `node:fs`

`stat()`で引数に対するバリデーションが適切に行われるよう改善されています。

---

- [fix(node/fs): add missing stat path argument validation #27086](https://github.com/denoland/deno/pull/27086)

#### `node:http`

`ServerResponse#hasHeader`において、与えられたヘッダー名を正規化してからヘッダーの存在を確認するように挙動が改善されています。

---

- [fix(node/http): casing ignored in ServerResponse.hasHeader() #27105](https://github.com/denoland/deno/pull/27105)

#### `node:timers`

`clearTimeout`/`clearInterval`の引数として`number`型の値がサポートされています。

---

- [fix(node/timers): error when passing id to clearTimeout/clearInterval #27130](https://github.com/denoland/deno/pull/27130)

### TypeScript

#### `resolution-mode`属性のサポート

TypeScriptの[`resolution-mode`属性](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-3.html#stable-support-resolution-mode-in-import-types)のサポートが追加されています。

---

- [fix(node): correct resolution of dynamic import of esm from cjs #27071](https://github.com/denoland/deno/pull/27071)
