---
title: Deno v2.5
tags:
  - Deno
categories:
  - release
date: 2025-09-14
description: Deno v2.5がリリース
---

## はじめに

Deno v2.5がリリースされました。

この記事では主な変更点などについて解説します。

### `deno bundle`

### `Deno.bundle()`APIが追加

`deno bundle`コマンドの機能をプログラムから利用するための`Deno.bundle()`APIが正式にリリースされました ([#29949](https://github.com/denoland/deno/pull/29949))

`Deno.bundle()`の詳細については[`articles/2025/09/07`のページ]({{< ref "articles/2025/09/07.md" >}})を参照いただければと思います。

### HTMLエントリーポイントのサポート

`deno bundle`でHTMLエントリーポイントのサポートが追加されています ([#29856](https://github.com/denoland/deno/pull/29856))

例として、バンドル対象のHTMLとJavaScriptモジュールを準備しておきます。

```html
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
</head>
<body>
  <script type="module" src="./index.tsx"></script>
</body>
</html>
```

```tsx
// index.tsx
import { render } from "preact";

function App() {
  return (
    <main>
      Hello Deno!
    </main>
  );
}

render(<App />, document.body);
```

Preactがきちんと動作するよう`deno.json`に設定を追加しておきます。

```json
{
  "imports": {
    "preact": "npm:preact@10.27.1",
    "@std/http": "jsr:@std/http@1.0.20"
  },
  "compilerOptions": {
    "jsx": "react-jsx",
    "jsxImportSource": "preact",
    "lib": [
      "dom",
      "dom.asynciterable",
      "dom.iterable"
    ]
  },
  "exclude": ["dist"]
}
```

この状態でHTMLファイルを引数に指定して`deno bundle`を実行すると、`--outdir`ディレクトリにバンドル結果が出力されます。

```shell
$ deno bundle --unstable-bundle --outdir=dist index.html
⚠️  deno bundle is experimental and subject to changes
Bundled 4 modules in 43ms
  dist/index-2G6XNFTT.js 15.73KB
  dist/index.html        166B

# `deno_std`のファイルサーバー (`@std/http/file-server`) で結果を確認できます
$ deno run --allow-read --allow-net @std/http/file-server dist
```

### `deno lint`

### `no-import-prefix`ルール

`no-import-prefix`ルールが追加されています ([#30598](https://github.com/denoland/deno/pull/30598))

以下のように`jsr:`や`npm:`付きの`import`の使用が検出されると、エラーが発生します。

```javascript
import { delay } from "jsr:@std/async@^1/delay";
```

`deno.json`または`package.json`で依存パッケージを管理することを促すためのルールのようです。

### `no-unversioned-import`ルール

`no-unversioned-import`ルールが追加されています ([#30609](https://github.com/denoland/deno/pull/30609))

以下のように、バージョンが明示されていない`import`を検出してくれます。

```javascript
import { delay } from "jsr:@std/async/delay";
```

## `deno fmt`

### 引数なしで`deno fmt`を実行した際の振る舞いが変更

`deno.json`および`package.json`が存在しない状態で`deno fmt`を実行すると、以下の確認メッセージが表示されるよう挙動が変更されています ([#30623](https://github.com/denoland/deno/pull/30623))

```shell
$ deno fmt
Warning It looks like you're not in a workspace. Are you sure you want to format the entire '/path/to/current-dir' directory? [Y/n]
```

### `import`/`export`への`fmt.spaceSurroundingProperties`のサポート

`deno.json`における`"fmt.spaceSurroundingProperties": false`の設定が`import`および`export`にも適用されるよう改善されました ([#30371](https://github.com/denoland/deno/pull/30371))

```json
{
  "fmt": {
    "spaceSurroundingProperties": false
  }
}
```

```javascript
// 1. フォーマット前
import { delay } from "jsr:@std/async@^1/delay";

// 2. フォーマット後
import {delay} from "jsr:@std/async@^1/delay";
```

### `deno install`/`deno add`

### 出力内容の改善

[Deno v2.4.5]({{< ref "articles/2025/08/24.md" >}})における`deno install`コマンドの出力の改善に続いて、パッケージのインストールに要した時間やキャッシュから再利用されたパッケージ数なども表示されるよう改善されています ([#30615](https://github.com/denoland/deno/pull/30615))

```shell
$ deno install
Installed 9 packages in 1631ms
Reused 0 packages from cache
Downloaded 9 packages from JSR
+++++++++
Downloaded 0 packages from npm

Dependencies:
+ jsr:@david/dax 0.41.0
+ jsr:@david/which 0.4.1
+ jsr:@std/assert 0.221.0
+ jsr:@std/bytes 0.221.0
+ jsr:@std/fmt 0.221.0
+ jsr:@std/fs 0.221.0
+ jsr:@std/io 0.221.0
+ jsr:@std/path 0.221.0
+ jsr:@std/streams 0.221.0
```

また、このインストール結果の表示機能を引数付きの`deno install`や`deno add`, `deno cache`コマンドなどにも導入する改善が実施されています ([#30549](https://github.com/denoland/deno/pull/30549))

### ライフサイクルスクリプトに関する警告メッセージの改善

ライフサイクルスクリプトを提供するnpmパッケージをインストールした際の警告メッセージが改善されています ([#30527](https://github.com/denoland/deno/pull/30527))

```shell
$ deno add npm:better-sqlite3@12.2.0
Add npm:better-sqlite3@12.2.0
╭ Warning
│
│  Ignored build scripts for packages:
│  npm:better-sqlite3@12.2.0
│
│  Lifecycle scripts are only supported when using a `node_modules` directory.
│  Enable it in your deno config file:
│  "nodeModulesDir": "auto"
╰─
```

### jsrパッケージのインストールに関するバグ修正

`deno.json`でjsrパッケージのバージョンを更新した状態で引数なしで`deno install`が実行された際に、該当jsrパッケージの更新後のバージョンをインストールするよう挙動が修正されています ([#30483](https://github.com/denoland/deno/pull/30483))

## `deno run`/`deno task`

### 引数なしで実行した際のタスクの一覧表示機能が再導入

[Deno v2.0.0-rc.3]({{< ref "articles/2024/09/22.md" >}})で Revert されていた引数なしで`deno run`コマンドが実行された際に`deno.json`で定義されたタスクの一覧を表示する機能が再導入されました ([#30592](https://github.com/denoland/deno/pull/30592))

### タスク名とディレクトリ名の衝突時の挙動が改善

`deno run <task>`で指定したタスク名と同じ名前のディレクトリが存在する場合、エラーが発生してしまう問題が修正されています ([#29538](https://github.com/denoland/deno/pull/29538))。この場合、`deno.json`で定義されたタスクの方が実行されます。

### `--env-file`と`--watch`を併用した際の挙動の改善

`--env-file`と`--watch`の併用時に、`.env`ファイルが変更された際にプロセスの再起動と`.env`ファイルの再読み込みが行われるよう改善されています ([#30197](https://github.com/denoland/deno/pull/30197))

### `--preload`で複数のファイルを読み込ませる際の挙動の変更

[`--preload`]({{< ref "articles/deno/v2.4.md" >}})オプションに`data:`URLを指定できるようにするため、`--preload`オプションに複数のファイルをカンマ区切りで指定できないよう挙動が変更されています ([#30544](https://github.com/denoland/deno/pull/30544))

`--preload`オプションで複数のファイルを読み込ませたい場合、今後は`--preload`オプションを複数回指定する必要がありそうです。

### `deno check`

主にSvelteKit向けの動作の改善が実施されているようです。

### `tsconfig.json` - `compilerOptions.rootDirs`のサポート

`deno check`コマンドで[`tsconfig.json`]({{< ref "articles/deno/v2.4.md" >}})に記載された`compilerOptions.rootDirs`がサポートされています ([#30495](https://github.com/denoland/deno/pull/30495))

### `compilerOptions.moduleResolution: "bundler"`のサポート

 [`compilerOptions.moduleResolution: "bundler"`](https://www.typescriptlang.org/docs/handbook/release-notes/typescript-5-0.html#--moduleresolution-bundler)がサポートされています。`compilerOptions.module`に`esnext`または`preserve`が指定された際は、`compilerOptions.moduleResolution`のデフォルト値として`bundler`が使用されるよう実装されています ([#30603](https://github.com/denoland/deno/pull/30603))

## `deno publish`

### `import.meta.resolve`の取り扱いの改善

静的に解析可能な`import.meta.resolve()`の引数が正規化 (_unfurl_) されるよう改善されています ([#30663](https://github.com/denoland/deno/pull/30663))

具体的には、パッケージの公開時に以下のような変換が実施されるようです。

```javascript
// 1. `deno publish`の実行前
import.meta.resolve("preact");

// 2. `deno publish`によるJSRへの公開後 (Import mapsの内容に基づいて、specifierが正規化されます)
import.meta.resolve("npm:preact@10.27.1");
```

## `deno lsp`

### ワークスペースメンバーの取り扱いの改善

ワークスペース内のメンバーのImport mapsで定義されたエントリーへのauto importがサポートされています ([#30667](https://github.com/denoland/deno/pull/30667))

### ファイルリネーム時の挙動の改善

あるファイルを別ディレクトリへ移動した際の`import`の書き換えが適切に動作するよう改善されています ([#30628](https://github.com/denoland/deno/pull/30628))

### `deno init`

### `--npm`オプション指定時の依存関係の取り扱いの変更

`deno init --npm`の実行時にカレントディレクトリではなく`/tmp/deno_init_nm/<date>/<random>`に作成した一時的な`node_modules`ディレクトリを利用するよう挙動が変更されています ([#30492](https://github.com/denoland/deno/pull/30492))

その他のパッケージマネージャーも同様の実装をしているようで、それにあわせることなどが目的のようです。

## Deno API

### `Deno.ChildProcess.{stdout,stderr}`への`Response`ライクな問い合わせメソッドの追加

`Deno.ChildProcess.stdout`と`Deno.ChildProcess.stderr`に以下の4つのメソッドが追加されています:

- `arrayBuffer`
- `bytes`
- `json`
- `text`

[`Response`](https://developer.mozilla.org/en-US/docs/Web/API/Response)ライクに子プロセスの出力内容を問い合わせることができます。

```javascript
const command = new Deno.Command(Deno.execPath(), {
  args: ["json_reference"],
  stdout: "piped",
}).spawn();
const json = await command.stdout.json();
```

---

- **公式ドキュメント**: https://github.com/denoland/docs/commit/37bb3db3d38e00a5de69617421919e5204633593

### `Deno.test`への`before*`/`after*`フックのサポート

以下の4つのAPIが追加されています:

- `Deno.test.beforeAll()`
- `Deno.test.afterAll()`
- `Deno.test.beforeEach()`
- `Deno.test.afterEach()`

VitestやJestなどと同様に、これらのAPIを利用することで該当モジュールにおける各テストケースの実行前後に特定の処理を実行することができます:

```javascript
Deno.test.beforeEach(() => setup());
Deno.test.afterEach(() => teardown());
Deno.test("doSomethingAsync", async () => {
  await doSomethingAsync();
  // ...
});
```

---

- **公式ドキュメント**: https://github.com/denoland/docs/commit/dc96c8aa5e8070d8ab21913bb8cd64fb874af497

### `tcpBacklog`オプションの追加

[Deno v2.4.5]({{< ref "articles/2025/08/24.md" >}})におけるTCPソケットの`backlog`パラメータの変更に続けて、以下のAPIに`tcpBacklog`オプションが追加されています ([#30541](https://github.com/denoland/deno/pull/30541))

- `Deno.serve()`
- `Deno.listen()`
- `Deno.listenTls()`

`tcpBacklog`オプションのデフォルト値は`511`です。

### `unsafelyDisableHostnameVerification`オプションの追加

`Deno.connectTls()`と`Deno.startTls()`に`unsafelyDisableHostnameVerification`オプションが追加されています ([#30409](https://github.com/denoland/deno/pull/30409))

このオプションに`true`を設定すると、ホスト名の検証が無効化されます。

### `Deno.QuicListener`に関する破壊的変更

[`Deno.QuicListener`]({{< ref "articles/2025/01/12.md" >}})が`Deno.QuicConn`ではなく`Deno.QuicIncoming`を`yield`するように修正されています ([#30150](https://github.com/denoland/deno/pull/30150))

## 参考

- https://deno.com/blog/v2.5
- https://github.com/denoland/deno/releases/tag/v2.5.0
