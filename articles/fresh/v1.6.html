<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>fresh v1.6 | 週刊Deno</title><meta name=keywords content="fresh,Preact,Tailwind CSS"><meta name=description content="fresh v1.6がリリース。Tailwind CSSの公式サポート, FreshContext型の導入, Partialsでの<form>やリダイレクトのサポート, プラグインからのIslandコンポーネントや静的アセットの提供などがサポートされています。"><meta name=author content><link rel=canonical href=https://uki00a.github.io/deno-weekly/articles/fresh/v1.6.html><link crossorigin=anonymous href=/deno-weekly/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/deno-weekly/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://uki00a.github.io/deno-weekly/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://uki00a.github.io/deno-weekly/favicon-32x32.png><link rel=apple-touch-icon href=https://uki00a.github.io/deno-weekly/apple-touch-icon.png><link rel=mask-icon href=https://uki00a.github.io/deno-weekly/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta property="twitter:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta name=twitter:site content="@uki00a"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MK2K2MRMBF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MK2K2MRMBF",{anonymize_ip:!1})}</script><meta property="og:title" content="fresh v1.6"><meta property="og:description" content="fresh v1.6がリリース。Tailwind CSSの公式サポート, FreshContext型の導入, Partialsでの<form>やリダイレクトのサポート, プラグインからのIslandコンポーネントや静的アセットの提供などがサポートされています。"><meta property="og:type" content="article"><meta property="og:url" content="https://uki00a.github.io/deno-weekly/articles/fresh/v1.6.html"><meta property="article:section" content="articles"><meta property="article:published_time" content="2023-12-03T00:00:00+00:00"><meta property="article:modified_time" content="2023-12-03T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="fresh v1.6"><meta name=twitter:description content="fresh v1.6がリリース。Tailwind CSSの公式サポート, FreshContext型の導入, Partialsでの<form>やリダイレクトのサポート, プラグインからのIslandコンポーネントや静的アセットの提供などがサポートされています。"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"fresh v1.6","item":"https://uki00a.github.io/deno-weekly/articles/fresh/v1.6.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"fresh v1.6","name":"fresh v1.6","description":"fresh v1.6がリリース。Tailwind CSSの公式サポート, FreshContext型の導入, Partialsでのやリダイレクトのサポート, プラグインからのIslandコンポーネントや静的アセットの提供などがサポートされています。","keywords":["fresh","Preact","Tailwind CSS"],"articleBody":"fresh v1.6がリリースされました。\nこの記事では主な変更点などについて解説します。\nTailwind CSSの公式サポート fresh公式でTailwind CSSのサポートが導入されました。\nTailwind CSSプラグイン (plugins/tailwind.ts)が追加されています。\n// fresh.config.ts import { defineConfig } from \"$fresh/server.ts\";  import tailwind from \"$fresh/plugins/tailwind.ts\";  export default defineConfig({  plugins: [tailwind()], }); 本番環境での利用について このTailwind CSSプラグインをDeno Deployで利用する場合は、事前ビルドとの併用が必須になるためご注意ください。\nこのプラグインを導入した状態でdeno task buildを実行すると、_fresh/staticにCSSファイルが生成されるため、Deno Deployではこちらが利用される想定です。(_fresh/staticについては後述します。また、本番ビルド時に生成されるCSSファイルはcssnanoで最適化されます)\n新規プロジェクトへの導入について freshのinit.tsでプロジェクトを初期化する際に、Tailwind CSSの有効化がサポートされています。\n既存プロジェクトへの導入方法 deno.jsonで公式で推奨されるバージョンのTailwind CSSを読み込むよう設定します。 ($fresh/src/dev/imports.ts)\n{  \"imports\": {  // ... 省略 ...  \"tailwindcss\": \"npm:tailwindcss@3.3.5\",  \"tailwindcss/\": \"npm:/tailwindcss@3.3.5/\",  \"tailwindcss/plugin\": \"npm:/tailwindcss@3.3.5/plugin.js\"  },  // ... 省略 ... } 次にTailwind CSSの設定ファイルをルートディレクトリに配置します。ファイル名はtailwind.config.ts/tailwind.config.js/tailwind.config.mjsのいずれかである必要があります。\n// tailwind.config.ts import type { Config } from \"tailwindcss\";  export default {  content: [  \"{routes,islands}/**/*.{ts,tsx}\",  ], } as Config; 次にstatic/styles.cssに配置します。\n/* 必要に応じてカスタマイズします... */ @tailwind base; @tailwind components; @tailwind utilities; このCSSファイルを読み込ませるため、routes/_app.tsxなどにを記載します。\nimport { PageProps } from \"$fresh/server.ts\";  export default function App({ Component }: PageProps) {  return (  html  head  link rel=\"stylesheet\" href=\"/styles.css\" /  {/* ...省略... */}  head  {/* ...省略... */  html  ); } 次にfresh.config.tsからTailwind CSSプラグインを読み込むよう設定をします。\n// fresh.config.ts import { defineConfig } from \"$fresh/server.ts\";  import tailwind from \"$fresh/plugins/tailwind.ts\";  export default defineConfig({  plugins: [tailwind()], }); これでTailwind CSSが動作するようになるはずです。開発時はこれ以外には特に作業は不要で、本番環境(Deno Deploy)で使用する際は事前ビルド(deno task build)の導入が必要になります。\n型定義の単純化 FreshContextの導入 FreshContextという新しい型が導入されています。\nこれに伴い、HandlerやMiddlewareHandlerなどのctx引数に渡される型がFreshContextに変更されています。\nまた、以下の各型がFreshContextをベースに再定義されました。(以下のうちRouteContext以外の型は非推奨化されていて、今後はFreshContextの使用が推奨されます)\n HandlerContext RouteContext AppContext LayoutContext UnknownHandlerContext ErrorHandlerContext MiddlewareHandlerContext  FreshContextについて FreshContextはconfigプロパティを持っており、freshの設定を参照することができます。\nまた、FreshContextのpatternプロパティは非推奨化されており、今後はrouteプロパティの使用が推奨されます。\n各コンポーネントのpropsの単純化 PagePropsが先程のFreshContextをベースに再定義されています。(render/next/renderNotFoundプロパティは除外されています)\nまた、AppProps/LayoutProps/UnknownPageProps/ErrorPagePropsの4つの型がPagePropsに統合されました。(これら4つの型は非推奨化されています)\nPartials fresh v1.5で導入されたPartialsに関する改善が実施されています。\nのサポート submitイベントが発生したとき、対象のまたはsubmitterでf-client-navが有効化されていれば、Partialによるクライアントサイドナビゲーションが適用されます。\nこの際、以下の優先度に従って、submitを処理するためのエンドポイントが決定されます。\n submitterのf-partial属性 submitterのformaction属性 のf-partial属性 のaction属性  エンドポイントへHTTPリクエストを送信する際は、またはsubmitterで指定されたHTTPメソッドに応じて、GETまたはPOSTのいずれかが送信されます。(GETの場合はクエリパラメータ、POSTの場合はリクエストボディにの内容が設定されます)\nのネストがサポート をネストできるようになりました。親側のが更新されると、子側のも更新されます。\nただし、子側のが更新された際は、親側はは更新されないようです。\nfunction Page() {  return (  Partial name=\"outer\"  Partial name=\"inner\"  {/* ... */}  Partial  Partial  ); } isPartial PagePropsなどのFreshContextをベースとした型にisPartialプロパティが追加されています。\nによるクライアントナビゲーション時のリクエストではtrueが設定されるため、レスポンスの内容を最適化する際などに利用できそうです。\nexport default function DocPage(props: PagePropsData) {  if (props.isPartial) {  return Content content={props.data.content} /;  } else {  return (    Head  link rel=\"stylesheet\" href=\"/styles.css\" /  Head  Content content={props.data.content} /    );  } }  function Content(props: { content: string }) {  return (  Partial name=\"docs-content\"  article  data-color-mode=\"auto\"  data-dark-theme=\"dark\"  class=\"p-4 mx-auto w-full markdown-body\"  dangerouslySetInnerHTML={{ __html: props.content }}  /  Partial  ); } その他の改善  によるクライアントサイドナビゲーションの発生時に、リダイレクトが処理されるように改善されました (fetch()の実行時にredirect: \"follow\"が設定されます) エラーページでが動作するように改善されました。例えば、存在しないページにアクセスした際に、現在のページのに該当するを_404.tsxが返却していれば、その内容で差し替えられます。  プラグインシステム プラグインからのIslandコンポーネントの提供がサポート プラグインからIslandコンポーネントの提供がサポートされました。\nislandsオプションにIslandコンポーネントのリンクを記載しておくことで、FreshがそれらのコンポーネントをIslandとして扱ってくれます。\nimport type { Plugin } from \"$fresh/server.ts\";  const counterPlugin: Plugin = {  name: \"counter\",  islands: {  baseLocation: \"https://deno.land/x/fresh@1.6.0/demo/islands/\",  paths: [\"./islands/Counter.tsx\"]  } }; buildStart/configResolvedフックにconfigが渡されるように PluginにconfigResolvedフックが追加されました。startに渡されたconfigの内容を受け取ることができ、configが解決されたタイミングで実行されます。また、事前ビルド時はbuildStartよりも前のタイミングで呼ばれます。\nまた、buildStartフックでも同様にconfigを受け取れるように改善されています。\nconst somePlugin: Plugin = {  name: \"some-plugin\",  buildStart(config) {  console.info(\"buildStart\", config);  },  configResolved(config) {  console.info(\"configResolved\", config);  }, }; PluginRenderResultにlinks/htmlTextが追加 Plugin#render(Async)が返却するPluginRenderResultに以下のプロパティが追加されました。\n   プロパティ 説明     links このプロパティが設定されていたら、その内容を元ににが挿入されます。   htmlText このプロパティが設定されていた場合、最終的に返却されるがその内容で置き換わります。    事前ビルド (deno task build) _fresh/staticのサポート freshが_fresh/staticに配置された静的なアセットを認識してくれるようになりました。\nここに置かれたファイルはstatic/ディレクトリに置かれたファイルよりも優先して配信してくれます。 基本的にはプラグイン(Plugin#buildStart)が静的ファイルを作成したい場合に利用されることが想定されているようで、前述したTailwind CSSプラグインでも、事前ビルド(deno task build)を実行すると、Tailwind CSSの本番ビルドによって生成されたCSSファイルが_fresh/staticに生成されます。\nServer  handlerなどからDeno.errors.NotFoundがthrowされた際も404ページ(_404.tsx)が表示されるように改善されました。 ルーティングのパフォーマンスが最適化されています。URLPatternではなく正規表現を使用することなどにより改善されているようです。 エラー発生時にfreshが表示するコードフレームを閉じられるように改善されました。(#2074)  開発時にユーザーが用意した_500.tsxがレンダリングされなくなってしまう課題があったようです。    Islands  islands/配下のファイルで関数以外の要素がexportされていた際にエラーが発生する問題が解消されました。 islands/配下のファイルをバンドルする際に、各Islandコンポーネントごとにバンドルを作成するのではなく、各ファイルごとにバンドルを作成するように修正されました。  fresh.config.ts router.basePathオプションが追加 アプリケーションがserveされる基準となるパスを変更可能で、例えば、以下の場合は、/subdir配下からアプリケーションが配信されます。\nimport { defineConfig } from \"$fresh/server.ts\";  export default defineConfig({  router: { basePath: \"/subdir\" }, }); Manifest (fresh.gen.ts)  fresh.gen.tsでのコンフリクトの発生を減らすように、routesやislandsに設定されるキーの名前が改善されました。  参考  https://github.com/denoland/fresh/releases/tag/1.6.0 Fresh 1.6: Tailwind CSS plugin, simplified typings and more  ","wordCount":"373","inLanguage":"en","datePublished":"2023-12-03T00:00:00Z","dateModified":"2023-12-03T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://uki00a.github.io/deno-weekly/articles/fresh/v1.6.html"},"publisher":{"@type":"Organization","name":"週刊Deno","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://uki00a.github.io/deno-weekly/ accesskey=h title="週刊Deno (Alt + H)">週刊Deno</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://uki00a.github.io/deno-weekly/tags.html title=タグ><span><i class="fa fa-heart"></i>タグ</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/categories.html title=カテゴリー><span><i class="fa fa-heart"></i>カテゴリー</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/gallery.html title=ギャラリー><span><i class="fa fa-road"></i>ギャラリー<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/index.xml title="RSS feed"><span><i class="fa fa-road"></i>RSS feed<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/about.html title=About><span><i class="fa fa-road"></i>About<span class=alert></span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>fresh v1.6</h1><div class=post-description>fresh v1.6がリリース。Tailwind CSSの公式サポート, FreshContext型の導入, Partialsでの&lt;form>やリダイレクトのサポート, プラグインからのIslandコンポーネントや静的アセットの提供などがサポートされています。</div><div class=post-meta><span title="2023-12-03 00:00:00 +0000 UTC">December 3, 2023</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#tailwind-css%e3%81%ae%e5%85%ac%e5%bc%8f%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label="Tailwind CSSの公式サポート">Tailwind CSSの公式サポート</a><ul><li><a href=#%e6%9c%ac%e7%95%aa%e7%92%b0%e5%a2%83%e3%81%a7%e3%81%ae%e5%88%a9%e7%94%a8%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=本番環境での利用について>本番環境での利用について</a></li><li><a href=#%e6%96%b0%e8%a6%8f%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%b8%e3%81%ae%e5%b0%8e%e5%85%a5%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=新規プロジェクトへの導入について>新規プロジェクトへの導入について</a></li><li><a href=#%e6%97%a2%e5%ad%98%e3%83%97%e3%83%ad%e3%82%b8%e3%82%a7%e3%82%af%e3%83%88%e3%81%b8%e3%81%ae%e5%b0%8e%e5%85%a5%e6%96%b9%e6%b3%95 aria-label=既存プロジェクトへの導入方法>既存プロジェクトへの導入方法</a></li></ul></li><li><a href=#%e5%9e%8b%e5%ae%9a%e7%be%a9%e3%81%ae%e5%8d%98%e7%b4%94%e5%8c%96 aria-label=型定義の単純化>型定義の単純化</a><ul><li><a href=#freshcontext%e3%81%ae%e5%b0%8e%e5%85%a5 aria-label=FreshContextの導入><code>FreshContext</code>の導入</a><ul><li><a href=#freshcontext%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=FreshContextについて><code>FreshContext</code>について</a></li></ul></li><li><a href=#%e5%90%84%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%aeprops%e3%81%ae%e5%8d%98%e7%b4%94%e5%8c%96 aria-label=各コンポーネントのpropsの単純化>各コンポーネントの<code>props</code>の単純化</a></li></ul></li><li><a href=#partials aria-label=Partials>Partials</a><ul><li><a href=#form%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=&amp;lt;form&amp;gt;のサポート><code>&lt;form></code>のサポート</a></li><li><a href=#partial%e3%81%ae%e3%83%8d%e3%82%b9%e3%83%88%e3%81%8c%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=&amp;lt;Partial&amp;gt;のネストがサポート><code>&lt;Partial></code>のネストがサポート</a></li><li><a href=#ispartial aria-label=isPartial><code>isPartial</code></a></li><li><a href=#%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e6%94%b9%e5%96%84 aria-label=その他の改善>その他の改善</a></li></ul></li><li><a href=#%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3%e3%82%b7%e3%82%b9%e3%83%86%e3%83%a0 aria-label=プラグインシステム>プラグインシステム</a><ul><li><a href=#%e3%83%97%e3%83%a9%e3%82%b0%e3%82%a4%e3%83%b3%e3%81%8b%e3%82%89%e3%81%aeisland%e3%82%b3%e3%83%b3%e3%83%9d%e3%83%bc%e3%83%8d%e3%83%b3%e3%83%88%e3%81%ae%e6%8f%90%e4%be%9b%e3%81%8c%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=プラグインからのIslandコンポーネントの提供がサポート>プラグインからのIslandコンポーネントの提供がサポート</a></li><li><a href=#buildstartconfigresolved%e3%83%95%e3%83%83%e3%82%af%e3%81%abconfig%e3%81%8c%e6%b8%a1%e3%81%95%e3%82%8c%e3%82%8b%e3%82%88%e3%81%86%e3%81%ab aria-label=buildStart/configResolvedフックにconfigが渡されるように><code>buildStart</code>/<code>configResolved</code>フックに<code>config</code>が渡されるように</a></li><li><a href=#pluginrenderresult%e3%81%ablinkshtmltext%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label=PluginRenderResultにlinks/htmlTextが追加><code>PluginRenderResult</code>に<code>links</code>/<code>htmlText</code>が追加</a></li></ul></li><li><a href=#%e4%ba%8b%e5%89%8d%e3%83%93%e3%83%ab%e3%83%89-deno-task-build aria-label="事前ビルド (deno task build)">事前ビルド (<code>deno task build</code>)</a><ul><li><a href=#_freshstatic%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=_fresh/staticのサポート><code>_fresh/static</code>のサポート</a></li></ul></li><li><a href=#server aria-label=Server>Server</a></li><li><a href=#islands aria-label=Islands>Islands</a></li><li><a href=#freshconfigts aria-label=fresh.config.ts><code>fresh.config.ts</code></a><ul><li><a href=#routerbasepath%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label=router.basePathオプションが追加><code>router.basePath</code>オプションが追加</a></li></ul></li><li><a href=#manifest-freshgents aria-label="Manifest (fresh.gen.ts)">Manifest (<code>fresh.gen.ts</code>)</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><p>fresh v1.6がリリースされました。</p><p>この記事では主な変更点などについて解説します。</p><h2 id=tailwind-cssの公式サポート>Tailwind CSSの公式サポート<a hidden class=anchor aria-hidden=true href=#tailwind-cssの公式サポート>#</a></h2><p>fresh公式でTailwind CSSのサポートが導入されました。</p><p>Tailwind CSSプラグイン (<a href=https://deno.land/x/fresh@1.6.0/plugins/tailwind.ts><code>plugins/tailwind.ts</code></a>)が追加されています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// fresh.config.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>defineConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/server.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>tailwind</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/plugins/tailwind.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineConfig</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>tailwind</span>()],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h3 id=本番環境での利用について>本番環境での利用について<a hidden class=anchor aria-hidden=true href=#本番環境での利用について>#</a></h3><p>このTailwind CSSプラグインを<a href=/deno-weekly/tags/deno-deploy.html>Deno Deploy</a>で利用する場合は、<a href=https://uki00a.github.io/deno-weekly/articles/fresh/v1.4.html>事前ビルド</a>との併用が必須になるためご注意ください。</p><p>このプラグインを導入した状態で<code>deno task build</code>を実行すると、<code>_fresh/static</code>にCSSファイルが生成されるため、Deno Deployではこちらが利用される想定です。(<a href=#_freshstaticのサポート>_fresh/static</a>については後述します。また、本番ビルド時に生成されるCSSファイルは<a href=https://github.com/cssnano/cssnano><code>cssnano</code></a>で最適化されます)</p><h3 id=新規プロジェクトへの導入について>新規プロジェクトへの導入について<a hidden class=anchor aria-hidden=true href=#新規プロジェクトへの導入について>#</a></h3><p>freshの<a href=https://github.com/denoland/fresh/blob/1.6.0/init.ts>init.ts</a>でプロジェクトを初期化する際に、Tailwind CSSの有効化がサポートされています。</p><h3 id=既存プロジェクトへの導入方法>既存プロジェクトへの導入方法<a hidden class=anchor aria-hidden=true href=#既存プロジェクトへの導入方法>#</a></h3><p><code>deno.json</code>で公式で推奨されるバージョンのTailwind CSSを読み込むよう設定します。 (<a href=https://github.com/denoland/fresh/blob/1.6.0/src/dev/imports.ts#L23-L29>$fresh/src/dev/imports.ts</a>)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;imports&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// ... 省略 ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;tailwindcss&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;npm:tailwindcss@3.3.5&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;tailwindcss/&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;npm:/tailwindcss@3.3.5/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;tailwindcss/plugin&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;npm:/tailwindcss@3.3.5/plugin.js&#34;</span>
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ... 省略 ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><p>次にTailwind CSSの設定ファイルをルートディレクトリに配置します。ファイル名は<code>tailwind.config.ts</code>/<code>tailwind.config.js</code>/<code>tailwind.config.mjs</code>のいずれかである必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#75715e>// tailwind.config.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Config</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;tailwindcss&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>content</span><span style=color:#f92672>:</span> [
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;{routes,islands}/**/*.{ts,tsx}&#34;</span>,
</span></span><span style=display:flex><span>  ],
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>as</span> <span style=color:#a6e22e>Config</span>;
</span></span></code></pre></div><p>次に<code>static/styles.css</code>に配置します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-css data-lang=css><span style=display:flex><span><span style=color:#75715e>/* 必要に応じてカスタマイズします... */</span>
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>base</span>;
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>components</span>;
</span></span><span style=display:flex><span>@<span style=color:#66d9ef>tailwind</span> <span style=color:#f92672>utilities</span>;
</span></span></code></pre></div><p>このCSSファイルを読み込ませるため、<code>routes/_app.tsx</code>などに<code>&lt;link></code>を記載します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>PageProps</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/server.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>App</span>({ <span style=color:#a6e22e>Component</span> }<span style=color:#f92672>:</span> <span style=color:#a6e22e>PageProps</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/styles.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>        {<span style=color:#75715e>/* ...省略... */</span>}
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>head</span>&gt;
</span></span><span style=display:flex><span>      {<span style=color:#75715e>/* ...省略... */</span>
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>html</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>次に<code>fresh.config.ts</code>からTailwind CSSプラグインを読み込むよう設定をします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>// fresh.config.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>defineConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/server.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#a6e22e>tailwind</span> <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/plugins/tailwind.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineConfig</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>plugins</span><span style=color:#f92672>:</span> [<span style=color:#a6e22e>tailwind</span>()],
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><p>これでTailwind CSSが動作するようになるはずです。開発時はこれ以外には特に作業は不要で、本番環境(Deno Deploy)で使用する際は事前ビルド(<code>deno task build</code>)の導入が必要になります。</p><h2 id=型定義の単純化>型定義の単純化<a hidden class=anchor aria-hidden=true href=#型定義の単純化>#</a></h2><h3 id=freshcontextの導入><code>FreshContext</code>の導入<a hidden class=anchor aria-hidden=true href=#freshcontextの導入>#</a></h3><p><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=FreshContext"><code>FreshContext</code></a>という新しい型が導入されています。</p><p>これに伴い、<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=Handler"><code>Handler</code></a>や<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=MiddlewareHandler"><code>MiddlewareHandler</code></a>などの<code>ctx</code>引数に渡される型が<code>FreshContext</code>に変更されています。</p><p>また、以下の各型が<code>FreshContext</code>をベースに再定義されました。(以下のうち<code>RouteContext</code>以外の型は非推奨化されていて、今後は<code>FreshContext</code>の使用が推奨されます)</p><ul><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=HandlerContext"><code>HandlerContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=RouteContext"><code>RouteContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=AppContext"><code>AppContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=LayoutContext"><code>LayoutContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=UnknownHandlerContext"><code>UnknownHandlerContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=ErrorHandlerContext"><code>ErrorHandlerContext</code></a></li><li><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=MiddlewareHandlerContext"><code>MiddlewareHandlerContext</code></a></li></ul><h4 id=freshcontextについて><code>FreshContext</code>について<a hidden class=anchor aria-hidden=true href=#freshcontextについて>#</a></h4><p><code>FreshContext</code>は<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=ResolvedFreshConfig"><code>config</code></a>プロパティを持っており、freshの設定を参照することができます。</p><p>また、<code>FreshContext</code>の<code>pattern</code>プロパティは非推奨化されており、今後は<code>route</code>プロパティの使用が推奨されます。</p><h3 id=各コンポーネントのpropsの単純化>各コンポーネントの<code>props</code>の単純化<a hidden class=anchor aria-hidden=true href=#各コンポーネントのpropsの単純化>#</a></h3><p><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=PageProps"><code>PageProps</code></a>が先程の<code>FreshContext</code>をベースに再定義されています。(<code>render</code>/<code>next</code>/<code>renderNotFound</code>プロパティは除外されています)</p><p>また、<code>AppProps</code>/<code>LayoutProps</code>/<code>UnknownPageProps</code>/<code>ErrorPageProps</code>の4つの型が<code>PageProps</code>に統合されました。(これら4つの型は非推奨化されています)</p><h2 id=partials>Partials<a hidden class=anchor aria-hidden=true href=#partials>#</a></h2><p><a href=https://uki00a.github.io/deno-weekly/articles/fresh/v1.5.html>fresh v1.5</a>で導入された<strong>Partials</strong>に関する改善が実施されています。</p><h3 id=formのサポート><code>&lt;form></code>のサポート<a hidden class=anchor aria-hidden=true href=#formのサポート>#</a></h3><p><code>submit</code>イベントが発生したとき、対象の<code>&lt;form></code>または<a href=https://developer.mozilla.org/en-US/docs/Web/API/SubmitEvent/submitter>submitter</a>で<code>f-client-nav</code>が有効化されていれば、Partialによるクライアントサイドナビゲーションが適用されます。</p><p>この際、以下の優先度に従って、<code>submit</code>を処理するためのエンドポイントが決定されます。</p><ol><li><code>submitter</code>の<code>f-partial</code>属性</li><li><code>submitter</code>の<code>formaction</code>属性</li><li><code>&lt;form></code>の<code>f-partial</code>属性</li><li><code>&lt;form></code>の<code>action</code>属性</li></ol><p>エンドポイントへHTTPリクエストを送信する際は、<code>&lt;form></code>または<code>submitter</code>で指定されたHTTPメソッドに応じて、<code>GET</code>または<code>POST</code>のいずれかが送信されます。(<code>GET</code>の場合はクエリパラメータ、<code>POST</code>の場合はリクエストボディに<code>&lt;form></code>の内容が設定されます)</p><h3 id=partialのネストがサポート><code>&lt;Partial></code>のネストがサポート<a hidden class=anchor aria-hidden=true href=#partialのネストがサポート>#</a></h3><p><code>&lt;Partial></code>をネストできるようになりました。親側の<code>&lt;Partial></code>が更新されると、子側の<code>&lt;Partial></code>も更新されます。</p><p>ただし、子側の<code>&lt;Partial></code>が更新された際は、親側は<code>&lt;Partial></code>は更新されないようです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Page() {</span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Partial</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;outer&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>Partial</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;inner&#34;</span>&gt;
</span></span><span style=display:flex><span>        {<span style=color:#75715e>/* ... */</span>}
</span></span><span style=display:flex><span>      &lt;/<span style=color:#f92672>Partial</span>&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>Partial</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ispartial><code>isPartial</code><a hidden class=anchor aria-hidden=true href=#ispartial>#</a></h3><p><code>PageProps</code>などの<code>FreshContext</code>をベースとした型に<code>isPartial</code>プロパティが追加されています。</p><p><code>&lt;Partial></code>によるクライアントナビゲーション時のリクエストでは<code>true</code>が設定されるため、レスポンスの内容を最適化する際などに利用できそうです。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#66d9ef>function</span> <span style=color:#a6e22e>DocPage</span>(<span style=color:#a6e22e>props</span>: <span style=color:#66d9ef>PageProps</span>&lt;<span style=color:#f92672>Data</span>&gt;) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>isPartial</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> &lt;<span style=color:#f92672>Content</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>} /&gt;;
</span></span><span style=display:flex><span>  } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>      &lt;&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Head</span>&gt;
</span></span><span style=display:flex><span>          &lt;<span style=color:#f92672>link</span> <span style=color:#a6e22e>rel</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;stylesheet&#34;</span> <span style=color:#a6e22e>href</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;/styles.css&#34;</span> /&gt;
</span></span><span style=display:flex><span>        &lt;/<span style=color:#f92672>Head</span>&gt;
</span></span><span style=display:flex><span>        &lt;<span style=color:#f92672>Content</span> <span style=color:#a6e22e>content</span><span style=color:#f92672>=</span>{<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>content</span>} /&gt;
</span></span><span style=display:flex><span>      &lt;/&gt;
</span></span><span style=display:flex><span>    );
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>Content</span>(<span style=color:#a6e22e>props</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>content</span>: <span style=color:#66d9ef>string</span> }) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> (
</span></span><span style=display:flex><span>    &lt;<span style=color:#f92672>Partial</span> <span style=color:#a6e22e>name</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;docs-content&#34;</span>&gt;
</span></span><span style=display:flex><span>      &lt;<span style=color:#f92672>article</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>color</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>mode</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;auto&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>data</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>dark</span><span style=color:#960050;background-color:#1e0010>-</span><span style=color:#a6e22e>theme</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;dark&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>class</span><span style=color:#f92672>=</span><span style=color:#e6db74>&#34;p-4 mx-auto w-full markdown-body&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>dangerouslySetInnerHTML</span><span style=color:#f92672>=</span>{{ <span style=color:#a6e22e>__html</span>: <span style=color:#66d9ef>props.content</span> }}
</span></span><span style=display:flex><span>      /&gt;
</span></span><span style=display:flex><span>    &lt;/<span style=color:#f92672>Partial</span>&gt;
</span></span><span style=display:flex><span>  );
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=その他の改善>その他の改善<a hidden class=anchor aria-hidden=true href=#その他の改善>#</a></h3><ul><li><code>&lt;Partial></code>によるクライアントサイドナビゲーションの発生時に、リダイレクトが処理されるように改善されました (<code>fetch()</code>の実行時に<code>redirect: "follow"</code>が設定されます)</li><li>エラーページで<code>&lt;Partial></code>が動作するように改善されました。例えば、存在しないページにアクセスした際に、現在のページの<code>&lt;Partial name="xxx"></code>に該当する<code>&lt;Partial></code>を<code>_404.tsx</code>が返却していれば、その内容で差し替えられます。</li></ul><h2 id=プラグインシステム>プラグインシステム<a hidden class=anchor aria-hidden=true href=#プラグインシステム>#</a></h2><h3 id=プラグインからのislandコンポーネントの提供がサポート>プラグインからのIslandコンポーネントの提供がサポート<a hidden class=anchor aria-hidden=true href=#プラグインからのislandコンポーネントの提供がサポート>#</a></h3><p>プラグインからIslandコンポーネントの提供がサポートされました。</p><p><code>islands</code>オプションにIslandコンポーネントのリンクを記載しておくことで、FreshがそれらのコンポーネントをIslandとして扱ってくれます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>import</span> <span style=color:#66d9ef>type</span> { <span style=color:#a6e22e>Plugin</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/server.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>counterPlugin</span>: <span style=color:#66d9ef>Plugin</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;counter&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>islands</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>baseLocation</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;https://deno.land/x/fresh@1.6.0/demo/islands/&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>paths</span><span style=color:#f92672>:</span> [<span style=color:#e6db74>&#34;./islands/Counter.tsx&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=buildstartconfigresolvedフックにconfigが渡されるように><code>buildStart</code>/<code>configResolved</code>フックに<code>config</code>が渡されるように<a hidden class=anchor aria-hidden=true href=#buildstartconfigresolvedフックにconfigが渡されるように>#</a></h3><p><a href="https://deno.land/x/fresh@1.6.0/server.ts?s=Plugin">Plugin</a>に<code>configResolved</code>フックが追加されました。<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=start">start</a>に渡された<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=ResolvedFreshConfig"><code>config</code></a>の内容を受け取ることができ、<code>config</code>が解決されたタイミングで実行されます。また、事前ビルド時は<code>buildStart</code>よりも前のタイミングで呼ばれます。</p><p>また、<code>buildStart</code>フックでも同様に<code>config</code>を受け取れるように改善されています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>somePlugin</span>: <span style=color:#66d9ef>Plugin</span> <span style=color:#f92672>=</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;some-plugin&#34;</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>buildStart</span>(<span style=color:#a6e22e>config</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;buildStart&#34;</span>, <span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>configResolved</span>(<span style=color:#a6e22e>config</span>) {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;configResolved&#34;</span>, <span style=color:#a6e22e>config</span>);
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>};
</span></span></code></pre></div><h3 id=pluginrenderresultにlinkshtmltextが追加><code>PluginRenderResult</code>に<code>links</code>/<code>htmlText</code>が追加<a hidden class=anchor aria-hidden=true href=#pluginrenderresultにlinkshtmltextが追加>#</a></h3><p><code>Plugin#render(Async)</code>が返却する<a href="https://deno.land/x/fresh@1.6.0/server.ts?s=PluginRenderResult"><code>PluginRenderResult</code></a>に以下のプロパティが追加されました。</p><table><thead><tr><th style=text-align:center>プロパティ</th><th style=text-align:center>説明</th></tr></thead><tbody><tr><td style=text-align:center><code>links</code></td><td style=text-align:center>このプロパティが設定されていたら、その内容を元に<code>&lt;head></code>に<code>&lt;link></code>が挿入されます。</td></tr><tr><td style=text-align:center><code>htmlText</code></td><td style=text-align:center>このプロパティが設定されていた場合、最終的に返却される<code>&lt;body></code>がその内容で置き換わります。</td></tr></tbody></table><h2 id=事前ビルド-deno-task-build>事前ビルド (<code>deno task build</code>)<a hidden class=anchor aria-hidden=true href=#事前ビルド-deno-task-build>#</a></h2><h3 id=_freshstaticのサポート><code>_fresh/static</code>のサポート<a hidden class=anchor aria-hidden=true href=#_freshstaticのサポート>#</a></h3><p>freshが<code>_fresh/static</code>に配置された静的なアセットを認識してくれるようになりました。</p><p>ここに置かれたファイルは<code>static/</code>ディレクトリに置かれたファイルよりも優先して配信してくれます。
基本的にはプラグイン(<strong><code>Plugin#buildStart</code></strong>)が静的ファイルを作成したい場合に利用されることが想定されているようで、前述したTailwind CSSプラグインでも、事前ビルド(<code>deno task build</code>)を実行すると、Tailwind CSSの本番ビルドによって生成されたCSSファイルが<code>_fresh/static</code>に生成されます。</p><h2 id=server>Server<a hidden class=anchor aria-hidden=true href=#server>#</a></h2><ul><li><code>handler</code>などから<code>Deno.errors.NotFound</code>が<code>throw</code>された際も404ページ(<code>_404.tsx</code>)が表示されるように改善されました。</li><li>ルーティングのパフォーマンスが最適化されています。<code>URLPattern</code>ではなく正規表現を使用することなどにより改善されているようです。</li><li>エラー発生時にfreshが表示するコードフレームを閉じられるように改善されました。(<a href=https://github.com/denoland/fresh/pull/2074>#2074</a>)<ul><li>開発時にユーザーが用意した<code>_500.tsx</code>がレンダリングされなくなってしまう課題があったようです。</li></ul></li></ul><h2 id=islands>Islands<a hidden class=anchor aria-hidden=true href=#islands>#</a></h2><ul><li><code>islands/</code>配下のファイルで関数以外の要素が<code>export</code>されていた際にエラーが発生する問題が解消されました。</li><li><code>islands/</code>配下のファイルをバンドルする際に、各Islandコンポーネントごとにバンドルを作成するのではなく、各ファイルごとにバンドルを作成するように修正されました。</li></ul><h2 id=freshconfigts><code>fresh.config.ts</code><a hidden class=anchor aria-hidden=true href=#freshconfigts>#</a></h2><h3 id=routerbasepathオプションが追加><code>router.basePath</code>オプションが追加<a hidden class=anchor aria-hidden=true href=#routerbasepathオプションが追加>#</a></h3><p>アプリケーションがserveされる基準となるパスを変更可能で、例えば、以下の場合は、<code>/subdir</code>配下からアプリケーションが配信されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-tsx data-lang=tsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>defineConfig</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;$fresh/server.ts&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>export</span> <span style=color:#66d9ef>default</span> <span style=color:#a6e22e>defineConfig</span>({
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>router</span><span style=color:#f92672>:</span> { <span style=color:#a6e22e>basePath</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;/subdir&#34;</span> },
</span></span><span style=display:flex><span>});
</span></span></code></pre></div><h2 id=manifest-freshgents>Manifest (<code>fresh.gen.ts</code>)<a hidden class=anchor aria-hidden=true href=#manifest-freshgents>#</a></h2><ul><li><code>fresh.gen.ts</code>でのコンフリクトの発生を減らすように、<code>routes</code>や<code>islands</code>に設定されるキーの名前が改善されました。</li></ul><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://github.com/denoland/fresh/releases/tag/1.6.0>https://github.com/denoland/fresh/releases/tag/1.6.0</a></li><li><a href=https://deno.com/blog/fresh-1.6>Fresh 1.6: Tailwind CSS plugin, simplified typings and more</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://uki00a.github.io/deno-weekly/tags/fresh.html>fresh</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/preact.html>Preact</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/tailwind-css.html>Tailwind CSS</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://uki00a.github.io/deno-weekly/>週刊Deno</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>