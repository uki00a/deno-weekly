<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deno v1.40 | 週刊Deno</title><meta name=keywords content="Deno,Deno Cron,deno_sdl2,dwm,jsr"><meta name=description content="Temporalサポート, Decorators proposal (stage 3)のサポート, Import Mapsで`npm:`URLのマッピングを定義する際の挙動の改善, deno checkでのunstable APIに関する挙動の変更, windowやrid関連のAPIなどの非推奨化, Unixドメインソケットサポートなどの安定化, External WebGPU surfaces / BYOW (Bring your own Window), deno lintで`no-console`ルールがサポート, import.meta.filename/dirname, deno.lockにworkspaceセクションが追加"><meta name=author content><link rel=canonical href=https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html><link crossorigin=anonymous href=/deno-weekly/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/deno-weekly/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://uki00a.github.io/deno-weekly/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://uki00a.github.io/deno-weekly/favicon-32x32.png><link rel=apple-touch-icon href=https://uki00a.github.io/deno-weekly/apple-touch-icon.png><link rel=mask-icon href=https://uki00a.github.io/deno-weekly/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta property="twitter:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta name=twitter:site content="@uki00a"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MK2K2MRMBF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MK2K2MRMBF",{anonymize_ip:!1})}</script><meta property="og:title" content="Deno v1.40"><meta property="og:description" content="Temporalサポート, Decorators proposal (stage 3)のサポート, Import Mapsで`npm:`URLのマッピングを定義する際の挙動の改善, deno checkでのunstable APIに関する挙動の変更, windowやrid関連のAPIなどの非推奨化, Unixドメインソケットサポートなどの安定化, External WebGPU surfaces / BYOW (Bring your own Window), deno lintで`no-console`ルールがサポート, import.meta.filename/dirname, deno.lockにworkspaceセクションが追加"><meta property="og:type" content="article"><meta property="og:url" content="https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html"><meta property="article:section" content="articles"><meta property="article:published_time" content="2024-01-28T00:00:00+00:00"><meta property="article:modified_time" content="2024-01-28T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deno v1.40"><meta name=twitter:description content="Temporalサポート, Decorators proposal (stage 3)のサポート, Import Mapsで`npm:`URLのマッピングを定義する際の挙動の改善, deno checkでのunstable APIに関する挙動の変更, windowやrid関連のAPIなどの非推奨化, Unixドメインソケットサポートなどの安定化, External WebGPU surfaces / BYOW (Bring your own Window), deno lintで`no-console`ルールがサポート, import.meta.filename/dirname, deno.lockにworkspaceセクションが追加"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deno v1.40","item":"https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deno v1.40","name":"Deno v1.40","description":"Temporalサポート, Decorators proposal (stage 3)のサポート, Import Mapsで`npm:`URLのマッピングを定義する際の挙動の改善, deno checkでのunstable APIに関する挙動の変更, windowやrid関連のAPIなどの非推奨化, Unixドメインソケットサポートなどの安定化, External WebGPU surfaces / BYOW (Bring your own Window), deno lintで`no-console`ルールがサポート, import.meta.filename/dirname, deno.lockにworkspaceセクションが追加","keywords":["Deno","Deno Cron","deno_sdl2","dwm","jsr"],"articleBody":"Deno v1.40がリリースされました。\nこの記事では主な変更点などについて解説します。\nTemporalサポート DenoでTemporal がサポートされました。利用するには--unstable-temporalの指定が必要です。\nTemporal.Now.instant(); 今のところTemporalのサポートはv2での安定化が検討されているようです。\nDecorators proposal (stage 3)のサポート ⚠️ V8でまだサポートされていない関係で.jsファイルではまだ動作しないようなためご注意 (.tsなどのトランスパイルされるファイルでのみ動作します)\nTypeScript v5で導入されたDecorators (stage 3)がDenoでもサポートされました。\nこれに伴い、今までデフォルトで有効化されていたTypeScriptのexperimentalDecoratorsは無効化されたため、もし利用したい場合はdeno.jsonで明示的に有効化する必要があります。\n{  \"compilerOptions\": {  \"experimentalDecorators\": true  } }  TypeScript5で導入されたStage 3のDecoratorを眺めてみる | 豆蔵デベロッパーサイト\ndeno.json importsでnpm:URLのマッピングを定義する際の挙動の改善 (Import map expansion) npmパッケージが提供するサブパスの読み込みに関する挙動が改善されています。\n例えば、deno.jsonでImport Mapsを定義しておき、npm:なしでmswとmsw/nodeを読み込みたい場面があったとします。\nimport { http, HttpResponse } from \"msw\"; import { setupServer } from \"msw/node\";  const server = setupServer(  http.get(`${location.origin}/api/user`, () =  HttpResponse.json({  id: 1,  name: \"foo\",  })), ); この場合、v1.39までは以下のように記述する必要がありました。\n{  \"imports\": {  \"msw\": \"npm:msw@2.0.8\",  \"msw/\": \"npm:/msw@2.0.8/\"  } } このリリースでは、以下のように記述しておくだけで、自動で対象パッケージのサブパスへの読み込みが行えるよう挙動が改善されました。\n{  \"imports\": {  \"msw\": \"npm:msw@2.0.8\"  } } deno check unstable APIに関する取り扱いの変更 deno checkなどにより型チェックを行う場合、もし対象のコードがunstable APIを利用しており、対象のAPIが--unstableオプションなどにより有効化されていないと型エラーが発生していました。\nこの挙動が変更され、型チェックを行う際は常にunstable APIが有効化されるようになりました。\nこの挙動は型チェック時のみに適用され、deno runなどでスクリプトを実行する場合は、今まで通り明示的にunstable APIの使用を許可する必要があります。\n非推奨化 --unstableオプション v1.38で--unstable-kvなどのオプションが導入され、有効化したいunstable APIをより細かく制御できるようになりました。\nこれに伴い--unstableオプションが非推奨化されました。使用した際は以下のような警告が表示されるため、各種--unstable-*オプションやdeno.jsonのunstableオプションによる管理への移行が推奨されます。\n⚠️ The `--unstable` flag is deprecated and will be removed in Deno 2.0. Use granular `--unstable-*` flags instead. window windowが非推奨化されました。今後はglobalThisまたはselfへの置き換えが推奨されます。\n以下のissueで解説されていますが、DenoでSSRなどを行いたい際に、windowが存在することにより、意図せずしてブラウザであると判定されてしまうことを避けたいことなどが背景のようです。\n remove window variable (#13367)\n deno lintを使うとwindowを使用している箇所が警告されるため、活用すると便利そうです。\nDeno API ridやDeno.Reader/Deno.Writerに関連したAPIなどが非推奨化されています。非推奨化されたAPIを使おうとすると、deno lintまたはそのAPIの使用時に警告が表示されます。\nwarning: Use of deprecated \"Deno.metrics()\" API. This API will be removed in Deno 2.    対象API 移行先     Deno.run Deno.Command   Deno.serveHttp Deno.serve   Deno.metrics --strace-ops   Deno.iter/Deno.iterSync    Deno.copy std/io/copy.ts   Deno.readAll/Deno.readAllSync std/io/read_all.ts   Deno.writeAll/Deno.writeAllSync std/io/write_all.ts   Deno.Buffer std/io/buffer.ts   Deno.FsWatcher.return Deno.FsWatcher.close   Deno.customInspect Symbol.for(\"Deno.customInspect\")   Deno.isatty Deno.{stdin,stdout,stderr}.isTerminal()   Deno.close Deno.FsFile.close/Deno.Conn.closeなど   Deno.resources なし (deno testはデフォルトでリソースリークのチェックを行ってくれるため、必要性が低いと判断されたようです。)   Deno.ftruncate/Deno.ftruncateSync Deno.FsFile.truncate/Deno.FsFile.truncateSync   Deno.{Conn,FsWatcher,FsFile,Listener,stdin,stdout,stderr}.rid 各種オブジェクトが提供するメソッドへの移行が推奨されています。   Deno.fstat/Deno.fstatSync Deno.FsFile.stat/Deno.FsFile.statSync   Deno.shutdown Deno.Conn.closeWrite   Deno.fsync/Deno.fsyncSync Deno.FsFile.sync/Deno.FsFile.syncSync   Deno.fdatasync/Deno.fdatasyncSync Deno.FsFile.dataSync/Deno.FsFile.dataSyncSync   Deno.futime/Deno.futimeSync Deno.FsFile.utime/Deno.FsFile.utimeSync   Deno.read/Deno.readSync 各種オブジェクトが提供するread/readSyncメソッド   Deno.write/Deno.writeSync 各種オブジェクトが提供するwrite/writeSyncメソッド   Deno.seek/Deno.seekSync Deno.FsFileのseek/seekSyncメソッド   Deno.ListenTlsOptions.certFile/Deno.ListenTlsOptions.keyFile cert/keyオプション   Deno.ConnectTlsOptions.certFile caCertsオプション    安定化 deno jupyter 利用にあたって--unstableオプションの指定が不要になりました。(機能自体はまだunstableという扱いのため、使用方法などに変更が入る可能性はあります。)\nDeno API 以下のAPIが安定化されています。--unstableなしで利用することができます。\n Deno.connect/Deno.listenのtransport: \"unix\"オプション(Unixドメインソケット) Deno.Connのref/unrefメソッド Deno.ConnectTlsOptionsのcertChain/privateKeyオプション Deno.TlsConn.handshakeメソッド  非推奨化された削除/APIの削除 以下の機能/APIが削除されました。\n --promptオプション (v1.19でパーミッションプロンプトの表示がデフォルト化されたため) Deno.upgradeHttp (今後はDeno.serveとDeno.upgradeWebSocketの使用が推奨されます) Deno.cron - 最後の引数としてoptionsを受け取る形式が削除されています。  https://deno.land/api@v1.39.4?unstable=\u0026s=Deno.cron https://deno.land/api@v1.40.0?unstable=\u0026s=Deno.cron    Web API rejectionhandledのサポート このイベントはunhandledrejectionでpreventDefaultを呼んだときのみ発火されるようになります。\n Window: rejectionhandled event - Web APIs | MDN\ncreateImageBitmap createImageBitmapが実装されています。\nExternal WebGPU surfaces / BYOW (Bring your own Window) Deno.UnsafeWindowSurfaceが追加されました。\ndeno_sdl2@0.8.0やdwm@0.3.4ではこの機能のサポートが追加されていて、これによりWebGPUを活用して高速にレンダリングが行えるようです。\n  wgui - Tiny UI framework for Deno GPUCanvasContext - Web APIs | MDN  deno lint no-consoleルールが実装 consoleを使用している箇所に対して警告をしてくれます。デフォルトでは無効化されているため、必要な際はdeno.jsonなどで明示的に有効化する必要があります。\n{  \"lint\": {  \"rules\": { \"include\": [\"no-console\"]}  } } ディレクティブへの補足説明の記述がサポート deno lintのディレクティブに説明文が書けるように改善されています。--に続けて、対象のルールを無効化する背景や意図などを書くことができます。\n// some_script.ts try {  await doTask(); } catch (error) {  // deno-lint-ignore no-console -- This is intended.  console.error(error);  Deno.exit(1); }   https://github.com/denoland/deno_lint/releases/tag/0.53.0 https://github.com/denoland/deno_lint/releases/tag/0.54.0 https://github.com/denoland/deno_lint/releases/tag/0.55.0  deno lint/deno docの出力フォーマットの改善 deno lintなどのコマンドの出力フォーマットが改善されています。今後、deno checkにも同様の変更が入る予定とのことです。\nv1.40:\nerror[no-array-constructor]: Array Constructor is not allowed  -- /home/uki00a/ghq/github.com/uki00a/deno-samples/main.js:1:1  | 1 | new Array(123, 4, 5, 6);  | ^^^^^^^^^^^^^^^^^^^^^^^  = hint: Use array literal notation (e.g. []) or single argument specifying array size only (e.g. new Array(5)   docs: https://lint.deno.land/#no-array-constructor   Found 1 problem Checked 1 file v1.39:\n(no-array-constructor) Array Constructor is not allowed new Array(123, 4, 5, 6); ^^^^^^^^^^^^^^^^^^^^^^^  at /home/uki00a/ghq/github.com/uki00a/deno-samples/main.js:1:1   hint: Use array literal notation (e.g. []) or single argument specifying array size only (e.g. new Array(5)  help: for further information visit https://lint.deno.land/#no-array-constructor  Found 1 problem Checked 1 file import.meta.filename/import.meta.dirname console.info(import.meta.filename); // 現在のモジュールのファイル名 console.info(import.meta.dirname); // 現在のモジュールのファイルを含むディレクトリ名 リモートモジュール内で参照された場合、これらにはundefinedが設定されます。\ndeno.lockにworkspaceセクションが追加 deno.lockのworkspaceへプロジェクトが依存しているnpm/jsrパッケージの一覧を書き込む機能が追加されています。\n{  \"workspace\": {  \"dependencies\": [  \"npm:msw@2.0.8\"  ],  \"packageJson\": {  \"dependencies\": [  \"npm:chalk@5.3.0\"  ]  }  } } deno.jsonのimportsから依存されているnpm/jsrパッケージはworkspace.dependencies、\npackage.jsonで定義されている依存パッケージはworkspace.packageJsonに書き込まれるようです。\nまた、deno.json/package.jsonから特定のnpm/jsrパッケージの依存を削除すると、deno.lockのworkspaceセクションからも自動で削除されるようです。\nもしワークスペース機能を活用している場合は、workspace.members配下で同様にして各ワークスペースごとのnpm/jsrパッケージについて追跡されるようです。\n https://github.com/denoland/deno_lockfile/pull/13\nNode.js互換性の改善  node:process: rejectionhandledのサポートに合わせてrejectionHandledがサポートされています。 node:fs: promises.readFileを引数なしで呼ぶときちんとエラーが発生するように改善されました。 node:fs/promises: constantsが公開されました。 node:http: IncomingMessage.socketのremoteAddressとremotePortが設定されない問題が修正されました。  参考  Deno 1.40: Temporal API https://github.com/denoland/deno/releases/tag/v1.40.0  ","wordCount":"440","inLanguage":"en","datePublished":"2024-01-28T00:00:00Z","dateModified":"2024-01-28T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html"},"publisher":{"@type":"Organization","name":"週刊Deno","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://uki00a.github.io/deno-weekly/ accesskey=h title="週刊Deno (Alt + H)">週刊Deno</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://uki00a.github.io/deno-weekly/tags.html title=タグ><span><i class="fa fa-heart"></i>タグ</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/categories.html title=カテゴリー><span><i class="fa fa-heart"></i>カテゴリー</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/gallery.html title=ギャラリー><span><i class="fa fa-road"></i>ギャラリー<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/index.xml title="RSS feed"><span><i class="fa fa-road"></i>RSS feed<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/about.html title=About><span><i class="fa fa-road"></i>About<span class=alert></span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Deno v1.40</h1><div class=post-description>Temporalサポート, Decorators proposal (stage 3)のサポート, Import Mapsで`npm:`URLのマッピングを定義する際の挙動の改善, deno checkでのunstable APIに関する挙動の変更, windowやrid関連のAPIなどの非推奨化, Unixドメインソケットサポートなどの安定化, External WebGPU surfaces / BYOW (Bring your own Window), deno lintで`no-console`ルールがサポート, import.meta.filename/dirname, deno.lockにworkspaceセクションが追加</div><div class=post-meta><span title="2024-01-28 00:00:00 +0000 UTC">January 28, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#temporal%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=Temporalサポート><code>Temporal</code>サポート</a></li><li><a href=#decorators-proposal-stage-3%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label="Decorators proposal (stage 3)のサポート">Decorators proposal (stage 3)のサポート</a></li><li><a href=#denojson aria-label=deno.json><code>deno.json</code></a><ul><li><a href=#imports%e3%81%a7npmurl%e3%81%ae%e3%83%9e%e3%83%83%e3%83%94%e3%83%b3%e3%82%b0%e3%82%92%e5%ae%9a%e7%be%a9%e3%81%99%e3%82%8b%e9%9a%9b%e3%81%ae%e6%8c%99%e5%8b%95%e3%81%ae%e6%94%b9%e5%96%84-import-map-expansion aria-label="importsでnpm:URLのマッピングを定義する際の挙動の改善 (Import map expansion)"><code>imports</code>で<code>npm:</code>URLのマッピングを定義する際の挙動の改善 (Import map expansion)</a></li></ul></li><li><a href=#deno-check aria-label="deno check"><code>deno check</code></a><ul><li><a href=#unstable-api%e3%81%ab%e9%96%a2%e3%81%99%e3%82%8b%e5%8f%96%e3%82%8a%e6%89%b1%e3%81%84%e3%81%ae%e5%a4%89%e6%9b%b4 aria-label="unstable APIに関する取り扱いの変更">unstable APIに関する取り扱いの変更</a></li></ul></li><li><a href=#%e9%9d%9e%e6%8e%a8%e5%a5%a8%e5%8c%96 aria-label=非推奨化>非推奨化</a><ul><li><a href=#--unstable%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3 aria-label=--unstableオプション><code>--unstable</code>オプション</a></li><li><a href=#window aria-label=window><code>window</code></a></li><li><a href=#deno-api aria-label="Deno API">Deno API</a></li></ul></li><li><a href=#%e5%ae%89%e5%ae%9a%e5%8c%96 aria-label=安定化>安定化</a><ul><li><a href=#deno-jupyter aria-label="deno jupyter"><code>deno jupyter</code></a></li><li><a href=#deno-api-1 aria-label="Deno API">Deno API</a></li></ul></li><li><a href=#%e9%9d%9e%e6%8e%a8%e5%a5%a8%e5%8c%96%e3%81%95%e3%82%8c%e3%81%9f%e5%89%8a%e9%99%a4api%e3%81%ae%e5%89%8a%e9%99%a4 aria-label=非推奨化された削除/APIの削除>非推奨化された削除/APIの削除</a></li><li><a href=#web-api aria-label="Web API">Web API</a><ul><li><a href=#rejectionhandled%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=rejectionhandledのサポート><code>rejectionhandled</code>のサポート</a></li><li><a href=#createimagebitmap aria-label=createImageBitmap><code>createImageBitmap</code></a></li></ul></li><li><a href=#external-webgpu-surfaces--byow-bring-your-own-window aria-label="External WebGPU surfaces / BYOW (Bring your own Window)">External WebGPU surfaces / BYOW (Bring your own Window)</a></li><li><a href=#deno-lint aria-label="deno lint"><code>deno lint</code></a><ul><li><a href=#no-console%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%8c%e5%ae%9f%e8%a3%85 aria-label=no-consoleルールが実装><code>no-console</code>ルールが実装</a></li><li><a href=#%e3%83%87%e3%82%a3%e3%83%ac%e3%82%af%e3%83%86%e3%82%a3%e3%83%96%e3%81%b8%e3%81%ae%e8%a3%9c%e8%b6%b3%e8%aa%ac%e6%98%8e%e3%81%ae%e8%a8%98%e8%bf%b0%e3%81%8c%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=ディレクティブへの補足説明の記述がサポート>ディレクティブへの補足説明の記述がサポート</a></li><li><a href=#deno-lintdeno-doc%e3%81%ae%e5%87%ba%e5%8a%9b%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%83%e3%83%88%e3%81%ae%e6%94%b9%e5%96%84 aria-label="deno lint/deno docの出力フォーマットの改善"><code>deno lint</code>/<code>deno doc</code>の出力フォーマットの改善</a></li></ul></li><li><a href=#importmetafilenameimportmetadirname aria-label=import.meta.filename/import.meta.dirname><code>import.meta.filename</code>/<code>import.meta.dirname</code></a></li><li><a href=#denolock%e3%81%abworkspace%e3%82%bb%e3%82%af%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label=deno.lockにworkspaceセクションが追加><code>deno.lock</code>に<code>workspace</code>セクションが追加</a></li><li><a href=#nodejs%e4%ba%92%e6%8f%9b%e6%80%a7%e3%81%ae%e6%94%b9%e5%96%84 aria-label=Node.js互換性の改善>Node.js互換性の改善</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><p>Deno v1.40がリリースされました。</p><p>この記事では主な変更点などについて解説します。</p><h2 id=temporalサポート><code>Temporal</code>サポート<a hidden class=anchor aria-hidden=true href=#temporalサポート>#</a></h2><p>Denoで<a href=https://github.com/tc39/proposal-temporal><code>Temporal</code></a> がサポートされました。利用するには<code>--unstable-temporal</code>の指定が必要です。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#a6e22e>Temporal</span>.<span style=color:#a6e22e>Now</span>.<span style=color:#a6e22e>instant</span>();
</span></span></code></pre></div><p>今のところ<code>Temporal</code>のサポートはv2での安定化が検討されているようです。</p><h2 id=decorators-proposal-stage-3のサポート>Decorators proposal (stage 3)のサポート<a hidden class=anchor aria-hidden=true href=#decorators-proposal-stage-3のサポート>#</a></h2><p><strong>⚠️ V8でまだサポートされていない関係で<code>.js</code>ファイルではまだ動作しないようなためご注意 (<code>.ts</code>などのトランスパイルされるファイルでのみ動作します)</strong></p><p>TypeScript v5で導入された<a href=https://github.com/tc39/proposal-decorators>Decorators (stage 3)</a>がDenoでもサポートされました。</p><p>これに伴い、今までデフォルトで有効化されていたTypeScriptの<code>experimentalDecorators</code>は無効化されたため、もし利用したい場合は<code>deno.json</code>で明示的に有効化する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;compilerOptions&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;experimentalDecorators&#34;</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><p><a href=https://developer.mamezou-tech.com/blogs/2023/02/15/typescript5-decorator-intro/>TypeScript5で導入されたStage 3のDecoratorを眺めてみる | 豆蔵デベロッパーサイト</a></p><h2 id=denojson><code>deno.json</code><a hidden class=anchor aria-hidden=true href=#denojson>#</a></h2><h3 id=importsでnpmurlのマッピングを定義する際の挙動の改善-import-map-expansion><code>imports</code>で<code>npm:</code>URLのマッピングを定義する際の挙動の改善 (Import map expansion)<a hidden class=anchor aria-hidden=true href=#importsでnpmurlのマッピングを定義する際の挙動の改善-import-map-expansion>#</a></h3><p>npmパッケージが提供するサブパスの読み込みに関する挙動が改善されています。</p><p>例えば、<code>deno.json</code>でImport Mapsを定義しておき、<code>npm:</code>なしで<code>msw</code>と<code>msw/node</code>を読み込みたい場面があったとします。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>http</span>, <span style=color:#a6e22e>HttpResponse</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;msw&#34;</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>setupServer</span> } <span style=color:#a6e22e>from</span> <span style=color:#e6db74>&#34;msw/node&#34;</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>server</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>setupServer</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>http</span>.<span style=color:#a6e22e>get</span>(<span style=color:#e6db74>`</span><span style=color:#e6db74>${</span><span style=color:#a6e22e>location</span>.<span style=color:#a6e22e>origin</span><span style=color:#e6db74>}</span><span style=color:#e6db74>/api/user`</span>, () =&gt;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>HttpResponse</span>.<span style=color:#a6e22e>json</span>({
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>id</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>1</span>,
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;foo&#34;</span>,
</span></span><span style=display:flex><span>    })),
</span></span><span style=display:flex><span>);
</span></span></code></pre></div><p>この場合、v1.39までは以下のように記述する必要がありました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;imports&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;msw&#34;</span>: <span style=color:#e6db74>&#34;npm:msw@2.0.8&#34;</span>,
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;msw/&#34;</span>: <span style=color:#e6db74>&#34;npm:/msw@2.0.8/&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>このリリースでは、以下のように記述しておくだけで、自動で対象パッケージのサブパスへの読み込みが行えるよう挙動が改善されました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;imports&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;msw&#34;</span>: <span style=color:#e6db74>&#34;npm:msw@2.0.8&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=deno-check><code>deno check</code><a hidden class=anchor aria-hidden=true href=#deno-check>#</a></h2><h3 id=unstable-apiに関する取り扱いの変更>unstable APIに関する取り扱いの変更<a hidden class=anchor aria-hidden=true href=#unstable-apiに関する取り扱いの変更>#</a></h3><p><code>deno check</code>などにより型チェックを行う場合、もし対象のコードがunstable APIを利用しており、対象のAPIが<code>--unstable</code>オプションなどにより有効化されていないと型エラーが発生していました。</p><p>この挙動が変更され、型チェックを行う際は常にunstable APIが有効化されるようになりました。</p><p>この挙動は型チェック時のみに適用され、<code>deno run</code>などでスクリプトを実行する場合は、今まで通り明示的にunstable APIの使用を許可する必要があります。</p><h2 id=非推奨化>非推奨化<a hidden class=anchor aria-hidden=true href=#非推奨化>#</a></h2><h3 id=--unstableオプション><code>--unstable</code>オプション<a hidden class=anchor aria-hidden=true href=#--unstableオプション>#</a></h3><p><a href=https://uki00a.github.io/deno-weekly/articles/deno/v1.38.html>v1.38</a>で<code>--unstable-kv</code>などのオプションが導入され、有効化したいunstable APIをより細かく制御できるようになりました。</p><p>これに伴い<code>--unstable</code>オプションが非推奨化されました。使用した際は以下のような警告が表示されるため、各種<code>--unstable-*</code>オプションや<code>deno.json</code>の<code>unstable</code>オプションによる管理への移行が推奨されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>⚠️  The <span style=color:#e6db74>`</span>--unstable<span style=color:#e6db74>`</span> flag is deprecated and will be removed in Deno 2.0. Use granular <span style=color:#e6db74>`</span>--unstable-*<span style=color:#e6db74>`</span> flags instead.
</span></span></code></pre></div><h3 id=window><code>window</code><a hidden class=anchor aria-hidden=true href=#window>#</a></h3><p><code>window</code>が非推奨化されました。今後は<code>globalThis</code>または<code>self</code>への置き換えが推奨されます。</p><p>以下のissueで解説されていますが、DenoでSSRなどを行いたい際に、<code>window</code>が存在することにより、意図せずしてブラウザであると判定されてしまうことを避けたいことなどが背景のようです。</p><blockquote><p><a href=https://github.com/denoland/deno/issues/13367>remove window variable (#13367)</a></p></blockquote><p><code>deno lint</code>を使うと<code>window</code>を使用している箇所が警告されるため、活用すると便利そうです。</p><h3 id=deno-api>Deno API<a hidden class=anchor aria-hidden=true href=#deno-api>#</a></h3><p><code>rid</code>や<code>Deno.Reader</code>/<code>Deno.Writer</code>に関連したAPIなどが非推奨化されています。非推奨化されたAPIを使おうとすると、<code>deno lint</code>またはそのAPIの使用時に警告が表示されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>warning: Use of deprecated <span style=color:#e6db74>&#34;Deno.metrics()&#34;</span> API. This API will be removed in Deno 2.
</span></span></code></pre></div><table><thead><tr><th>対象API</th><th>移行先</th></tr></thead><tbody><tr><td><code>Deno.run</code></td><td><code>Deno.Command</code></td></tr><tr><td><code>Deno.serveHttp</code></td><td><code>Deno.serve</code></td></tr><tr><td><code>Deno.metrics</code></td><td><a href=https://uki00a.github.io/deno-weekly/articles/2023/11/19.html><code>--strace-ops</code></a></td></tr><tr><td><code>Deno.iter</code>/<code>Deno.iterSync</code></td><td></td></tr><tr><td><code>Deno.copy</code></td><td><a href=https://deno.land/std@0.213.0/io/copy.ts>std/io/copy.ts</a></td></tr><tr><td><code>Deno.readAll</code>/<code>Deno.readAllSync</code></td><td><a href=https://deno.land/std@0.213.0/io/read_all.ts>std/io/read_all.ts</a></td></tr><tr><td><code>Deno.writeAll</code>/<code>Deno.writeAllSync</code></td><td><a href=https://deno.land/std@0.213.0/io/write_all.ts>std/io/write_all.ts</a></td></tr><tr><td><code>Deno.Buffer</code></td><td><a href=https://deno.land/std@0.213.0/io/buffer.ts>std/io/buffer.ts</a></td></tr><tr><td><code>Deno.FsWatcher.return</code></td><td><code>Deno.FsWatcher.close</code></td></tr><tr><td><code>Deno.customInspect</code></td><td><code>Symbol.for("Deno.customInspect")</code></td></tr><tr><td><code>Deno.isatty</code></td><td><code>Deno.{stdin,stdout,stderr}.isTerminal()</code></td></tr><tr><td><code>Deno.close</code></td><td><code>Deno.FsFile.close</code>/<code>Deno.Conn.close</code>など</td></tr><tr><td><code>Deno.resources</code></td><td>なし (<code>deno test</code>はデフォルトでリソースリークのチェックを行ってくれるため、必要性が低いと判断されたようです。)</td></tr><tr><td><code>Deno.ftruncate</code>/<code>Deno.ftruncateSync</code></td><td><code>Deno.FsFile.truncate</code>/<code>Deno.FsFile.truncateSync</code></td></tr><tr><td><code>Deno.{Conn,FsWatcher,FsFile,Listener,stdin,stdout,stderr}.rid</code></td><td>各種オブジェクトが提供するメソッドへの移行が推奨されています。</td></tr><tr><td><code>Deno.fstat</code>/<code>Deno.fstatSync</code></td><td><code>Deno.FsFile.stat</code>/<code>Deno.FsFile.statSync</code></td></tr><tr><td><code>Deno.shutdown</code></td><td><code>Deno.Conn.closeWrite</code></td></tr><tr><td><code>Deno.fsync</code>/<code>Deno.fsyncSync</code></td><td><code>Deno.FsFile.sync</code>/<code>Deno.FsFile.syncSync</code></td></tr><tr><td><code>Deno.fdatasync</code>/<code>Deno.fdatasyncSync</code></td><td><code>Deno.FsFile.dataSync</code>/<code>Deno.FsFile.dataSyncSync</code></td></tr><tr><td><code>Deno.futime</code>/<code>Deno.futimeSync</code></td><td><code>Deno.FsFile.utime</code>/<code>Deno.FsFile.utimeSync</code></td></tr><tr><td><code>Deno.read</code>/<code>Deno.readSync</code></td><td>各種オブジェクトが提供する<code>read</code>/<code>readSync</code>メソッド</td></tr><tr><td><code>Deno.write</code>/<code>Deno.writeSync</code></td><td>各種オブジェクトが提供する<code>write</code>/<code>writeSync</code>メソッド</td></tr><tr><td><code>Deno.seek</code>/<code>Deno.seekSync</code></td><td><code>Deno.FsFile</code>の<code>seek</code>/<code>seekSync</code>メソッド</td></tr><tr><td><code>Deno.ListenTlsOptions.certFile</code>/<code>Deno.ListenTlsOptions.keyFile</code></td><td><code>cert</code>/<code>key</code>オプション</td></tr><tr><td><code>Deno.ConnectTlsOptions.certFile</code></td><td><code>caCerts</code>オプション</td></tr></tbody></table><h2 id=安定化>安定化<a hidden class=anchor aria-hidden=true href=#安定化>#</a></h2><h3 id=deno-jupyter><code>deno jupyter</code><a hidden class=anchor aria-hidden=true href=#deno-jupyter>#</a></h3><p>利用にあたって<code>--unstable</code>オプションの指定が不要になりました。(機能自体はまだunstableという扱いのため、使用方法などに変更が入る可能性はあります。)</p><h3 id=deno-api-1>Deno API<a hidden class=anchor aria-hidden=true href=#deno-api-1>#</a></h3><p>以下のAPIが安定化されています。<code>--unstable</code>なしで利用することができます。</p><ul><li><code>Deno.connect</code>/<code>Deno.listen</code>の<code>transport: "unix"</code>オプション(Unixドメインソケット)</li><li><code>Deno.Conn</code>の<code>ref</code>/<code>unref</code>メソッド</li><li><code>Deno.ConnectTlsOptions</code>の<code>certChain</code>/<code>privateKey</code>オプション</li><li><a href="https://deno.land/api@v1.40.0?unstable=&s=Deno.TlsConn"><code>Deno.TlsConn.handshake</code></a>メソッド</li></ul><h2 id=非推奨化された削除apiの削除>非推奨化された削除/APIの削除<a hidden class=anchor aria-hidden=true href=#非推奨化された削除apiの削除>#</a></h2><p>以下の機能/APIが削除されました。</p><ul><li><code>--prompt</code>オプション (<a href=https://uki00a.github.io/deno-weekly/articles/2022/02/20.html>v1.19</a>でパーミッションプロンプトの表示がデフォルト化されたため)</li><li><code>Deno.upgradeHttp</code> (今後は<code>Deno.serve</code>と<code>Deno.upgradeWebSocket</code>の使用が推奨されます)</li><li><code>Deno.cron</code> - 最後の引数として<code>options</code>を受け取る形式が削除されています。<ul><li><a href="https://deno.land/api@v1.39.4?unstable=&s=Deno.cron">https://deno.land/api@v1.39.4?unstable=&s=Deno.cron</a></li><li><a href="https://deno.land/api@v1.40.0?unstable=&s=Deno.cron">https://deno.land/api@v1.40.0?unstable=&s=Deno.cron</a></li></ul></li></ul><h2 id=web-api>Web API<a hidden class=anchor aria-hidden=true href=#web-api>#</a></h2><h3 id=rejectionhandledのサポート><code>rejectionhandled</code>のサポート<a hidden class=anchor aria-hidden=true href=#rejectionhandledのサポート>#</a></h3><p>このイベントは<code>unhandledrejection</code>で<code>preventDefault</code>を呼んだときのみ発火されるようになります。</p><hr><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/Window/rejectionhandled_event>Window: rejectionhandled event - Web APIs | MDN</a></p><h3 id=createimagebitmap><code>createImageBitmap</code><a hidden class=anchor aria-hidden=true href=#createimagebitmap>#</a></h3><p><a href=https://developer.mozilla.org/en-US/docs/Web/API/createImageBitmap><code>createImageBitmap</code></a>が実装されています。</p><h2 id=external-webgpu-surfaces--byow-bring-your-own-window>External WebGPU surfaces / BYOW (Bring your own Window)<a hidden class=anchor aria-hidden=true href=#external-webgpu-surfaces--byow-bring-your-own-window>#</a></h2><p><a href="https://deno.land/api@v1.40.0?unstable=&s=Deno.UnsafeWindowSurface"><code>Deno.UnsafeWindowSurface</code></a>が追加されました。</p><p><a href=https://github.com/littledivy/deno_sdl2/commit/41bd7173a1eae1b62ba57dfa6def816b1811abac>deno_sdl2@0.8.0</a>や<a href=https://github.com/deno-windowing/dwm/releases/tag/0.3.4>dwm@0.3.4</a>ではこの機能のサポートが追加されていて、これによりWebGPUを活用して高速にレンダリングが行えるようです。</p><hr><ul><li><a href=https://github.com/littledivy/wgui><code>wgui</code> - Tiny UI framework for Deno</a></li><li><a href=https://developer.mozilla.org/en-US/docs/Web/API/GPUCanvasContext>GPUCanvasContext - Web APIs | MDN</a></li></ul><h2 id=deno-lint><code>deno lint</code><a hidden class=anchor aria-hidden=true href=#deno-lint>#</a></h2><h3 id=no-consoleルールが実装><code>no-console</code>ルールが実装<a hidden class=anchor aria-hidden=true href=#no-consoleルールが実装>#</a></h3><p><code>console</code>を使用している箇所に対して警告をしてくれます。デフォルトでは無効化されているため、必要な際は<code>deno.json</code>などで明示的に有効化する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;lint&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;rules&#34;</span>: { <span style=color:#f92672>&#34;include&#34;</span>: [<span style=color:#e6db74>&#34;no-console&#34;</span>]}
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=ディレクティブへの補足説明の記述がサポート>ディレクティブへの補足説明の記述がサポート<a hidden class=anchor aria-hidden=true href=#ディレクティブへの補足説明の記述がサポート>#</a></h3><p><code>deno lint</code>のディレクティブに説明文が書けるように改善されています。<code>--</code>に続けて、対象のルールを無効化する背景や意図などを書くことができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#75715e>// some_script.ts
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>try</span> {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>doTask</span>();
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>catch</span> (<span style=color:#a6e22e>error</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// deno-lint-ignore no-console -- This is intended.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>error</span>(<span style=color:#a6e22e>error</span>);
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>Deno</span>.<span style=color:#a6e22e>exit</span>(<span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><hr><ul><li><a href=https://github.com/denoland/deno_lint/releases/tag/0.53.0>https://github.com/denoland/deno_lint/releases/tag/0.53.0</a></li><li><a href=https://github.com/denoland/deno_lint/releases/tag/0.54.0>https://github.com/denoland/deno_lint/releases/tag/0.54.0</a></li><li><a href=https://github.com/denoland/deno_lint/releases/tag/0.55.0>https://github.com/denoland/deno_lint/releases/tag/0.55.0</a></li></ul><h3 id=deno-lintdeno-docの出力フォーマットの改善><code>deno lint</code>/<code>deno doc</code>の出力フォーマットの改善<a hidden class=anchor aria-hidden=true href=#deno-lintdeno-docの出力フォーマットの改善>#</a></h3><p><code>deno lint</code>などのコマンドの出力フォーマットが改善されています。今後、<code>deno check</code>にも同様の変更が入る予定とのことです。</p><p><strong>v1.40:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>error<span style=color:#f92672>[</span>no-array-constructor<span style=color:#f92672>]</span>: Array Constructor is not allowed
</span></span><span style=display:flex><span> --&gt; /home/uki00a/ghq/github.com/uki00a/deno-samples/main.js:1:1
</span></span><span style=display:flex><span>  | 
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> | new Array<span style=color:#f92672>(</span>123, 4, 5, 6<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>  | ^^^^^^^^^^^^^^^^^^^^^^^
</span></span><span style=display:flex><span>  <span style=color:#f92672>=</span> hint: Use array literal notation <span style=color:#f92672>(</span>e.g. <span style=color:#f92672>[])</span> or single argument specifying array size only <span style=color:#f92672>(</span>e.g. new Array<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  docs: https://lint.deno.land/#no-array-constructor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>1</span> problem
</span></span><span style=display:flex><span>Checked <span style=color:#ae81ff>1</span> file
</span></span></code></pre></div><p><strong>v1.39:</strong></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>(</span>no-array-constructor<span style=color:#f92672>)</span> Array Constructor is not allowed
</span></span><span style=display:flex><span>new Array<span style=color:#f92672>(</span>123, 4, 5, 6<span style=color:#f92672>)</span>;
</span></span><span style=display:flex><span>^^^^^^^^^^^^^^^^^^^^^^^
</span></span><span style=display:flex><span>    at /home/uki00a/ghq/github.com/uki00a/deno-samples/main.js:1:1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    hint: Use array literal notation <span style=color:#f92672>(</span>e.g. <span style=color:#f92672>[])</span> or single argument specifying array size only <span style=color:#f92672>(</span>e.g. new Array<span style=color:#f92672>(</span>5<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>    help: <span style=color:#66d9ef>for</span> further information visit https://lint.deno.land/#no-array-constructor
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Found <span style=color:#ae81ff>1</span> problem
</span></span><span style=display:flex><span>Checked <span style=color:#ae81ff>1</span> file
</span></span></code></pre></div><h2 id=importmetafilenameimportmetadirname><code>import.meta.filename</code>/<code>import.meta.dirname</code><a hidden class=anchor aria-hidden=true href=#importmetafilenameimportmetadirname>#</a></h2><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-jsx data-lang=jsx><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#66d9ef>import</span>.<span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>filename</span>); <span style=color:#75715e>// 現在のモジュールのファイル名
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#66d9ef>import</span>.<span style=color:#a6e22e>meta</span>.<span style=color:#a6e22e>dirname</span>); <span style=color:#75715e>// 現在のモジュールのファイルを含むディレクトリ名
</span></span></span></code></pre></div><p>リモートモジュール内で参照された場合、これらには<code>undefined</code>が設定されます。</p><h2 id=denolockにworkspaceセクションが追加><code>deno.lock</code>に<code>workspace</code>セクションが追加<a hidden class=anchor aria-hidden=true href=#denolockにworkspaceセクションが追加>#</a></h2><p><code>deno.lock</code>の<code>workspace</code>へプロジェクトが依存しているnpm/jsrパッケージの一覧を書き込む機能が追加されています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;workspace&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;dependencies&#34;</span>: [
</span></span><span style=display:flex><span>      <span style=color:#e6db74>&#34;npm:msw@2.0.8&#34;</span>
</span></span><span style=display:flex><span>    ],
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;packageJson&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;dependencies&#34;</span>: [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;npm:chalk@5.3.0&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p><code>deno.json</code>の<code>imports</code>から依存されているnpm/jsrパッケージは<code>workspace.dependencies</code>、</p><p><code>package.json</code>で定義されている依存パッケージは<code>workspace.packageJson</code>に書き込まれるようです。</p><p>また、<code>deno.json</code>/<code>package.json</code>から特定のnpm/jsrパッケージの依存を削除すると、<code>deno.lock</code>の<code>workspace</code>セクションからも自動で削除されるようです。</p><p>もし<a href=https://uki00a.github.io/deno-weekly/articles/2023/11/19.html>ワークスペース機能</a>を活用している場合は、<code>workspace.members</code>配下で同様にして各ワークスペースごとのnpm/jsrパッケージについて追跡されるようです。</p><hr><p><a href=https://github.com/denoland/deno_lockfile/pull/13>https://github.com/denoland/deno_lockfile/pull/13</a></p><h2 id=nodejs互換性の改善>Node.js互換性の改善<a hidden class=anchor aria-hidden=true href=#nodejs互換性の改善>#</a></h2><ul><li><code>node:process</code>: <code>rejectionhandled</code>のサポートに合わせて<code>rejectionHandled</code>がサポートされています。</li><li><code>node:fs</code>: <code>promises.readFile</code>を引数なしで呼ぶときちんとエラーが発生するように改善されました。</li><li><code>node:fs/promises</code>: <code>constants</code>が公開されました。</li><li><code>node:http</code>: <code>IncomingMessage.socket</code>の<code>remoteAddress</code>と<code>remotePort</code>が設定されない問題が修正されました。</li></ul><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://deno.com/blog/v1.40>Deno 1.40: Temporal API</a></li><li><a href=https://github.com/denoland/deno/releases/tag/v1.40.0>https://github.com/denoland/deno/releases/tag/v1.40.0</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://uki00a.github.io/deno-weekly/tags/deno.html>deno</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/deno-cron.html>Deno Cron</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/deno_sdl2.html>deno_sdl2</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/dwm.html>dwm</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/jsr.html>jsr</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://uki00a.github.io/deno-weekly/>週刊Deno</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>