<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deno v1.44 | 週刊Deno</title><meta name=keywords content="Deno,React"><meta name=description content="Deno v1.44がリリース。.npmrcのサポート, Node.js互換性の改善によりNext.jsが動作するように, Deno.exitCodeが追加, FFIでi64とu64が常にbigintで取り扱われるように, DENO_FUTURE=1が指定された際は--unstable-*なしでFFIやWebGPUが利用できるように, Deno.upgradeWebSocketのidleTimeoutのデフォルト値が変更, RequestとResponseでbytesメソッドが実装, deno testで時間がかかっているテストケースへ警告が表示されるように, deno lintにno-boolean-literal-for-argumentsルールが追加, deno serveに--port=0を指定するとランダムなポートが採番されるように, v8のPointer Compressionの有効化, キャッシュ用のSQLiteデータベースでWALモードが有効化, など"><meta name=author content><link rel=canonical href=https://uki00a.github.io/deno-weekly/articles/deno/v1.44.html><link crossorigin=anonymous href=/deno-weekly/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/deno-weekly/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://uki00a.github.io/deno-weekly/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://uki00a.github.io/deno-weekly/favicon-32x32.png><link rel=apple-touch-icon href=https://uki00a.github.io/deno-weekly/apple-touch-icon.png><link rel=mask-icon href=https://uki00a.github.io/deno-weekly/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta property="twitter:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta name=twitter:site content="@uki00a"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MK2K2MRMBF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MK2K2MRMBF",{anonymize_ip:!1})}</script><meta property="og:title" content="Deno v1.44"><meta property="og:description" content="Deno v1.44がリリース。.npmrcのサポート, Node.js互換性の改善によりNext.jsが動作するように, Deno.exitCodeが追加, FFIでi64とu64が常にbigintで取り扱われるように, DENO_FUTURE=1が指定された際は--unstable-*なしでFFIやWebGPUが利用できるように, Deno.upgradeWebSocketのidleTimeoutのデフォルト値が変更, RequestとResponseでbytesメソッドが実装, deno testで時間がかかっているテストケースへ警告が表示されるように, deno lintにno-boolean-literal-for-argumentsルールが追加, deno serveに--port=0を指定するとランダムなポートが採番されるように, v8のPointer Compressionの有効化, キャッシュ用のSQLiteデータベースでWALモードが有効化, など"><meta property="og:type" content="article"><meta property="og:url" content="https://uki00a.github.io/deno-weekly/articles/deno/v1.44.html"><meta property="article:section" content="articles"><meta property="article:published_time" content="2024-06-02T00:00:00+00:00"><meta property="article:modified_time" content="2024-06-02T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deno v1.44"><meta name=twitter:description content="Deno v1.44がリリース。.npmrcのサポート, Node.js互換性の改善によりNext.jsが動作するように, Deno.exitCodeが追加, FFIでi64とu64が常にbigintで取り扱われるように, DENO_FUTURE=1が指定された際は--unstable-*なしでFFIやWebGPUが利用できるように, Deno.upgradeWebSocketのidleTimeoutのデフォルト値が変更, RequestとResponseでbytesメソッドが実装, deno testで時間がかかっているテストケースへ警告が表示されるように, deno lintにno-boolean-literal-for-argumentsルールが追加, deno serveに--port=0を指定するとランダムなポートが採番されるように, v8のPointer Compressionの有効化, キャッシュ用のSQLiteデータベースでWALモードが有効化, など"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deno v1.44","item":"https://uki00a.github.io/deno-weekly/articles/deno/v1.44.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deno v1.44","name":"Deno v1.44","description":"Deno v1.44がリリース。.npmrcのサポート, Node.js互換性の改善によりNext.jsが動作するように, Deno.exitCodeが追加, FFIでi64とu64が常にbigintで取り扱われるように, DENO_FUTURE=1が指定された際は--unstable-*なしでFFIやWebGPUが利用できるように, Deno.upgradeWebSocketのidleTimeoutのデフォルト値が変更, RequestとResponseでbytesメソッドが実装, deno testで時間がかかっているテストケースへ警告が表示されるように, deno lintにno-boolean-literal-for-argumentsルールが追加, deno serveに--port=0を指定するとランダムなポートが採番されるように, v8のPointer Compressionの有効化, キャッシュ用のSQLiteデータベースでWALモードが有効化, など","keywords":["Deno","React"],"articleBody":"Deno v1.44がリリースされました。\nこの記事では主な変更点などについて解説します。\nNode.js互換性の改善 .npmrcのサポート プライベートレジストリからnpmパッケージを読み込むために、.npmrcのサポートが追加されています。\n現時点ではpackage.jsonまたはdeno.jsonと同一ディレクトリにある.npmrcのみが探索されます (ホームディレクトリなどからの読みこみはまだサポートされていません)\n.npmrcの設定内容はnpm:などによりnpmパッケージを利用する場合に適用されます。設定内容としては、現時点では_authTokenと_authのみがサポートされています。\n組み込みパッケージ 主にgrpc-nodeやNext.js, Eleventyなどに関連したNode.js組み込みパッケージの互換性が改善されています。\nNext.jsのサポートについて 公式ブログによると、DENO_FUTURE=1の指定が必要なもののNext.jsが動作するようになったようです (後日ブログポストが公開予定とのこと)\n@google-cloud/visionのサポート @google-cloud/visionも動作するようになったようです。\n主な変更点  node:buffer: isUtf8とisAsciiが実装されています node:fs: fstatSyncでthrowIfNoEntryオプションがサポートされています node:fs: writeなどでposition引数がうまく機能しない問題が修正されています node:http: ServerResponseでstatusCodeのデフォルト値がundefinedから200に変更されています  @11ty/eleventy-dev-serverを動かすための対応 (#78)    node_modules/.bin Denoがnode_modulesを作成する際に、node_modules/.binが作成されるようになりました。\n$ deno run --allow-env --allow-read --node-modules-dir npm:cowsay@1.6.0 hi  $ ls node_modules/.bin cowsay cowthink deno.lockサポート 今までdeno.lockはdeno.jsonがある場合は自動的に生成されていました。今回のリリースでpackage.jsonがある場合にも自動でdeno.lockが作成されるように挙動が変更されました。\nまたDENO_FUTURE=1が設定された状態でdeno installを実行した際に、deno.lockをベースにパッケージを解決することによりパフォーマンスの改善も図られています (#23918)\ndeno task deno taskでスクリプトを実行する際に、そのスクリプトでnpm runが利用されていて かつ npm runにフラグが指定されていなければ、npm runをdeno taskに置きかえた上でpackage.jsonのスクリプトが実行されるように挙動が変更されています。\n例えば、以下のような内容のdeno.jsonとpackage.jsonが存在する場合、deno task testを実行すると、package.jsonのhiスクリプトが実行されます。\ndeno.json:\n{ \"tasks\": { \"hi\": \"echo deno.json\", \"test\": \"npm run hi\" } } package.json:\n{ \"scripts\": { \"hi\": \"echo package.json\" } } Deno API Deno.exitCode Deno.exitCodeが追加されました。process.exitCodeと同様に、プロセス終了時の終了コードを設定することができます。\n$ deno eval 'Deno.exitCode = 1;’ $ echo $? 1 FFI (Deno.dlopen) i64とu64型がnumber | bigint型からbigint型で取り扱われるように変更されています。\n安定化 Deno.FsFile Deno.FsFileの下記メソッドが安定化されました。(--unstable-fsなしで利用できます)\n sync syncSync syncData syncDataSync lock lockSync unlock unlockSync  DENO_FUTURE=1 DENO_FUTURE=1が設定された場合、下記の機能を--unstable-*オプションなしで利用できるようになりました。\n FFI (Deno.dlopenなど) WebGPU API unstableなファイルシステムAPI (Deno.umaskなど)  Deno.upgradeWebSocketのidleTimeoutのデフォルト値の変更 Deno.upgradeWebSocketのidleTimeoutオプションのデフォルト値が120から30に変更されています。Nginxなどはデフォルトで60秒を想定しており、その影響で120秒だと想定よりも早くDeno.upgradeWebSocketでWebSocket接続が切れてしまう問題があったようです。\nWeb API Request#bytes()/Response#bytes() RequestとResponseでbytesメソッドがサポートされました。リクエストまたはレスポンスのボディをUint8Arrayとして取得できます\nconst response = new Response(\"OK\"); const body = await response.bytes(); console.assert(body instanceof Uint8Array); console.assert(new TextDecoder().decode(body) === \"OK\"); ReadableStream.fromの改善 ReadableStream.fromでIterableIteratorだけでなくIterableもサポートされました。\nconst readable = ReadableStream.from({  [Symbol.iterator]() {  let done = false;  return {  next() {  if (done) {  return { done: true };  } else {  done = true;  return { value: 123, done: false };  }  },  };  }, }); console.info(await Array.fromAsync(readable)); // = [ 123 ] また、ReadableStream.fromでSymbol.asyncIterator/Symbol.iteratorの取り扱いが改善されています。これらにnullが設定されていた場合に、undefinedが指定された場合と同様に振る舞うように挙動が変更されています。\nCLI deno test 時間がかかっているテストケースへの警告 deno testでテストケースの実行に時間がかかっている場合に警告が表示される機能が追加されました。\nデフォルトではDENO_SLOW_TEST_TIMEOUT*(2**n)ごとの間隔で警告が表示されます (DENO_SLOW_TEST_TIMEOUTのデフォルト値は60のため、60秒 → 120秒 → 240秒…といった間隔で警告が表示されます)\n$ DENO_SLOW_TEST_TIMEOUT=5 deno test test.js running 1 test from ./test.js slowTestCase ...'slowTestCase' has been running for over (5s) 'slowTestCase' has been running for over (10s) 'slowTestCase' has been running for over (20s) --cleanオプションが追加 deno testコマンドに--cleanオプションが追加されています。--coverageオプションとの併用が想定されていて、このオプションが指定されている場合はテストの実行前にcoverageディレクトリが削除されます。\ndeno coverage deno coverageコマンドで--ignoreオプションが動作しない問題が修正されています。また、coverageディレクトリにリモートスクリプト(https:)に対するjsonファイルが生成されてしまう問題も解消されています。\ndeno lint no-boolean-literal-for-argumentsルールの追加 no-boolean-literal-for-argumentsルールが実装されています。以下のようにbooleanリテラルを関数の引数として指定している箇所に対して警告されます。\nfunction renderReport(verbose: boolean) {  // ... } renderReport(true); // = エラー renderReport(false); // = エラー 以下のように定数を利用することで警告を解消できます。\nconst VERBOSE = true; const CONCISE = false; function renderReport(verbose: boolean) {  // ... } renderReport(VERBOSE); renderReport(CONCISE); このルールはデフォルトでは無効化されているため、利用する際はdeno.jsonなどで明示的に有効化する必要があります。\n{  \"lint\": {  \"rules\": {  \"include\": [\"no-boolean-literal-for-arguments\"]  }  } } no-unused-varsルールの改善 no-unused-varsルールがJSX/TSXファイルでも動作するように改善されています。\ndeno serve deno serveコマンドの--portオプションに0を指定した場合、ランダムな空きポートが採番されるように改善されました。\nvendor vendorディレクトリ(deno.jsonに\"vendor\": trueを指定すると作成されます)のリモートファイルを編集しても、deno.lockによる検証でエラーが発生しないように挙動が改善されています。\ndeno -v deno -vでバージョンを表示できます。\n$ deno -v deno 1.44.0 パフォーマンス改善 メモリ消費の改善 v8のPointer Compressionを有効化することで、メモリ使用量の最適化が図られています。\nキャッシュ用のSQLiteデータベースでWALモードが有効化 DENO_DIR配下に作成される各種キャッシュ用のSQLiteデータベースでjournal_mode=WALが適用されるようになりました。(v8コードキャッシュやdeno lint, tscによる型チェックの高速化などで活用されています)\nこれにより起動の高速化などが期待されるようです。この変更の影響でデータベースのファイル名がv2に変更されています (例: $DENO_DIR/v8_code_cache_v2)\nnode_modules node_modulesのセットアップに関するパフォーマンスが改善されています。特にmacOSではcopyfileの代わりにclonefileを使うようにする最適化が導入されており、大幅な改善が見込まれるようです。(#23980)\n処理の並列化 swcによるソースの解析などを並列化することで、スクリプトの起動の高速化が図られています。\nバグ修正 Deno.writeFileにReadableStreamを渡すと、元のファイルの内容が部分的に置き換えられてしまう問題が修正されています。\n参考  https://github.com/denoland/deno/releases/tag/v1.44.0 Deno 1.44: Private npm registries, improved Node.js compat, and performance boosts  ","wordCount":"341","inLanguage":"en","datePublished":"2024-06-02T00:00:00Z","dateModified":"2024-06-02T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://uki00a.github.io/deno-weekly/articles/deno/v1.44.html"},"publisher":{"@type":"Organization","name":"週刊Deno","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://uki00a.github.io/deno-weekly/ accesskey=h title="週刊Deno (Alt + H)">週刊Deno</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://uki00a.github.io/deno-weekly/tags.html title=タグ><span><i class="fa fa-heart"></i>タグ</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/categories.html title=カテゴリー><span><i class="fa fa-heart"></i>カテゴリー</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/gallery.html title=ギャラリー><span><i class="fa fa-road"></i>ギャラリー<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/index.xml title="RSS feed"><span><i class="fa fa-road"></i>RSS feed<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/about.html title=About><span><i class="fa fa-road"></i>About<span class=alert></span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Deno v1.44</h1><div class=post-description>Deno v1.44がリリース。.npmrcのサポート, Node.js互換性の改善によりNext.jsが動作するように, Deno.exitCodeが追加, FFIでi64とu64が常にbigintで取り扱われるように, DENO_FUTURE=1が指定された際は--unstable-*なしでFFIやWebGPUが利用できるように, Deno.upgradeWebSocketのidleTimeoutのデフォルト値が変更, RequestとResponseでbytesメソッドが実装, deno testで時間がかかっているテストケースへ警告が表示されるように, deno lintにno-boolean-literal-for-argumentsルールが追加, deno serveに--port=0を指定するとランダムなポートが採番されるように, v8のPointer Compressionの有効化, キャッシュ用のSQLiteデータベースでWALモードが有効化, など</div><div class=post-meta><span title="2024-06-02 00:00:00 +0000 UTC">June 2, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#nodejs%e4%ba%92%e6%8f%9b%e6%80%a7%e3%81%ae%e6%94%b9%e5%96%84 aria-label=Node.js互換性の改善>Node.js互換性の改善</a><ul><li><a href=#npmrc%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=.npmrcのサポート><code>.npmrc</code>のサポート</a></li><li><a href=#%e7%b5%84%e3%81%bf%e8%be%bc%e3%81%bf%e3%83%91%e3%83%83%e3%82%b1%e3%83%bc%e3%82%b8 aria-label=組み込みパッケージ>組み込みパッケージ</a><ul><li><a href=#nextjs%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88%e3%81%ab%e3%81%a4%e3%81%84%e3%81%a6 aria-label=Next.jsのサポートについて>Next.jsのサポートについて</a></li><li><a href=#google-cloudvision%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=@google-cloud/visionのサポート><code>@google-cloud/vision</code>のサポート</a></li><li><a href=#%e4%b8%bb%e3%81%aa%e5%a4%89%e6%9b%b4%e7%82%b9 aria-label=主な変更点>主な変更点</a></li></ul></li><li><a href=#node_modulesbin aria-label=node_modules/.bin><code>node_modules/.bin</code></a></li><li><a href=#denolock%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=deno.lockサポート><code>deno.lock</code>サポート</a></li><li><a href=#deno-task aria-label="deno task"><code>deno task</code></a></li></ul></li><li><a href=#deno-api aria-label="Deno API">Deno API</a><ul><li><a href=#denoexitcode aria-label=Deno.exitCode><code>Deno.exitCode</code></a></li><li><a href=#ffi-denodlopen aria-label="FFI (Deno.dlopen)">FFI (<code>Deno.dlopen</code>)</a></li><li><a href=#%e5%ae%89%e5%ae%9a%e5%8c%96 aria-label=安定化>安定化</a><ul><li><a href=#denofsfile aria-label=Deno.FsFile><code>Deno.FsFile</code></a></li></ul></li><li><a href=#deno_future1 aria-label="DENO_FUTURE=1"><code>DENO_FUTURE=1</code></a></li><li><a href=#denoupgradewebsocket%e3%81%aeidletimeout%e3%81%ae%e3%83%87%e3%83%95%e3%82%a9%e3%83%ab%e3%83%88%e5%80%a4%e3%81%ae%e5%a4%89%e6%9b%b4 aria-label=Deno.upgradeWebSocketのidleTimeoutのデフォルト値の変更><code>Deno.upgradeWebSocket</code>の<code>idleTimeout</code>のデフォルト値の変更</a></li></ul></li><li><a href=#web-api aria-label="Web API">Web API</a><ul><li><a href=#requestbytesresponsebytes aria-label=Request#bytes()/Response#bytes()><code>Request#bytes()</code>/<code>Response#bytes()</code></a></li><li><a href=#readablestreamfrom%e3%81%ae%e6%94%b9%e5%96%84 aria-label=ReadableStream.fromの改善><code>ReadableStream.from</code>の改善</a></li></ul></li><li><a href=#cli aria-label=CLI>CLI</a><ul><li><a href=#deno-test aria-label="deno test"><code>deno test</code></a><ul><li><a href=#%e6%99%82%e9%96%93%e3%81%8c%e3%81%8b%e3%81%8b%e3%81%a3%e3%81%a6%e3%81%84%e3%82%8b%e3%83%86%e3%82%b9%e3%83%88%e3%82%b1%e3%83%bc%e3%82%b9%e3%81%b8%e3%81%ae%e8%ad%a6%e5%91%8a aria-label=時間がかかっているテストケースへの警告>時間がかかっているテストケースへの警告</a></li><li><a href=#--clean%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label=--cleanオプションが追加><code>--clean</code>オプションが追加</a></li></ul></li><li><a href=#deno-coverage aria-label="deno coverage"><code>deno coverage</code></a></li><li><a href=#deno-lint aria-label="deno lint"><code>deno lint</code></a><ul><li><a href=#no-boolean-literal-for-arguments%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%ae%e8%bf%bd%e5%8a%a0 aria-label=no-boolean-literal-for-argumentsルールの追加><code>no-boolean-literal-for-arguments</code>ルールの追加</a></li><li><a href=#no-unused-vars%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%ae%e6%94%b9%e5%96%84 aria-label=no-unused-varsルールの改善><code>no-unused-vars</code>ルールの改善</a></li></ul></li><li><a href=#deno-serve aria-label="deno serve"><code>deno serve</code></a></li><li><a href=#vendor aria-label=vendor><code>vendor</code></a></li><li><a href=#deno--v aria-label="deno -v"><code>deno -v</code></a></li></ul></li><li><a href=#%e3%83%91%e3%83%95%e3%82%a9%e3%83%bc%e3%83%9e%e3%83%b3%e3%82%b9%e6%94%b9%e5%96%84 aria-label=パフォーマンス改善>パフォーマンス改善</a><ul><li><a href=#%e3%83%a1%e3%83%a2%e3%83%aa%e6%b6%88%e8%b2%bb%e3%81%ae%e6%94%b9%e5%96%84 aria-label=メモリ消費の改善>メモリ消費の改善</a></li><li><a href=#%e3%82%ad%e3%83%a3%e3%83%83%e3%82%b7%e3%83%a5%e7%94%a8%e3%81%aesqlite%e3%83%87%e3%83%bc%e3%82%bf%e3%83%99%e3%83%bc%e3%82%b9%e3%81%a7wal%e3%83%a2%e3%83%bc%e3%83%89%e3%81%8c%e6%9c%89%e5%8a%b9%e5%8c%96 aria-label=キャッシュ用のSQLiteデータベースでWALモードが有効化>キャッシュ用のSQLiteデータベースでWALモードが有効化</a></li><li><a href=#node_modules aria-label=node_modules><code>node_modules</code></a></li><li><a href=#%e5%87%a6%e7%90%86%e3%81%ae%e4%b8%a6%e5%88%97%e5%8c%96 aria-label=処理の並列化>処理の並列化</a></li></ul></li><li><a href=#%e3%83%90%e3%82%b0%e4%bf%ae%e6%ad%a3 aria-label=バグ修正>バグ修正</a></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><p>Deno v1.44がリリースされました。</p><p>この記事では主な変更点などについて解説します。</p><h2 id=nodejs互換性の改善>Node.js互換性の改善<a hidden class=anchor aria-hidden=true href=#nodejs互換性の改善>#</a></h2><h3 id=npmrcのサポート><code>.npmrc</code>のサポート<a hidden class=anchor aria-hidden=true href=#npmrcのサポート>#</a></h3><p>プライベートレジストリからnpmパッケージを読み込むために、<code>.npmrc</code>のサポートが追加されています。</p><p>現時点では<code>package.json</code>または<code>deno.json</code>と同一ディレクトリにある<code>.npmrc</code>のみが探索されます (ホームディレクトリなどからの読みこみはまだサポートされていません)</p><p><code>.npmrc</code>の設定内容は<code>npm:</code>などによりnpmパッケージを利用する場合に適用されます。設定内容としては、現時点では<code>_authToken</code>と<code>_auth</code>のみがサポートされています。</p><h3 id=組み込みパッケージ>組み込みパッケージ<a hidden class=anchor aria-hidden=true href=#組み込みパッケージ>#</a></h3><p>主に<a href=https://github.com/grpc/grpc-node>grpc-node</a>やNext.js, Eleventyなどに関連したNode.js組み込みパッケージの互換性が改善されています。</p><h4 id=nextjsのサポートについて>Next.jsのサポートについて<a hidden class=anchor aria-hidden=true href=#nextjsのサポートについて>#</a></h4><p>公式ブログによると、<code>DENO_FUTURE=1</code>の指定が必要なもののNext.jsが動作するようになったようです (後日ブログポストが公開予定とのこと)</p><h4 id=google-cloudvisionのサポート><code>@google-cloud/vision</code>のサポート<a hidden class=anchor aria-hidden=true href=#google-cloudvisionのサポート>#</a></h4><p><a href=https://www.npmjs.com/package/@google-cloud/vision>@google-cloud/vision</a>も動作するようになったようです。</p><h4 id=主な変更点>主な変更点<a hidden class=anchor aria-hidden=true href=#主な変更点>#</a></h4><ul><li><code>node:buffer</code>: <code>isUtf8</code>と<code>isAscii</code>が実装されています</li><li><code>node:fs</code>: <code>fstatSync</code>で<code>throwIfNoEntry</code>オプションがサポートされています</li><li><code>node:fs</code>: <code>write</code>などで<code>position</code>引数がうまく機能しない問題が修正されています</li><li><code>node:http</code>: <code>ServerResponse</code>で<code>statusCode</code>のデフォルト値が<code>undefined</code>から<code>200</code>に変更されています<ul><li><a href=https://github.com/11ty/eleventy-dev-server>@11ty/eleventy-dev-server</a>を動かすための対応 (<a href=https://github.com/11ty/eleventy-dev-server/issues/78>#78</a>)</li></ul></li></ul><h3 id=node_modulesbin><code>node_modules/.bin</code><a hidden class=anchor aria-hidden=true href=#node_modulesbin>#</a></h3><p>Denoが<code>node_modules</code>を作成する際に、<code>node_modules/.bin</code>が作成されるようになりました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno run --allow-env --allow-read --node-modules-dir npm:cowsay@1.6.0 hi
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>$ ls node_modules/.bin
</span></span><span style=display:flex><span>cowsay  cowthink
</span></span></code></pre></div><h3 id=denolockサポート><code>deno.lock</code>サポート<a hidden class=anchor aria-hidden=true href=#denolockサポート>#</a></h3><p>今まで<code>deno.lock</code>は<code>deno.json</code>がある場合は自動的に生成されていました。今回のリリースで<code>package.json</code>がある場合にも自動で<code>deno.lock</code>が作成されるように挙動が変更されました。</p><p>また<code>DENO_FUTURE=1</code>が設定された状態で<code>deno install</code>を実行した際に、<code>deno.lock</code>をベースにパッケージを解決することによりパフォーマンスの改善も図られています (<a href=https://github.com/denoland/deno/pull/23918>#23918</a>)</p><h3 id=deno-task><code>deno task</code><a hidden class=anchor aria-hidden=true href=#deno-task>#</a></h3><p><code>deno task</code>でスクリプトを実行する際に、そのスクリプトで<code>npm run</code>が利用されていて かつ <code>npm run</code>にフラグが指定されていなければ、<code>npm run</code>を<code>deno task</code>に置きかえた上で<code>package.json</code>のスクリプトが実行されるように挙動が変更されています。</p><p>例えば、以下のような内容の<code>deno.json</code>と<code>package.json</code>が存在する場合、<code>deno task test</code>を実行すると、<code>package.json</code>の<code>hi</code>スクリプトが実行されます。</p><p><strong><code>deno.json</code>:</strong></p><pre tabindex=0><code>{
  &#34;tasks&#34;: {
    &#34;hi&#34;: &#34;echo deno.json&#34;,
    &#34;test&#34;: &#34;npm run hi&#34;
  }
}
</code></pre><p><strong><code>package.json</code>:</strong></p><pre tabindex=0><code>{
  &#34;scripts&#34;: {
    &#34;hi&#34;: &#34;echo package.json&#34;
  }
}
</code></pre><h2 id=deno-api>Deno API<a hidden class=anchor aria-hidden=true href=#deno-api>#</a></h2><h3 id=denoexitcode><code>Deno.exitCode</code><a hidden class=anchor aria-hidden=true href=#denoexitcode>#</a></h3><p><code>Deno.exitCode</code>が追加されました。<code>process.exitCode</code>と同様に、プロセス終了時の終了コードを設定することができます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno eval <span style=color:#960050;background-color:#1e0010>&#39;</span>Deno.exitCode <span style=color:#f92672>=</span> 1;’
</span></span><span style=display:flex><span>$ echo $?
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span>
</span></span></code></pre></div><h3 id=ffi-denodlopen>FFI (<code>Deno.dlopen</code>)<a hidden class=anchor aria-hidden=true href=#ffi-denodlopen>#</a></h3><p><code>i64</code>と<code>u64</code>型が<code>number | bigint</code>型から<code>bigint</code>型で取り扱われるように変更されています。</p><h3 id=安定化>安定化<a hidden class=anchor aria-hidden=true href=#安定化>#</a></h3><h4 id=denofsfile><code>Deno.FsFile</code><a hidden class=anchor aria-hidden=true href=#denofsfile>#</a></h4><p><code>Deno.FsFile</code>の下記メソッドが安定化されました。(<code>--unstable-fs</code>なしで利用できます)</p><ul><li><code>sync</code></li><li><code>syncSync</code></li><li><code>syncData</code></li><li><code>syncDataSync</code></li><li><code>lock</code></li><li><code>lockSync</code></li><li><code>unlock</code></li><li><code>unlockSync</code></li></ul><h3 id=deno_future1><code>DENO_FUTURE=1</code><a hidden class=anchor aria-hidden=true href=#deno_future1>#</a></h3><p><code>DENO_FUTURE=1</code>が設定された場合、下記の機能を<code>--unstable-*</code>オプションなしで利用できるようになりました。</p><ul><li>FFI (<code>Deno.dlopen</code>など)</li><li>WebGPU API</li><li>unstableなファイルシステムAPI (<code>Deno.umask</code>など)</li></ul><h3 id=denoupgradewebsocketのidletimeoutのデフォルト値の変更><code>Deno.upgradeWebSocket</code>の<code>idleTimeout</code>のデフォルト値の変更<a hidden class=anchor aria-hidden=true href=#denoupgradewebsocketのidletimeoutのデフォルト値の変更>#</a></h3><p><code>Deno.upgradeWebSocket</code>の<code>idleTimeout</code>オプションのデフォルト値が<code>120</code>から<code>30</code>に変更されています。Nginxなどはデフォルトで60秒を想定しており、その影響で120秒だと想定よりも早く<code>Deno.upgradeWebSocket</code>でWebSocket接続が切れてしまう問題があったようです。</p><h2 id=web-api>Web API<a hidden class=anchor aria-hidden=true href=#web-api>#</a></h2><h3 id=requestbytesresponsebytes><code>Request#bytes()</code>/<code>Response#bytes()</code><a hidden class=anchor aria-hidden=true href=#requestbytesresponsebytes>#</a></h3><p><code>Request</code>と<code>Response</code>で<code>bytes</code>メソッドがサポートされました。リクエストまたはレスポンスのボディを<code>Uint8Array</code>として取得できます</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>response</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Response</span>(<span style=color:#e6db74>&#34;OK&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>body</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>response</span>.<span style=color:#a6e22e>bytes</span>();
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>assert</span>(<span style=color:#a6e22e>body</span> <span style=color:#66d9ef>instanceof</span> <span style=color:#a6e22e>Uint8Array</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>assert</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TextDecoder</span>().<span style=color:#a6e22e>decode</span>(<span style=color:#a6e22e>body</span>) <span style=color:#f92672>===</span> <span style=color:#e6db74>&#34;OK&#34;</span>);
</span></span></code></pre></div><h3 id=readablestreamfromの改善><code>ReadableStream.from</code>の改善<a hidden class=anchor aria-hidden=true href=#readablestreamfromの改善>#</a></h3><p><code>ReadableStream.from</code>で<code>IterableIterator</code>だけでなく<code>Iterable</code>もサポートされました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>readable</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>ReadableStream</span>.<span style=color:#a6e22e>from</span>({
</span></span><span style=display:flex><span>  [<span style=color:#a6e22e>Symbol</span>.<span style=color:#a6e22e>iterator</span>]() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>let</span> <span style=color:#a6e22e>done</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>next</span>() {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>done</span>) {
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>done</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>true</span> };
</span></span><span style=display:flex><span>        } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>          <span style=color:#a6e22e>done</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span>          <span style=color:#66d9ef>return</span> { <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#ae81ff>123</span>, <span style=color:#a6e22e>done</span><span style=color:#f92672>:</span> <span style=color:#66d9ef>false</span> };
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>      },
</span></span><span style=display:flex><span>    };
</span></span><span style=display:flex><span>  },
</span></span><span style=display:flex><span>});
</span></span><span style=display:flex><span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#66d9ef>await</span> Array.<span style=color:#a6e22e>fromAsync</span>(<span style=color:#a6e22e>readable</span>)); <span style=color:#75715e>// =&gt; [ 123 ]
</span></span></span></code></pre></div><p>また、<code>ReadableStream.from</code>で<code>Symbol.asyncIterator</code>/<code>Symbol.iterator</code>の取り扱いが改善されています。これらに<code>null</code>が設定されていた場合に、<code>undefined</code>が指定された場合と同様に振る舞うように挙動が変更されています。</p><h2 id=cli>CLI<a hidden class=anchor aria-hidden=true href=#cli>#</a></h2><h3 id=deno-test><code>deno test</code><a hidden class=anchor aria-hidden=true href=#deno-test>#</a></h3><h4 id=時間がかかっているテストケースへの警告>時間がかかっているテストケースへの警告<a hidden class=anchor aria-hidden=true href=#時間がかかっているテストケースへの警告>#</a></h4><p><code>deno test</code>でテストケースの実行に時間がかかっている場合に警告が表示される機能が追加されました。</p><p>デフォルトでは<code>DENO_SLOW_TEST_TIMEOUT*(2**n)</code>ごとの間隔で警告が表示されます (<code>DENO_SLOW_TEST_TIMEOUT</code>のデフォルト値は<code>60</code>のため、60秒 → 120秒 → 240秒…といった間隔で警告が表示されます)</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ DENO_SLOW_TEST_TIMEOUT<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span> deno test test.js
</span></span><span style=display:flex><span>running <span style=color:#ae81ff>1</span> test from ./test.js
</span></span><span style=display:flex><span>slowTestCase ...<span style=color:#e6db74>&#39;slowTestCase&#39;</span> has been running <span style=color:#66d9ef>for</span> over <span style=color:#f92672>(</span>5s<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;slowTestCase&#39;</span> has been running <span style=color:#66d9ef>for</span> over <span style=color:#f92672>(</span>10s<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span><span style=color:#e6db74>&#39;slowTestCase&#39;</span> has been running <span style=color:#66d9ef>for</span> over <span style=color:#f92672>(</span>20s<span style=color:#f92672>)</span>
</span></span></code></pre></div><h4 id=--cleanオプションが追加><code>--clean</code>オプションが追加<a hidden class=anchor aria-hidden=true href=#--cleanオプションが追加>#</a></h4><p><code>deno test</code>コマンドに<code>--clean</code>オプションが追加されています。<code>--coverage</code>オプションとの併用が想定されていて、このオプションが指定されている場合はテストの実行前に<code>coverage</code>ディレクトリが削除されます。</p><h3 id=deno-coverage><code>deno coverage</code><a hidden class=anchor aria-hidden=true href=#deno-coverage>#</a></h3><p><code>deno coverage</code>コマンドで<code>--ignore</code>オプションが動作しない問題が修正されています。また、<code>coverage</code>ディレクトリにリモートスクリプト(<code>https:</code>)に対するjsonファイルが生成されてしまう問題も解消されています。</p><h3 id=deno-lint><code>deno lint</code><a hidden class=anchor aria-hidden=true href=#deno-lint>#</a></h3><h4 id=no-boolean-literal-for-argumentsルールの追加><code>no-boolean-literal-for-arguments</code>ルールの追加<a hidden class=anchor aria-hidden=true href=#no-boolean-literal-for-argumentsルールの追加>#</a></h4><p><code>no-boolean-literal-for-arguments</code>ルールが実装されています。以下のように<code>boolean</code>リテラルを関数の引数として指定している箇所に対して警告されます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>renderReport</span>(<span style=color:#a6e22e>verbose</span>: <span style=color:#66d9ef>boolean</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>renderReport</span>(<span style=color:#66d9ef>true</span>); <span style=color:#75715e>// =&gt; エラー
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>renderReport</span>(<span style=color:#66d9ef>false</span>); <span style=color:#75715e>// =&gt; エラー
</span></span></span></code></pre></div><p>以下のように定数を利用することで警告を解消できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>VERBOSE</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>true</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>const</span> <span style=color:#a6e22e>CONCISE</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>renderReport</span>(<span style=color:#a6e22e>verbose</span>: <span style=color:#66d9ef>boolean</span>) {
</span></span><span style=display:flex><span>  <span style=color:#75715e>// ...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span><span style=display:flex><span><span style=color:#a6e22e>renderReport</span>(<span style=color:#a6e22e>VERBOSE</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>renderReport</span>(<span style=color:#a6e22e>CONCISE</span>);
</span></span></code></pre></div><p>このルールはデフォルトでは無効化されているため、利用する際は<code>deno.json</code>などで明示的に有効化する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;lint&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;rules&#34;</span>: {
</span></span><span style=display:flex><span>      <span style=color:#f92672>&#34;include&#34;</span>: [<span style=color:#e6db74>&#34;no-boolean-literal-for-arguments&#34;</span>]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=no-unused-varsルールの改善><code>no-unused-vars</code>ルールの改善<a hidden class=anchor aria-hidden=true href=#no-unused-varsルールの改善>#</a></h4><p><code>no-unused-vars</code>ルールがJSX/TSXファイルでも動作するように改善されています。</p><h3 id=deno-serve><code>deno serve</code><a hidden class=anchor aria-hidden=true href=#deno-serve>#</a></h3><p><a href=https://uki00a.github.io/deno-weekly/articles/deno/v1.43.html><code>deno serve</code></a>コマンドの<code>--port</code>オプションに<code>0</code>を指定した場合、ランダムな空きポートが採番されるように改善されました。</p><h3 id=vendor><code>vendor</code><a hidden class=anchor aria-hidden=true href=#vendor>#</a></h3><p><code>vendor</code>ディレクトリ(<code>deno.json</code>に<code>"vendor": true</code>を指定すると作成されます)のリモートファイルを編集しても、<code>deno.lock</code>による検証でエラーが発生しないように挙動が改善されています。</p><h3 id=deno--v><code>deno -v</code><a hidden class=anchor aria-hidden=true href=#deno--v>#</a></h3><p><code>deno -v</code>でバージョンを表示できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno -v
</span></span><span style=display:flex><span>deno 1.44.0
</span></span></code></pre></div><h2 id=パフォーマンス改善>パフォーマンス改善<a hidden class=anchor aria-hidden=true href=#パフォーマンス改善>#</a></h2><h3 id=メモリ消費の改善>メモリ消費の改善<a hidden class=anchor aria-hidden=true href=#メモリ消費の改善>#</a></h3><p>v8の<a href=https://v8.dev/blog/pointer-compression>Pointer Compression</a>を有効化することで、メモリ使用量の最適化が図られています。</p><h3 id=キャッシュ用のsqliteデータベースでwalモードが有効化>キャッシュ用のSQLiteデータベースでWALモードが有効化<a hidden class=anchor aria-hidden=true href=#キャッシュ用のsqliteデータベースでwalモードが有効化>#</a></h3><p><code>DENO_DIR</code>配下に作成される各種キャッシュ用のSQLiteデータベースで<code>journal_mode=WAL</code>が適用されるようになりました。(v8コードキャッシュや<code>deno lint</code>, <code>tsc</code>による型チェックの高速化などで活用されています)</p><p>これにより起動の高速化などが期待されるようです。この変更の影響でデータベースのファイル名がv2に変更されています (例: <code>$DENO_DIR/v8_code_cache_v2</code>)</p><h3 id=node_modules><code>node_modules</code><a hidden class=anchor aria-hidden=true href=#node_modules>#</a></h3><p><code>node_modules</code>のセットアップに関するパフォーマンスが改善されています。特にmacOSでは<code>copyfile</code>の代わりに<code>clonefile</code>を使うようにする最適化が導入されており、大幅な改善が見込まれるようです。(<a href=https://github.com/denoland/deno/pull/23980>#23980</a>)</p><h3 id=処理の並列化>処理の並列化<a hidden class=anchor aria-hidden=true href=#処理の並列化>#</a></h3><p>swcによるソースの解析などを並列化することで、スクリプトの起動の高速化が図られています。</p><h2 id=バグ修正>バグ修正<a hidden class=anchor aria-hidden=true href=#バグ修正>#</a></h2><p><code>Deno.writeFile</code>に<code>ReadableStream</code>を渡すと、元のファイルの内容が部分的に置き換えられてしまう問題が修正されています。</p><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://github.com/denoland/deno/releases/tag/v1.44.0>https://github.com/denoland/deno/releases/tag/v1.44.0</a></li><li><a href=https://deno.com/blog/v1.44>Deno 1.44: Private npm registries, improved Node.js compat, and performance boosts</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://uki00a.github.io/deno-weekly/tags/deno.html>deno</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/react.html>React</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://uki00a.github.io/deno-weekly/>週刊Deno</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>