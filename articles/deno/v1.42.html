<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Deno v1.42 | 週刊Deno</title><meta name=keywords content="Deno,jsr"><meta name=description content="Deno v2に向けてdeno installに--globalオプションが追加, deno lintでQuickfixがサポート, deno taskでのリダイレクトサポートの改善, deno testのJUnitレポーターでのサブステップの取り扱いが改善, vendorディレクトリの取り扱いの変更, --watch-excludeオプションの追加, TypeScript v5.4へのアップデート, EventSourceの安定性の改善, など"><meta name=author content><link rel=canonical href=https://uki00a.github.io/deno-weekly/articles/deno/v1.42.html><link crossorigin=anonymous href=/deno-weekly/assets/css/stylesheet.6a98292fb8fa8cf0f3ba4042d4b75515c04267550f3ad49ff6271b5af9562443.css integrity="sha256-apgpL7j6jPDzukBC1LdVFcBCZ1UPOtSf9icbWvlWJEM=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/deno-weekly/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://uki00a.github.io/deno-weekly/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://uki00a.github.io/deno-weekly/favicon-32x32.png><link rel=apple-touch-icon href=https://uki00a.github.io/deno-weekly/apple-touch-icon.png><link rel=mask-icon href=https://uki00a.github.io/deno-weekly/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta property="twitter:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png"><meta name=twitter:site content="@uki00a"><script async src="https://www.googletagmanager.com/gtag/js?id=G-MK2K2MRMBF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-MK2K2MRMBF",{anonymize_ip:!1})}</script><meta property="og:title" content="Deno v1.42"><meta property="og:description" content="Deno v2に向けてdeno installに--globalオプションが追加, deno lintでQuickfixがサポート, deno taskでのリダイレクトサポートの改善, deno testのJUnitレポーターでのサブステップの取り扱いが改善, vendorディレクトリの取り扱いの変更, --watch-excludeオプションの追加, TypeScript v5.4へのアップデート, EventSourceの安定性の改善, など"><meta property="og:type" content="article"><meta property="og:url" content="https://uki00a.github.io/deno-weekly/articles/deno/v1.42.html"><meta property="article:section" content="articles"><meta property="article:published_time" content="2024-03-31T00:00:00+00:00"><meta property="article:modified_time" content="2024-03-31T00:00:00+00:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Deno v1.42"><meta name=twitter:description content="Deno v2に向けてdeno installに--globalオプションが追加, deno lintでQuickfixがサポート, deno taskでのリダイレクトサポートの改善, deno testのJUnitレポーターでのサブステップの取り扱いが改善, vendorディレクトリの取り扱いの変更, --watch-excludeオプションの追加, TypeScript v5.4へのアップデート, EventSourceの安定性の改善, など"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Deno v1.42","item":"https://uki00a.github.io/deno-weekly/articles/deno/v1.42.html"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Deno v1.42","name":"Deno v1.42","description":"Deno v2に向けてdeno installに--globalオプションが追加, deno lintでQuickfixがサポート, deno taskでのリダイレクトサポートの改善, deno testのJUnitレポーターでのサブステップの取り扱いが改善, vendorディレクトリの取り扱いの変更, --watch-excludeオプションの追加, TypeScript v5.4へのアップデート, EventSourceの安定性の改善, など","keywords":["Deno","jsr"],"articleBody":"Deno v1.42がリリースされました。\nこの記事では主な変更点などについて解説します。\nDeno v2に向けた変更 DENO_FUTUREによるDeno.*配下の非推奨APIの削除 DENO_FUTURE=1を指定すると、Deno.*配下の非推奨APIが削除されるようになりました。\ndeno installに--globalオプションが追加 deno installコマンドはインターネット上などで公開されたスクリプトをインストールするためのコマンドです。(デフォルトのインストール先は$HOME/.deno)\nDeno v2ではこのdeno installコマンドはデフォルトでdeno addコマンドのエイリアスとして機能するように変更される予定のようです。\n deno install changes for Deno 2 (#23062)\n この変更に向けてdeno installコマンドに--global/-gオプションが追加されました。Deno v2のリリース以降、Deno v1におけるdeno installと同じ振る舞いをさせるためには、この--globalオプションを指定する必要があります。\n$ deno install --global --allow-read=. --allow-write=. --allow-net https://deno.land/x/udd/main.ts deno lint Quickfixのサポート deno lintとdeno lspでQuickfixがサポートされました。deno lintでは--fixオプションによりQuickfixを実行できます。\n$ deno lint --fix main.js 今のところ以下のルールでQuickfixがサポートされています。\n no-window no-window-prefix verbatim-module-syntax  jsr関連のルールの自動適用 deno.jsonにname/version/exportsが定義されていたら、jsr関連のlintルールが自動で有効化されるように挙動が変更されています。\n適用されるルールについては以下で確認できます。\n$ deno lint --rules-tags=jsr --rules deno task タスクのコメント deno taskコマンドがタスクに記述されたコメントを認識してくれます。\n// deno.jsonc {  \"tasks\": {  // Run tests  \"test\": \"deno test --allow-read=. --trace-leaks\"  } } $ deno task Available tasks: - test  // Run tests  deno test --allow-read=. --trace-leaks shebangのサポート 以下のようにスクリプトを実行するタスクを定義します。\n{  \"tasks\": {  \"script\": \"./my_script.js\"  } } するとこのスクリプトに記述されたshebangをdeno taskが認識してくれるようになりました。\n#!/usr/bin/env -S deno run console.info(\"foo\"); リダイレクトサポートの改善 入力リダイレクトがサポートされています。\n{  \"tasks\": {  \"script\": \"jq .tasks  } } また指定したファイルディスクリプタへのリダイレクトもサポートされています。\n{  \"tasks\": {  \"script\": \"deno run some_script.js 2\u00261\"  } } $?のサポート スクリプトで$?を参照できます。\n{  \"tasks\": {  \"script\": \"deno run some_script.js || echo $?\"  } } deno publish  deno publish --dry-runでコミットされていないファイルが検出されたらエラーが起きるように改善されています。 deno publishの実行時に、パッケージに含まれるべきモジュールがexcludeなどで除外されていた場合、エラーが発生するように挙動が変更されています。  deno test JUnitレポーターにおけるサブステップの取り扱いが改善 JUnitレポーター(--reporter=junit)でサブステップ(t.step)の取り扱いが改善されています。\n今までt.stepで定義されたテストケースはによって表現されていたものの、gotestsumやvitestなどと同様にが使用されるように変更されています。\nこれによりt.stepが失敗した際により詳細なエラーメッセージなどを含めることができるように改善されているようです。\ndeno lsp vscode_denoでDeno: Reload Import Registries Cacheコマンドを実行してもjsrパッケージが再読み込みされない問題が修正されています。\ndeno check deno checkコマンドでは--unstableの指定を提案しないように変更されています。\nこれは/// が使われており、かつdeno.unstableが読み込まれていない場合を想定した変更のようです。この場合、deno checkは--unstableの指定を提案するものの、実際に--unstableを指定しても効果がないため、混乱を招いてしまうというのがこの変更の理由のようです。\nCLI vendorディレクトリの取り扱いの変更 今まで、Denoの各コマンドはvendorと名のついたディレクトリをデフォルトで除外していました。\nDeno v1.42でこの挙動が変更され、deno.jsonで\"vendor\": trueが指定されていない場合は、vendor/ディレクトリがデフォルトで無視されなくなりました。\nDeno v1.41までの挙動に戻したい場合は、deno.jsonのexcludeなどで明示的に除外する必要があります。\n https://github.com/denoland/deno/pull/23100\n--watch-excludeオプションが追加 このオプションで指定されたファイルが変更された際は、--watchによる再起動が行われなくなります。\n$ deno run --watch-exclude=data.json --watch main.js TypeScript TypeScript v5.4へのアップデート Deno本体に搭載されたTypeScriptがv5.4へアップデートされています。\n Announcing TypeScript 5.4  新しいSetメソッドの型定義 proposal-set-methodsで提案されているSetの新しいメソッドに関する型定義が追加されました。\nWeb API EventSourceの改善 EventSourceで発生するリソースリークなどの問題が修正されています。\nまた、EventSourceで受け取ったメッセージのフィールドに:を含む値が設定されていた場合に、意図せずして値が部分的に切り取られてしまう問題も修正されています。\nstructuredCloneの型定義が修正 structuredCloneの型定義がTypeScript公式と同様の定義に合わせられました。\nNode.js互換性の改善 node:fs FSWatcher#unrefが実装されました。\nnode:events EventEmitterAsyncResourceが実装されました。\nnode:crypto  ECDHのgetPublicKey/generateKeysメソッドでformat引数がサポート getRandomValuesが追加 subtleが追加 createPublicKeyでEC鍵がサポート  node:string_decoder 内部実装が再実装され、Node.jsとの互換性が改善されています。\nnode:child_process spawnSyncなどのstdioオプションに[null, null, null]を指定した際に[\"pipe\", \"pipe\", \"pipe\"]と同様に取り扱われるように改善されました。\nnode:v8 serialize/deserializeが実装されました。\nnode:worker_threads  WorkerのworkerDataオプションにMessagePortを渡せるように改善されました。 ESMモジュールがCJSモジュールとして実行されてしまうことがある問題が修正されました。 parentPortにmessageリスナーが登録されている際は、プロセスの終了がブロックされるように挙動が変更されました。  参考  https://github.com/denoland/deno/releases/tag/v1.42.0 Deno 1.42: Better dependency management with JSR  ","wordCount":"240","inLanguage":"en","datePublished":"2024-03-31T00:00:00Z","dateModified":"2024-03-31T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://uki00a.github.io/deno-weekly/articles/deno/v1.42.html"},"publisher":{"@type":"Organization","name":"週刊Deno","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://uki00a.github.io/deno-weekly/ accesskey=h title="週刊Deno (Alt + H)">週刊Deno</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://uki00a.github.io/deno-weekly/tags.html title=タグ><span><i class="fa fa-heart"></i>タグ</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/categories.html title=カテゴリー><span><i class="fa fa-heart"></i>カテゴリー</span></a></li><li><a href=https://uki00a.github.io/deno-weekly/gallery.html title=ギャラリー><span><i class="fa fa-road"></i>ギャラリー<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/index.xml title="RSS feed"><span><i class="fa fa-road"></i>RSS feed<span class=alert></span></span></a></li><li><a href=https://uki00a.github.io/deno-weekly/about.html title=About><span><i class="fa fa-road"></i>About<span class=alert></span></span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>Deno v1.42</h1><div class=post-description>Deno v2に向けてdeno installに--globalオプションが追加, deno lintでQuickfixがサポート, deno taskでのリダイレクトサポートの改善, deno testのJUnitレポーターでのサブステップの取り扱いが改善, vendorディレクトリの取り扱いの変更, --watch-excludeオプションの追加, TypeScript v5.4へのアップデート, EventSourceの安定性の改善, など</div><div class=post-meta><span title="2024-03-31 00:00:00 +0000 UTC">March 31, 2024</span></div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><ul><li><a href=#deno-v2%e3%81%ab%e5%90%91%e3%81%91%e3%81%9f%e5%a4%89%e6%9b%b4 aria-label="Deno v2に向けた変更">Deno v2に向けた変更</a><ul><li><a href=#deno_future%e3%81%ab%e3%82%88%e3%82%8bdeno%e9%85%8d%e4%b8%8b%e3%81%ae%e9%9d%9e%e6%8e%a8%e5%a5%a8api%e3%81%ae%e5%89%8a%e9%99%a4 aria-label=DENO_FUTUREによるDeno.*配下の非推奨APIの削除><code>DENO_FUTURE</code>による<code>Deno.*</code>配下の非推奨APIの削除</a></li><li><a href=#deno-install%e3%81%ab--global%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label="deno installに--globalオプションが追加"><code>deno install</code>に<code>--global</code>オプションが追加</a></li></ul></li><li><a href=#deno-lint aria-label="deno lint"><code>deno lint</code></a><ul><li><a href=#quickfix%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=Quickfixのサポート>Quickfixのサポート</a></li><li><a href=#jsr%e9%96%a2%e9%80%a3%e3%81%ae%e3%83%ab%e3%83%bc%e3%83%ab%e3%81%ae%e8%87%aa%e5%8b%95%e9%81%a9%e7%94%a8 aria-label=jsr関連のルールの自動適用><code>jsr</code>関連のルールの自動適用</a></li></ul></li><li><a href=#deno-task aria-label="deno task"><code>deno task</code></a><ul><li><a href=#%e3%82%bf%e3%82%b9%e3%82%af%e3%81%ae%e3%82%b3%e3%83%a1%e3%83%b3%e3%83%88 aria-label=タスクのコメント>タスクのコメント</a></li><li><a href=#shebang%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=shebangのサポート>shebangのサポート</a></li><li><a href=#%e3%83%aa%e3%83%80%e3%82%a4%e3%83%ac%e3%82%af%e3%83%88%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88%e3%81%ae%e6%94%b9%e5%96%84 aria-label=リダイレクトサポートの改善>リダイレクトサポートの改善</a></li><li><a href=#%e3%81%ae%e3%82%b5%e3%83%9d%e3%83%bc%e3%83%88 aria-label=$?のサポート><code>$?</code>のサポート</a></li></ul></li><li><a href=#deno-publish aria-label="deno publish"><code>deno publish</code></a></li><li><a href=#deno-test aria-label="deno test"><code>deno test</code></a><ul><li><a href=#junit%e3%83%ac%e3%83%9d%e3%83%bc%e3%82%bf%e3%83%bc%e3%81%ab%e3%81%8a%e3%81%91%e3%82%8b%e3%82%b5%e3%83%96%e3%82%b9%e3%83%86%e3%83%83%e3%83%97%e3%81%ae%e5%8f%96%e3%82%8a%e6%89%b1%e3%81%84%e3%81%8c%e6%94%b9%e5%96%84 aria-label=JUnitレポーターにおけるサブステップの取り扱いが改善>JUnitレポーターにおけるサブステップの取り扱いが改善</a></li></ul></li><li><a href=#deno-lsp aria-label="deno lsp"><code>deno lsp</code></a></li><li><a href=#deno-check aria-label="deno check"><code>deno check</code></a></li><li><a href=#cli aria-label=CLI>CLI</a><ul><li><a href=#vendor%e3%83%87%e3%82%a3%e3%83%ac%e3%82%af%e3%83%88%e3%83%aa%e3%81%ae%e5%8f%96%e3%82%8a%e6%89%b1%e3%81%84%e3%81%ae%e5%a4%89%e6%9b%b4 aria-label=vendorディレクトリの取り扱いの変更><code>vendor</code>ディレクトリの取り扱いの変更</a></li><li><a href=#--watch-exclude%e3%82%aa%e3%83%97%e3%82%b7%e3%83%a7%e3%83%b3%e3%81%8c%e8%bf%bd%e5%8a%a0 aria-label=--watch-excludeオプションが追加><code>--watch-exclude</code>オプションが追加</a></li></ul></li><li><a href=#typescript aria-label=TypeScript>TypeScript</a><ul><li><a href=#typescript-v54%e3%81%b8%e3%81%ae%e3%82%a2%e3%83%83%e3%83%97%e3%83%87%e3%83%bc%e3%83%88 aria-label="TypeScript v5.4へのアップデート">TypeScript v5.4へのアップデート</a></li><li><a href=#%e6%96%b0%e3%81%97%e3%81%84set%e3%83%a1%e3%82%bd%e3%83%83%e3%83%89%e3%81%ae%e5%9e%8b%e5%ae%9a%e7%be%a9 aria-label=新しいSetメソッドの型定義>新しい<code>Set</code>メソッドの型定義</a></li></ul></li><li><a href=#web-api aria-label="Web API">Web API</a><ul><li><a href=#eventsource%e3%81%ae%e6%94%b9%e5%96%84 aria-label=EventSourceの改善><code>EventSource</code>の改善</a></li><li><a href=#structuredclone%e3%81%ae%e5%9e%8b%e5%ae%9a%e7%be%a9%e3%81%8c%e4%bf%ae%e6%ad%a3 aria-label=structuredCloneの型定義が修正><code>structuredClone</code>の型定義が修正</a></li></ul></li><li><a href=#nodejs%e4%ba%92%e6%8f%9b%e6%80%a7%e3%81%ae%e6%94%b9%e5%96%84 aria-label=Node.js互換性の改善>Node.js互換性の改善</a><ul><li><a href=#nodefs aria-label=node:fs><code>node:fs</code></a></li><li><a href=#nodeevents aria-label=node:events><code>node:events</code></a></li><li><a href=#nodecrypto aria-label=node:crypto><code>node:crypto</code></a></li><li><a href=#nodestring_decoder aria-label=node:string_decoder><code>node:string_decoder</code></a></li><li><a href=#nodechild_process aria-label=node:child_process><code>node:child_process</code></a></li><li><a href=#nodev8 aria-label=node:v8><code>node:v8</code></a></li><li><a href=#nodeworker_threads aria-label=node:worker_threads><code>node:worker_threads</code></a></li></ul></li><li><a href=#%e5%8f%82%e8%80%83 aria-label=参考>参考</a></li></ul></div></details></div><div class=post-content><p>Deno v1.42がリリースされました。</p><p>この記事では主な変更点などについて解説します。</p><h2 id=deno-v2に向けた変更>Deno v2に向けた変更<a hidden class=anchor aria-hidden=true href=#deno-v2に向けた変更>#</a></h2><h3 id=deno_futureによるdeno配下の非推奨apiの削除><code>DENO_FUTURE</code>による<code>Deno.*</code>配下の非推奨APIの削除<a hidden class=anchor aria-hidden=true href=#deno_futureによるdeno配下の非推奨apiの削除>#</a></h3><p><a href=https://uki00a.github.io/deno-weekly/articles/2024/02/18.html><code>DENO_FUTURE=1</code></a>を指定すると、<a href=https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html><code>Deno.*</code>配下の非推奨API</a>が削除されるようになりました。</p><h3 id=deno-installに--globalオプションが追加><code>deno install</code>に<code>--global</code>オプションが追加<a hidden class=anchor aria-hidden=true href=#deno-installに--globalオプションが追加>#</a></h3><p><code>deno install</code>コマンドはインターネット上などで公開されたスクリプトをインストールするためのコマンドです。(デフォルトのインストール先は<code>$HOME/.deno</code>)</p><p>Deno v2ではこの<code>deno install</code>コマンドはデフォルトで<a href=https://uki00a.github.io/deno-weekly/articles/2024/03/03.html><code>deno add</code></a>コマンドのエイリアスとして機能するように変更される予定のようです。</p><blockquote><p><a href=https://github.com/denoland/deno/issues/23062><code>deno install</code> changes for Deno 2 (#23062)</a></p></blockquote><p>この変更に向けて<code>deno install</code>コマンドに<code>--global</code>/<code>-g</code>オプションが追加されました。Deno v2のリリース以降、Deno v1における<code>deno install</code>と同じ振る舞いをさせるためには、この<code>--global</code>オプションを指定する必要があります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno install --global --allow-read<span style=color:#f92672>=</span>. --allow-write<span style=color:#f92672>=</span>. --allow-net https://deno.land/x/udd/main.ts
</span></span></code></pre></div><h2 id=deno-lint><code>deno lint</code><a hidden class=anchor aria-hidden=true href=#deno-lint>#</a></h2><h3 id=quickfixのサポート>Quickfixのサポート<a hidden class=anchor aria-hidden=true href=#quickfixのサポート>#</a></h3><p><code>deno lint</code>と<code>deno lsp</code>でQuickfixがサポートされました。<code>deno lint</code>では<code>--fix</code>オプションによりQuickfixを実行できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno lint --fix main.js
</span></span></code></pre></div><p>今のところ以下のルールでQuickfixがサポートされています。</p><ul><li><code>no-window</code></li><li><code>no-window-prefix</code></li><li><code>verbatim-module-syntax</code></li></ul><h3 id=jsr関連のルールの自動適用><code>jsr</code>関連のルールの自動適用<a hidden class=anchor aria-hidden=true href=#jsr関連のルールの自動適用>#</a></h3><p><code>deno.json</code>に<code>name</code>/<code>version</code>/<code>exports</code>が定義されていたら、<code>jsr</code>関連のlintルールが自動で有効化されるように挙動が変更されています。</p><p>適用されるルールについては以下で確認できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno lint --rules-tags<span style=color:#f92672>=</span>jsr --rules
</span></span></code></pre></div><h2 id=deno-task><code>deno task</code><a hidden class=anchor aria-hidden=true href=#deno-task>#</a></h2><h3 id=タスクのコメント>タスクのコメント<a hidden class=anchor aria-hidden=true href=#タスクのコメント>#</a></h3><p><code>deno task</code>コマンドがタスクに記述されたコメントを認識してくれます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// deno.jsonc
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>{
</span></span><span style=display:flex><span>  <span style=color:#e6db74>&#34;tasks&#34;</span><span style=color:#f92672>:</span> {
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Run tests
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#e6db74>&#34;test&#34;</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;deno test --allow-read=. --trace-leaks&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno task
</span></span><span style=display:flex><span>Available tasks:
</span></span><span style=display:flex><span>- test
</span></span><span style=display:flex><span>    // Run tests
</span></span><span style=display:flex><span>    deno test --allow-read<span style=color:#f92672>=</span>. --trace-leaks
</span></span></code></pre></div><h3 id=shebangのサポート>shebangのサポート<a hidden class=anchor aria-hidden=true href=#shebangのサポート>#</a></h3><p>以下のようにスクリプトを実行するタスクを定義します。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;tasks&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;script&#34;</span>: <span style=color:#e6db74>&#34;./my_script.js&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>するとこのスクリプトに記述されたshebangを<code>deno task</code>が認識してくれるようになりました。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>#!/usr/bin/env -S deno run
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>info</span>(<span style=color:#e6db74>&#34;foo&#34;</span>);
</span></span></code></pre></div><h3 id=リダイレクトサポートの改善>リダイレクトサポートの改善<a hidden class=anchor aria-hidden=true href=#リダイレクトサポートの改善>#</a></h3><p>入力リダイレクトがサポートされています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;tasks&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;script&#34;</span>: <span style=color:#e6db74>&#34;jq .tasks &lt; deno.jsonc&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>また指定したファイルディスクリプタへのリダイレクトもサポートされています。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;tasks&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;script&#34;</span>: <span style=color:#e6db74>&#34;deno run some_script.js 2&gt;&amp;1&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=のサポート><code>$?</code>のサポート<a hidden class=anchor aria-hidden=true href=#のサポート>#</a></h3><p>スクリプトで<code>$?</code>を参照できます。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json><span style=display:flex><span>{
</span></span><span style=display:flex><span>  <span style=color:#f92672>&#34;tasks&#34;</span>: {
</span></span><span style=display:flex><span>    <span style=color:#f92672>&#34;script&#34;</span>: <span style=color:#e6db74>&#34;deno run some_script.js || echo $?&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h2 id=deno-publish><code>deno publish</code><a hidden class=anchor aria-hidden=true href=#deno-publish>#</a></h2><ul><li><code>deno publish --dry-run</code>でコミットされていないファイルが検出されたらエラーが起きるように改善されています。</li><li><code>deno publish</code>の実行時に、パッケージに含まれるべきモジュールが<code>exclude</code>などで除外されていた場合、エラーが発生するように挙動が変更されています。</li></ul><h2 id=deno-test><code>deno test</code><a hidden class=anchor aria-hidden=true href=#deno-test>#</a></h2><h3 id=junitレポーターにおけるサブステップの取り扱いが改善>JUnitレポーターにおけるサブステップの取り扱いが改善<a hidden class=anchor aria-hidden=true href=#junitレポーターにおけるサブステップの取り扱いが改善>#</a></h3><p>JUnitレポーター(<code>--reporter=junit</code>)でサブステップ(<a href="https://deno.land/api@v1.42.0?s=Deno.TestContext#method_step_0"><code>t.step</code></a>)の取り扱いが改善されています。</p><p>今まで<code>t.step</code>で定義されたテストケースは<code>&lt;property></code>によって表現されていたものの、<a href=https://github.com/gotestyourself/gotestsum>gotestsum</a>や<a href=https://github.com/vitest-dev/vitest>vitest</a>などと同様に<code>&lt;testcase></code>が使用されるように変更されています。</p><p>これにより<code>t.step</code>が失敗した際により詳細なエラーメッセージなどを含めることができるように改善されているようです。</p><h2 id=deno-lsp><code>deno lsp</code><a hidden class=anchor aria-hidden=true href=#deno-lsp>#</a></h2><p><a href=https://github.com/denoland/vscode_deno>vscode_deno</a>で<code>Deno: Reload Import Registries Cache</code>コマンドを実行してもjsrパッケージが再読み込みされない問題が修正されています。</p><h2 id=deno-check><code>deno check</code><a hidden class=anchor aria-hidden=true href=#deno-check>#</a></h2><p><code>deno check</code>コマンドでは<code>--unstable</code>の指定を提案しないように変更されています。</p><p>これは<code>/// &lt;reference no-default-lib="true"/></code>が使われており、かつ<code>deno.unstable</code>が読み込まれていない場合を想定した変更のようです。この場合、<code>deno check</code>は<code>--unstable</code>の指定を提案するものの、<a href=https://uki00a.github.io/deno-weekly/articles/deno/v1.40.html>実際に<code>--unstable</code>を指定しても効果がない</a>ため、混乱を招いてしまうというのがこの変更の理由のようです。</p><h2 id=cli>CLI<a hidden class=anchor aria-hidden=true href=#cli>#</a></h2><h3 id=vendorディレクトリの取り扱いの変更><code>vendor</code>ディレクトリの取り扱いの変更<a hidden class=anchor aria-hidden=true href=#vendorディレクトリの取り扱いの変更>#</a></h3><p>今まで、Denoの各コマンドは<code>vendor</code>と名のついたディレクトリをデフォルトで除外していました。</p><p>Deno v1.42でこの挙動が変更され、<code>deno.json</code>で<code>"vendor": true</code>が指定されていない場合は、<code>vendor/</code>ディレクトリがデフォルトで無視されなくなりました。</p><p><a href=https://uki00a.github.io/deno-weekly/articles/deno/v1.41.html>Deno v1.41</a>までの挙動に戻したい場合は、<code>deno.json</code>の<code>exclude</code>などで明示的に除外する必要があります。</p><hr><p><a href=https://github.com/denoland/deno/pull/23100>https://github.com/denoland/deno/pull/23100</a></p><h3 id=--watch-excludeオプションが追加><code>--watch-exclude</code>オプションが追加<a hidden class=anchor aria-hidden=true href=#--watch-excludeオプションが追加>#</a></h3><p>このオプションで指定されたファイルが変更された際は、<code>--watch</code>による再起動が行われなくなります。</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ deno run --watch-exclude<span style=color:#f92672>=</span>data.json --watch main.js
</span></span></code></pre></div><h2 id=typescript>TypeScript<a hidden class=anchor aria-hidden=true href=#typescript>#</a></h2><h3 id=typescript-v54へのアップデート>TypeScript v5.4へのアップデート<a hidden class=anchor aria-hidden=true href=#typescript-v54へのアップデート>#</a></h3><p>Deno本体に搭載されたTypeScriptがv5.4へアップデートされています。</p><ul><li><a href=https://devblogs.microsoft.com/typescript/announcing-typescript-5-4/>Announcing TypeScript 5.4</a></li></ul><h3 id=新しいsetメソッドの型定義>新しい<code>Set</code>メソッドの型定義<a hidden class=anchor aria-hidden=true href=#新しいsetメソッドの型定義>#</a></h3><p><a href=https://github.com/tc39/proposal-set-methods>proposal-set-methods</a>で提案されている<code>Set</code>の新しいメソッドに関する型定義が追加されました。</p><h2 id=web-api>Web API<a hidden class=anchor aria-hidden=true href=#web-api>#</a></h2><h3 id=eventsourceの改善><code>EventSource</code>の改善<a hidden class=anchor aria-hidden=true href=#eventsourceの改善>#</a></h3><p><code>EventSource</code>で発生するリソースリークなどの問題が修正されています。</p><p>また、<code>EventSource</code>で受け取ったメッセージのフィールドに<code>:</code>を含む値が設定されていた場合に、意図せずして値が部分的に切り取られてしまう問題も修正されています。</p><h3 id=structuredcloneの型定義が修正><code>structuredClone</code>の型定義が修正<a hidden class=anchor aria-hidden=true href=#structuredcloneの型定義が修正>#</a></h3><p><code>structuredClone</code>の型定義がTypeScript公式と同様の定義に合わせられました。</p><h2 id=nodejs互換性の改善>Node.js互換性の改善<a hidden class=anchor aria-hidden=true href=#nodejs互換性の改善>#</a></h2><h3 id=nodefs><code>node:fs</code><a hidden class=anchor aria-hidden=true href=#nodefs>#</a></h3><p><code>FSWatcher#unref</code>が実装されました。</p><h3 id=nodeevents><code>node:events</code><a hidden class=anchor aria-hidden=true href=#nodeevents>#</a></h3><p><code>EventEmitterAsyncResource</code>が実装されました。</p><h3 id=nodecrypto><code>node:crypto</code><a hidden class=anchor aria-hidden=true href=#nodecrypto>#</a></h3><ul><li><code>ECDH</code>の<code>getPublicKey</code>/<code>generateKeys</code>メソッドで<code>format</code>引数がサポート</li><li><code>getRandomValues</code>が追加</li><li><code>subtle</code>が追加</li><li><code>createPublicKey</code>でEC鍵がサポート</li></ul><h3 id=nodestring_decoder><code>node:string_decoder</code><a hidden class=anchor aria-hidden=true href=#nodestring_decoder>#</a></h3><p>内部実装が再実装され、Node.jsとの互換性が改善されています。</p><h3 id=nodechild_process><code>node:child_process</code><a hidden class=anchor aria-hidden=true href=#nodechild_process>#</a></h3><p><code>spawnSync</code>などの<code>stdio</code>オプションに<code>[null, null, null]</code>を指定した際に<code>["pipe", "pipe", "pipe"]</code>と同様に取り扱われるように改善されました。</p><h3 id=nodev8><code>node:v8</code><a hidden class=anchor aria-hidden=true href=#nodev8>#</a></h3><p><code>serialize</code>/<code>deserialize</code>が実装されました。</p><h3 id=nodeworker_threads><code>node:worker_threads</code><a hidden class=anchor aria-hidden=true href=#nodeworker_threads>#</a></h3><ul><li><code>Worker</code>の<code>workerData</code>オプションに<code>MessagePort</code>を渡せるように改善されました。</li><li>ESMモジュールがCJSモジュールとして実行されてしまうことがある問題が修正されました。</li><li><code>parentPort</code>に<code>message</code>リスナーが登録されている際は、プロセスの終了がブロックされるように挙動が変更されました。</li></ul><h2 id=参考>参考<a hidden class=anchor aria-hidden=true href=#参考>#</a></h2><ul><li><a href=https://github.com/denoland/deno/releases/tag/v1.42.0>https://github.com/denoland/deno/releases/tag/v1.42.0</a></li><li><a href=https://deno.com/blog/v1.42>Deno 1.42: Better dependency management with JSR</a></li></ul></div><footer class=post-footer><ul class=post-tags><li><a href=https://uki00a.github.io/deno-weekly/tags/deno.html>deno</a></li><li><a href=https://uki00a.github.io/deno-weekly/tags/jsr.html>jsr</a></li></ul></footer></article></main><footer class=footer><span>&copy; 2025 <a href=https://uki00a.github.io/deno-weekly/>週刊Deno</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(t){t.preventDefault();var e=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(e)}']`).scrollIntoView({behavior:"smooth"}),e==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${e}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>