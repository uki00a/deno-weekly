<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>2021/06/20〜2022/06/26の最新情報 | 週刊Deno</title>
<meta name=keywords content="Deno,deno_std,fresh,webview_deno">
<meta name=description content="Deno v1.23.1 Deno v1.23.1がリリースされました。
FFI関連の変更点 破壊的変更としてDeno.UnsafePointerが削除されました。 (正確にはDeno.UnsafePointer.ofのみ残されています) 今後、ポインタはbigintで表現されます。
その他には、unstable APIとしてDeno.UnsafeCallbackが追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。
deno fmtの改善 deno fmtコマンドがnode_modulesと.gitディレクトリを無視するようになりました。
また、JavaScriptファイルのパースに失敗した際に、deno fmt --checkがちゃんと失敗するように修正されています。
その他の変更点  fetchの呼び出し時に、デフォルトでAccept-Language: *ヘッダが設定されるように修正されました。 deno replコマンドで、直前の文字が空白のときにTabキーを押すと、タブ(\t)が挿入されるように修正されました。 deno runコマンドで.d.ctsや.d.mtsファイルを実行すると、プロセスがパニックする問題が修正されました。   https://github.com/denoland/deno/releases/tag/v1.23.1
deno_std v0.145.0 deno_std v0.145.0がリリースされました。
std/encoding/json/stream std/encoding/json/streamが追加されました。
このモジュールでは、下記4フォーマットでのストリーミングがサポートされています。
 JSON Lines ndjson JSON Text Sequences Concatenated JSON  JSONParseStreamは上記の上から3つのフォーマットをサポートしています。
import { JSONParseStream } from &#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;; import { readableStreamFromIterable } from &#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;; const readable = readableStreamFromIterable([ `{&#34;name&#34;: &#34;foo&#34;}`, `{&#34;a&#34;: 1, &#34;b&#34;: true}`, ]) .">
<meta name=author content>
<link rel=canonical href=https://uki00a.github.io/deno-weekly/articles/2022/06/26.html>
<link crossorigin=anonymous href=/deno-weekly/assets/css/stylesheet.bccfefac377bc340f06c260aed1bddf49a4354816d7c570d6aac75a997986c95.css integrity="sha256-vM/vrDd7w0DwbCYK7Rvd9JpDVIFtfFcNaqx1qZeYbJU=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/deno-weekly/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://uki00a.github.io/deno-weekly/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://uki00a.github.io/deno-weekly/favicon-32x32.png>
<link rel=apple-touch-icon href=https://uki00a.github.io/deno-weekly/apple-touch-icon.png>
<link rel=mask-icon href=https://uki00a.github.io/deno-weekly/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png">
<meta property="twitter:image" content="https://raw.githubusercontent.com/uki00a/blog/master/src/assets/avatar.png">
<meta name=twitter:site content="@uki00a">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-MK2K2MRMBF"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-MK2K2MRMBF',{anonymize_ip:!1})}</script>
<meta property="og:title" content="2021/06/20〜2022/06/26の最新情報">
<meta property="og:description" content="Deno v1.23.1 Deno v1.23.1がリリースされました。
FFI関連の変更点 破壊的変更としてDeno.UnsafePointerが削除されました。 (正確にはDeno.UnsafePointer.ofのみ残されています) 今後、ポインタはbigintで表現されます。
その他には、unstable APIとしてDeno.UnsafeCallbackが追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。
deno fmtの改善 deno fmtコマンドがnode_modulesと.gitディレクトリを無視するようになりました。
また、JavaScriptファイルのパースに失敗した際に、deno fmt --checkがちゃんと失敗するように修正されています。
その他の変更点  fetchの呼び出し時に、デフォルトでAccept-Language: *ヘッダが設定されるように修正されました。 deno replコマンドで、直前の文字が空白のときにTabキーを押すと、タブ(\t)が挿入されるように修正されました。 deno runコマンドで.d.ctsや.d.mtsファイルを実行すると、プロセスがパニックする問題が修正されました。   https://github.com/denoland/deno/releases/tag/v1.23.1
deno_std v0.145.0 deno_std v0.145.0がリリースされました。
std/encoding/json/stream std/encoding/json/streamが追加されました。
このモジュールでは、下記4フォーマットでのストリーミングがサポートされています。
 JSON Lines ndjson JSON Text Sequences Concatenated JSON  JSONParseStreamは上記の上から3つのフォーマットをサポートしています。
import { JSONParseStream } from &#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;; import { readableStreamFromIterable } from &#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;; const readable = readableStreamFromIterable([ `{&#34;name&#34;: &#34;foo&#34;}`, `{&#34;a&#34;: 1, &#34;b&#34;: true}`, ]) .">
<meta property="og:type" content="article">
<meta property="og:url" content="https://uki00a.github.io/deno-weekly/articles/2022/06/26.html"><meta property="article:section" content="articles">
<meta property="article:published_time" content="2022-06-26T00:00:00+00:00">
<meta property="article:modified_time" content="2022-06-26T00:00:00+00:00">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="2021/06/20〜2022/06/26の最新情報">
<meta name=twitter:description content="Deno v1.23.1 Deno v1.23.1がリリースされました。
FFI関連の変更点 破壊的変更としてDeno.UnsafePointerが削除されました。 (正確にはDeno.UnsafePointer.ofのみ残されています) 今後、ポインタはbigintで表現されます。
その他には、unstable APIとしてDeno.UnsafeCallbackが追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。
deno fmtの改善 deno fmtコマンドがnode_modulesと.gitディレクトリを無視するようになりました。
また、JavaScriptファイルのパースに失敗した際に、deno fmt --checkがちゃんと失敗するように修正されています。
その他の変更点  fetchの呼び出し時に、デフォルトでAccept-Language: *ヘッダが設定されるように修正されました。 deno replコマンドで、直前の文字が空白のときにTabキーを押すと、タブ(\t)が挿入されるように修正されました。 deno runコマンドで.d.ctsや.d.mtsファイルを実行すると、プロセスがパニックする問題が修正されました。   https://github.com/denoland/deno/releases/tag/v1.23.1
deno_std v0.145.0 deno_std v0.145.0がリリースされました。
std/encoding/json/stream std/encoding/json/streamが追加されました。
このモジュールでは、下記4フォーマットでのストリーミングがサポートされています。
 JSON Lines ndjson JSON Text Sequences Concatenated JSON  JSONParseStreamは上記の上から3つのフォーマットをサポートしています。
import { JSONParseStream } from &#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;; import { readableStreamFromIterable } from &#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;; const readable = readableStreamFromIterable([ `{&#34;name&#34;: &#34;foo&#34;}`, `{&#34;a&#34;: 1, &#34;b&#34;: true}`, ]) .">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"2021/06/20〜2022/06/26の最新情報","item":"https://uki00a.github.io/deno-weekly/articles/2022/06/26.html"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"2021/06/20〜2022/06/26の最新情報","name":"2021\/06\/20〜2022\/06\/26の最新情報","description":"Deno v1.23.1 Deno v1.23.1がリリースされました。\nFFI関連の変更点 破壊的変更としてDeno.UnsafePointerが削除されました。 (正確にはDeno.UnsafePointer.ofのみ残されています) 今後、ポインタはbigintで表現されます。\nその他には、unstable APIとしてDeno.UnsafeCallbackが追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。\ndeno fmtの改善 deno fmtコマンドがnode_modulesと.gitディレクトリを無視するようになりました。\nまた、JavaScriptファイルのパースに失敗した際に、deno fmt --checkがちゃんと失敗するように修正されています。\nその他の変更点  fetchの呼び出し時に、デフォルトでAccept-Language: *ヘッダが設定されるように修正されました。 deno replコマンドで、直前の文字が空白のときにTabキーを押すと、タブ(\\t)が挿入されるように修正されました。 deno runコマンドで.d.ctsや.d.mtsファイルを実行すると、プロセスがパニックする問題が修正されました。   https://github.com/denoland/deno/releases/tag/v1.23.1\ndeno_std v0.145.0 deno_std v0.145.0がリリースされました。\nstd/encoding/json/stream std/encoding/json/streamが追加されました。\nこのモジュールでは、下記4フォーマットでのストリーミングがサポートされています。\n JSON Lines ndjson JSON Text Sequences Concatenated JSON  JSONParseStreamは上記の上から3つのフォーマットをサポートしています。\nimport { JSONParseStream } from \u0026#34;https://deno.land/std@0.145.0/encoding/json/stream.ts\u0026#34;; import { readableStreamFromIterable } from \u0026#34;https://deno.land/std@0.145.0/streams/conversion.ts\u0026#34;; const readable = readableStreamFromIterable([ `{\u0026#34;name\u0026#34;: \u0026#34;foo\u0026#34;}`, `{\u0026#34;a\u0026#34;: 1, \u0026#34;b\u0026#34;: true}`, ]) .","keywords":["Deno","deno_std","fresh","webview_deno"],"articleBody":"Deno v1.23.1 Deno v1.23.1がリリースされました。\nFFI関連の変更点 破壊的変更としてDeno.UnsafePointerが削除されました。 (正確にはDeno.UnsafePointer.ofのみ残されています) 今後、ポインタはbigintで表現されます。\nその他には、unstable APIとしてDeno.UnsafeCallbackが追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。\ndeno fmtの改善 deno fmtコマンドがnode_modulesと.gitディレクトリを無視するようになりました。\nまた、JavaScriptファイルのパースに失敗した際に、deno fmt --checkがちゃんと失敗するように修正されています。\nその他の変更点  fetchの呼び出し時に、デフォルトでAccept-Language: *ヘッダが設定されるように修正されました。 deno replコマンドで、直前の文字が空白のときにTabキーを押すと、タブ(\\t)が挿入されるように修正されました。 deno runコマンドで.d.ctsや.d.mtsファイルを実行すると、プロセスがパニックする問題が修正されました。   https://github.com/denoland/deno/releases/tag/v1.23.1\ndeno_std v0.145.0 deno_std v0.145.0がリリースされました。\nstd/encoding/json/stream std/encoding/json/streamが追加されました。\nこのモジュールでは、下記4フォーマットでのストリーミングがサポートされています。\n JSON Lines ndjson JSON Text Sequences Concatenated JSON  JSONParseStreamは上記の上から3つのフォーマットをサポートしています。\nimport { JSONParseStream } from \"https://deno.land/std@0.145.0/encoding/json/stream.ts\"; import { readableStreamFromIterable } from \"https://deno.land/std@0.145.0/streams/conversion.ts\"; const readable = readableStreamFromIterable([ `{\"name\": \"foo\"}`, `{\"a\": 1, \"b\": true}`, ]) .pipeThrough(new JSONParseStream()); for await (const json of readable) { console.log(json); // Output:  // { name: \"foo\" }  // { a: 1, b: true } } ConcatenatedJSONParseStreamを使うと、Concatenated JSONを取り扱うことができます。\nimport { ConcatenatedJSONParseStream } from \"https://deno.land/std@0.145.0/encoding/json/stream.ts\"; import { readableStreamFromIterable } from \"https://deno.land/std@0.145.0/streams/conversion.ts\"; const readable = readableStreamFromIterable([`{\"a\": 1}{\"name\": \"foo\",\"b\":true}{\"arr\":[1,2,3]}`]) .pipeThrough(new ConcatenatedJSONParseStream()); for await (const json of readable) { console.log(json); // Output:  // { a: 1 }  // { name: \"foo\", b: true }  // { arr: [ 1, 2, 3 ] } } JSONStringifyStreamを使うと、値を上記4つのいずれかの形式でストリーミングを行うことができます。\nimport { JSONStringifyStream } from \"https://deno.land/std@0.145.0/encoding/json/stream.ts\"; import { readableStreamFromIterable } from \"https://deno.land/std@0.145.0/streams/conversion.ts\"; const file = await Deno.open(\"data.jsonl\", { create: true, write: true }); await readableStreamFromIterable([{ name: \"foo\" }, { b: true, n: 123 }]) .pipeThrough(new JSONStringifyStream()) .pipeThrough(new TextEncoderStream()) .pipeTo(file.writable); その他の変更点  std/flags: parse()の戻り値の型がオプションの内容からより賢く推論されるようになりました。 std/media_types: contentType()の型定義が改善されました。  元々、戻り値の型定義がstring | undefinedだったため、Headersオブジェクトなどと併用するのが難しい問題がありました。 例えば、下記のように、あらかじめstd/media_typesが把握しているタイプを引数に指定すると、戻り値がstring型として絞り込まれるように型定義が改善されています。  contentType(\".json\"); // = string  std/encoding/csv/stream: CRの取り扱いが改善されました。   https://github.com/denoland/deno_std/releases/tag/0.145.0\nDenoが$21Mを調達 詳細については、下記の記事で解説されています。\n Deno raises $21M  DenoやDeno Deployがどのような背景・目的で開発されているのかについても解説されています。\n  Deno raises $21M #45: Deno raises $21M | Deno News  webview_deno v0.7.0 webview_deno v0.7.0がリリースされています。\n大きな変更点として、内部実装がFFI(Deno.dlopen)を使用した形式へ書き直されています。\nまた、Denoで定義した関数をwebview側から呼ぶために、Webview#bindが追加されています。\n https://github.com/webview/webview_deno/releases/tag/0.7.0\nFresh v1.0.0-rc.1 Fresh v1.0.0のRC版が公開されました。\n合わせて、deno.land/xにFreshが公開されています。\n https://deno.land/x/fresh  これにより、バージョンを明示した上でFreshを利用できるようになりました。\n https://github.com/lucacasonato/fresh/releases/tag/1.0.0-rc.1\n","wordCount":"232","inLanguage":"en","datePublished":"2022-06-26T00:00:00Z","dateModified":"2022-06-26T00:00:00Z","mainEntityOfPage":{"@type":"WebPage","@id":"https://uki00a.github.io/deno-weekly/articles/2022/06/26.html"},"publisher":{"@type":"Organization","name":"週刊Deno","logo":{"@type":"ImageObject","url":"https://raw.githubusercontent.com/uki00a/blog/master/src/assets/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://uki00a.github.io/deno-weekly/ accesskey=h title="週刊Deno (Alt + H)">週刊Deno</a>
<div class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</div>
</div>
<ul id=menu>
<li>
<a href=https://uki00a.github.io/deno-weekly/tags.html title=タグ>
<span><i class="fa fa-heart"></i>タグ</span>
</a>
</li>
<li>
<a href=https://uki00a.github.io/deno-weekly/categories.html title=カテゴリー>
<span><i class="fa fa-heart"></i>カテゴリー</span>
</a>
</li>
<li>
<a href=https://uki00a.github.io/deno-weekly/gallery.html title=ギャラリー>
<span><i class="fa fa-road"></i>ギャラリー<span class=alert></span></span>
</a>
</li>
<li>
<a href=https://uki00a.github.io/deno-weekly/index.xml title="RSS feed">
<span><i class="fa fa-road"></i>RSS feed<span class=alert></span></span>
</a>
</li>
<li>
<a href=https://uki00a.github.io/deno-weekly/about.html title=About>
<span><i class="fa fa-road"></i>About<span class=alert></span></span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
2021/06/20〜2022/06/26の最新情報
</h1>
<div class=post-meta><span title="2022-06-26 00:00:00 +0000 UTC">June 26, 2022</span>
</div>
</header> <div class=toc>
<details>
<summary accesskey=c title="(Alt + C)">
<span class=details>Table of Contents</span>
</summary>
<div class=inner><ul>
<li>
<a href=#deno-v1231 aria-label="Deno v1.23.1">Deno v1.23.1</a><ul>
<li>
<a href=#ffi%e9%96%a2%e9%80%a3%e3%81%ae%e5%a4%89%e6%9b%b4%e7%82%b9 aria-label=FFI関連の変更点>FFI関連の変更点</a></li>
<li>
<a href=#deno-fmt%e3%81%ae%e6%94%b9%e5%96%84 aria-label="deno fmtの改善"><code>deno fmt</code>の改善</a></li>
<li>
<a href=#%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e5%a4%89%e6%9b%b4%e7%82%b9 aria-label=その他の変更点>その他の変更点</a></li></ul>
</li>
<li>
<a href=#deno_std-v01450 aria-label="deno_std v0.145.0">deno_std v0.145.0</a><ul>
<li>
<a href=#stdencodingjsonstream aria-label=std/encoding/json/stream><code>std/encoding/json/stream</code></a></li>
<li>
<a href=#%e3%81%9d%e3%81%ae%e4%bb%96%e3%81%ae%e5%a4%89%e6%9b%b4%e7%82%b9-1 aria-label=その他の変更点>その他の変更点</a></li></ul>
</li>
<li>
<a href=#deno%e3%81%8c21m%e3%82%92%e8%aa%bf%e9%81%94 aria-label=Denoが$21Mを調達>Denoが$21Mを調達</a></li>
<li>
<a href=#webview_deno-v070 aria-label="webview_deno v0.7.0">webview_deno v0.7.0</a></li>
<li>
<a href=#fresh-v100-rc1 aria-label="Fresh v1.0.0-rc.1">Fresh v1.0.0-rc.1</a>
</li>
</ul>
</div>
</details>
</div>
<div class=post-content><h2 id=deno-v1231>Deno v1.23.1<a hidden class=anchor aria-hidden=true href=#deno-v1231>#</a></h2>
<p>Deno v1.23.1がリリースされました。</p>
<h3 id=ffi関連の変更点>FFI関連の変更点<a hidden class=anchor aria-hidden=true href=#ffi関連の変更点>#</a></h3>
<p>破壊的変更として<code>Deno.UnsafePointer</code>が削除されました。 (正確には<code>Deno.UnsafePointer.of</code>のみ残されています) 今後、ポインタは<code>bigint</code>で表現されます。</p>
<p>その他には、unstable APIとして<code>Deno.UnsafeCallback</code>が追加されています。 JavaScriptの関数を関数ポインタとして受け渡すために利用できます。</p>
<h3 id=deno-fmtの改善><code>deno fmt</code>の改善<a hidden class=anchor aria-hidden=true href=#deno-fmtの改善>#</a></h3>
<p><code>deno fmt</code>コマンドが<code>node_modules</code>と<code>.git</code>ディレクトリを無視するようになりました。</p>
<p>また、JavaScriptファイルのパースに失敗した際に、<code>deno fmt --check</code>がちゃんと失敗するように修正されています。</p>
<h3 id=その他の変更点>その他の変更点<a hidden class=anchor aria-hidden=true href=#その他の変更点>#</a></h3>
<ul>
<li><code>fetch</code>の呼び出し時に、デフォルトで<code>Accept-Language: *</code>ヘッダが設定されるように修正されました。</li>
<li><code>deno repl</code>コマンドで、直前の文字が空白のときに<code>Tab</code>キーを押すと、タブ(<code>\t</code>)が挿入されるように修正されました。</li>
<li><code>deno run</code>コマンドで<code>.d.cts</code>や<code>.d.mts</code>ファイルを実行すると、プロセスがパニックする問題が修正されました。</li>
</ul>
<hr>
<p><a href=https://github.com/denoland/deno/releases/tag/v1.23.1>https://github.com/denoland/deno/releases/tag/v1.23.1</a></p>
<h2 id=deno_std-v01450>deno_std v0.145.0<a hidden class=anchor aria-hidden=true href=#deno_std-v01450>#</a></h2>
<p>deno_std v0.145.0がリリースされました。</p>
<h3 id=stdencodingjsonstream><code>std/encoding/json/stream</code><a hidden class=anchor aria-hidden=true href=#stdencodingjsonstream>#</a></h3>
<p><code>std/encoding/json/stream</code>が追加されました。</p>
<p>このモジュールでは、下記4フォーマットでのストリーミングがサポートされています。</p>
<ul>
<li><a href=https://jsonlines.org/>JSON Lines</a></li>
<li><a href=http://ndjson.org/>ndjson</a></li>
<li><a href=https://datatracker.ietf.org/doc/html/rfc7464>JSON Text Sequences</a></li>
<li><a href=https://en.wikipedia.org/wiki/JSON_streaming#Concatenated_JSON>Concatenated JSON</a></li>
</ul>
<p><code>JSONParseStream</code>は上記の上から3つのフォーマットをサポートしています。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>JSONParseStream</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>readableStreamFromIterable</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>readable</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readableStreamFromIterable</span>([
  <span style=color:#e6db74>`{&#34;name&#34;: &#34;foo&#34;}`</span>,
  <span style=color:#e6db74>`{&#34;a&#34;: 1, &#34;b&#34;: true}`</span>,
])
  .<span style=color:#a6e22e>pipeThrough</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JSONParseStream</span>());

<span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>json</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>readable</span>) {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>json</span>);
  <span style=color:#75715e>// Output:
</span><span style=color:#75715e></span>  <span style=color:#75715e>// { name: &#34;foo&#34; }
</span><span style=color:#75715e></span>  <span style=color:#75715e>// { a: 1, b: true }
</span><span style=color:#75715e></span>}
</code></pre></div><p><code>ConcatenatedJSONParseStream</code>を使うと、<code>Concatenated JSON</code>を取り扱うことができます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>ConcatenatedJSONParseStream</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>readableStreamFromIterable</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>readable</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>readableStreamFromIterable</span>([<span style=color:#e6db74>`{&#34;a&#34;: 1}{&#34;name&#34;: &#34;foo&#34;,&#34;b&#34;:true}{&#34;arr&#34;:[1,2,3]}`</span>])
  .<span style=color:#a6e22e>pipeThrough</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>ConcatenatedJSONParseStream</span>());

<span style=color:#66d9ef>for</span> <span style=color:#66d9ef>await</span> (<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>json</span> <span style=color:#66d9ef>of</span> <span style=color:#a6e22e>readable</span>) {
  <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>json</span>);
  <span style=color:#75715e>// Output:
</span><span style=color:#75715e></span>  <span style=color:#75715e>// { a: 1 }
</span><span style=color:#75715e></span>  <span style=color:#75715e>// { name: &#34;foo&#34;, b: true }
</span><span style=color:#75715e></span>  <span style=color:#75715e>// { arr: [ 1, 2, 3 ] }
</span><span style=color:#75715e></span>}
</code></pre></div><p><code>JSONStringifyStream</code>を使うと、値を上記4つのいずれかの形式でストリーミングを行うことができます。</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>JSONStringifyStream</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/encoding/json/stream.ts&#34;</span>;
<span style=color:#66d9ef>import</span> { <span style=color:#a6e22e>readableStreamFromIterable</span> } <span style=color:#66d9ef>from</span> <span style=color:#e6db74>&#34;https://deno.land/std@0.145.0/streams/conversion.ts&#34;</span>;

<span style=color:#66d9ef>const</span> <span style=color:#a6e22e>file</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>await</span> <span style=color:#a6e22e>Deno</span>.<span style=color:#a6e22e>open</span>(<span style=color:#e6db74>&#34;data.jsonl&#34;</span>, { <span style=color:#a6e22e>create</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>write</span>: <span style=color:#66d9ef>true</span> });

<span style=color:#66d9ef>await</span> <span style=color:#a6e22e>readableStreamFromIterable</span>([{ <span style=color:#a6e22e>name</span><span style=color:#f92672>:</span> <span style=color:#e6db74>&#34;foo&#34;</span> }, { <span style=color:#a6e22e>b</span>: <span style=color:#66d9ef>true</span>, <span style=color:#a6e22e>n</span>: <span style=color:#66d9ef>123</span> }])
  .<span style=color:#a6e22e>pipeThrough</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>JSONStringifyStream</span>())
  .<span style=color:#a6e22e>pipeThrough</span>(<span style=color:#66d9ef>new</span> <span style=color:#a6e22e>TextEncoderStream</span>())
  .<span style=color:#a6e22e>pipeTo</span>(<span style=color:#a6e22e>file</span>.<span style=color:#a6e22e>writable</span>);
</code></pre></div><h3 id=その他の変更点-1>その他の変更点<a hidden class=anchor aria-hidden=true href=#その他の変更点-1>#</a></h3>
<ul>
<li><code>std/flags</code>: <code>parse()</code>の戻り値の型がオプションの内容からより賢く推論されるようになりました。</li>
<li><code>std/media_types</code>: <code>contentType()</code>の型定義が改善されました。
<ul>
<li>元々、戻り値の型定義が<code>string | undefined</code>だったため、<code>Headers</code>オブジェクトなどと併用するのが難しい問題がありました。</li>
<li>例えば、下記のように、あらかじめ<code>std/media_types</code>が把握しているタイプを引数に指定すると、戻り値が<code>string</code>型として絞り込まれるように型定義が改善されています。</li>
</ul>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=color:#a6e22e>contentType</span>(<span style=color:#e6db74>&#34;.json&#34;</span>); <span style=color:#75715e>// =&gt; string
</span></code></pre></div></li>
<li><code>std/encoding/csv/stream</code>: CRの取り扱いが改善されました。</li>
</ul>
<hr>
<p><a href=https://github.com/denoland/deno_std/releases/tag/0.145.0>https://github.com/denoland/deno_std/releases/tag/0.145.0</a></p>
<h2 id=denoが21mを調達>Denoが$21Mを調達<a hidden class=anchor aria-hidden=true href=#denoが21mを調達>#</a></h2>
<p>詳細については、下記の記事で解説されています。</p>
<ul>
<li><a href=https://deno.com/blog/series-a>Deno raises $21M</a></li>
</ul>
<p>DenoやDeno Deployがどのような背景・目的で開発されているのかについても解説されています。</p>
<hr>
<ul>
<li><a href=https://deno.com/blog/series-a>Deno raises $21M</a></li>
<li><a href=https://deno.news/archive/45-deno-raises-21m>#45: Deno raises $21M | Deno News</a></li>
</ul>
<h2 id=webview_deno-v070>webview_deno v0.7.0<a hidden class=anchor aria-hidden=true href=#webview_deno-v070>#</a></h2>
<p>webview_deno v0.7.0がリリースされています。</p>
<p>大きな変更点として、内部実装がFFI(<code>Deno.dlopen</code>)を使用した形式へ書き直されています。</p>
<p>また、Denoで定義した関数をwebview側から呼ぶために、<code>Webview#bind</code>が追加されています。</p>
<hr>
<p><a href=https://github.com/webview/webview_deno/releases/tag/0.7.0>https://github.com/webview/webview_deno/releases/tag/0.7.0</a></p>
<h2 id=fresh-v100-rc1>Fresh v1.0.0-rc.1<a hidden class=anchor aria-hidden=true href=#fresh-v100-rc1>#</a></h2>
<p><a href=https://github.com/lucacasonato/fresh/releases/tag/1.0.0-rc.1>Fresh v1.0.0のRC版</a>が公開されました。</p>
<p>合わせて、<a href=https://deno.land/x>deno.land/x</a>にFreshが公開されています。</p>
<ul>
<li><a href=https://deno.land/x/fresh>https://deno.land/x/fresh</a></li>
</ul>
<p>これにより、バージョンを明示した上でFreshを利用できるようになりました。</p>
<hr>
<p><a href=https://github.com/lucacasonato/fresh/releases/tag/1.0.0-rc.1>https://github.com/lucacasonato/fresh/releases/tag/1.0.0-rc.1</a></p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://uki00a.github.io/deno-weekly/tags/deno.html>deno</a></li>
<li><a href=https://uki00a.github.io/deno-weekly/tags/deno_std.html>deno_std</a></li>
<li><a href=https://uki00a.github.io/deno-weekly/tags/fresh.html>fresh</a></li>
<li><a href=https://uki00a.github.io/deno-weekly/tags/webview_deno.html>webview_deno</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://uki00a.github.io/deno-weekly/>週刊Deno</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>